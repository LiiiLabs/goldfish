<TMU|<tuple|1.0.4|1.2.9.3-rc1>>

<style|<tuple|book|chinese|literate|goldfish|reduced-margins|guile|smart-ref|preview-ref>>

<\body>
  <\hide-preamble>
    <assign|scm|<macro|body|<goldfish-lang|<arg|body>>>>

    <assign|scm-chunk|<\macro|name|prev|next|body>
      <\generic-chunk|<arg|name>|<arg|prev>|<arg|next>>
        <with|mode|prog|prog-language|goldfish|font-family|rm|<arg|body>>
      </generic-chunk>
    </macro>>

    <assign|subparagraph|<macro|title|<assign|subparagraph-numbered|<compound|subparagraph-display-numbers>><assign|subparagraph-prefix|<macro|<compound|the-subparagraph>.>><compound|next-subparagraph><compound|subparagraph-clean><compound|subparagraph-header|<arg|title>><compound|subparagraph-toc|<arg|title>><small|<if|<value|subparagraph-numbered>|<compound|subparagraph-numbered-title|<arg|title>>|<compound|subparagraph-unnumbered-title|<arg|title>>>>>>

    <assign|r7rs|<flag|r7rs|dark cyan>>

    <assign|goldfish-version|17.10.6>
  </hide-preamble>

  æ–‡æ¡£è®¸å¯è¯æš‚æ—¶æ²¡æœ‰ç¡®å®šï¼

  \;

  é‡‘é±¼Schemeï¼Œåˆç§°Goldfish Schemeï¼Œæ˜¯ä¸‰é²¤ç½‘ç»œå‘èµ·çš„Schemeè§£é‡Šå™¨å®ç°ã€‚ç›®å‰ä¸“æ³¨äºSchemeè¯­è¨€çš„æ ‡å‡†åº“ã€‚æœ¬æ–‡æ¡£æ˜¯é‡‘é±¼Scheme V<value|goldfish-version>çš„æ–‡å­¦ç¼–ç¨‹å®ç°ï¼Œç›®å‰é‡‘é±¼Schemeä¸­å‡ ä¹æ‰€æœ‰çš„Schemeä»£ç å®ç°å’Œæµ‹è¯•éƒ½åŒ…å«åœ¨æœ¬æ–‡æ¡£ä¸­ã€‚

  æœ¬æ–‡æ¡£çš„ç”¨æˆ·æ˜¯äººç±»å’Œå¤§æ¨¡å‹æœåŠ¡ã€‚åŸºäºæœ¬æ–‡æ¡£ï¼Œç”¨æˆ·å¯ä»¥è·å¾—é‡‘é±¼Schemeçš„å®ç°æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ”¹è¿›é‡‘é±¼Schemeçš„æ—¢æœ‰å®ç°ã€‚æœ¬æ–‡æ¡£çš„å†…å®¹è¶Šç¿”å®ï¼Œç”¨æˆ·ä½¿ç”¨é‡‘é±¼Schemeçš„ä½“éªŒè¶Šå¥½ã€‚<chapter|boot.scm>

  S7 Schemeé»˜è®¤å¹¶ä¸éµå¾ªR7RSï¼Œåœ¨å¯åŠ¨S7 Schemeä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯åŠ è½½<scm|boot.scm>ï¼Œå®ç°R7RSçš„<scm|define-library>å’Œ<scm|import>ã€‚

  <value|r7rs><paragraph|file-exists?><index|file-exists?>

  <\scm-chunk|goldfish/scheme/boot.scm|false|true>
    (define (file-exists? path)

    \ \ (if (string? path)

    \ \ \ \ (if (not (g_access path 0)) ; F_OK

    \ \ \ \ \ \ #f

    \ \ \ \ \ \ (if (g_access path 4) ; R_OK

    \ \ \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ \ \ (error 'permission-error (string-append "No permission: " path))))

    \ \ \ \ (error 'type-error "(file-exists? path): path should be string")))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|delete-file><index|delete-file>

  <\scm-chunk|goldfish/scheme/boot.scm|true|true>
    (define (delete-file path)

    \ \ (if (not (string? path))

    \ \ \ \ (error 'type-error "(delete-file path): path should be string")

    \ \ \ \ (if (not (file-exists? path))

    \ \ \ \ \ \ (error 'read-error (string-append path " does not exist"))

    \ \ \ \ \ \ (g_delete-file path))))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|define-library><index|define-library>

  <\scm-chunk|goldfish/scheme/boot.scm|true|true>
    ; 0-clause BSD

    ; Adapted from S7 Scheme's r7rs.scm

    (define-macro (define-library libname . body) ; \|(lib name)\| -\<gtr\> environment

    \ \ â€˜(define ,(symbol (object-\<gtr\>string libname))

    \ \ \ \ \ (with-let (sublet (unlet)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons 'import import)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons '*export* ())

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons 'export (define-macro (,(gensym) . names)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(set! *export* (append ',names *export*)))))

    \ \ \ \ \ \ \ ,@body

    \ \ \ \ \ \ \ (apply inlet

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (map (lambda (entry)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (or (member (car entry) '(*export* export import))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (and (pair? *export*)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (not (member (car entry) *export*))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (curlet))))))

    \;

    (unless (defined? 'r7rs-import-library-filename)

    \ \ (define (r7rs-import-library-filename libs)

    \ \ \ \ (when (pair? libs)

    \ \ \ \ \ \ (let ((lib-filename (let loop ((lib (if (memq (caar libs) '(only except prefix rename))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cadar libs)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car libs)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (name ""))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (set! name (string-append name (symbol-\<gtr\>string (car lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (null? (cdr lib))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string-append name ".scm")

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (set! name (string-append name "/"))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (cdr lib) name))))))

    \ \ \ \ \ \ \ \ (unless (member lib-filename (*s7* 'file-names))

    \ \ \ \ \ \ \ \ \ \ (load lib-filename)))

    \ \ \ \ \ \ (r7rs-import-library-filename (cdr libs)))))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|import><index|import>

  <\scm-chunk|goldfish/scheme/boot.scm|true|false>
    (define-macro (import . libs)

    \ \ â€˜(begin

    \ \ \ \ \ (r7rs-import-library-filename ',libs)

    \ \ \ \ \ (varlet (curlet)

    \ \ \ \ \ \ \ ,@(map (lambda (lib)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (case (car lib)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((only)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((lambda (e names)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply inlet

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (map (lambda (name)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons name (e name)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ names)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>value (symbol (object-\<gtr\>string (cadr ',lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr ',lib)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((except)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((lambda (e names)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply inlet

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (map (lambda (entry)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (member (car entry) names)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ e)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>value (symbol (object-\<gtr\>string (cadr ',lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr ',lib)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((prefix)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((lambda (e prefx)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply inlet

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (map (lambda (entry)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons (string-\<gtr\>symbol\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string-append (symbol-\<gtr\>string prefx)\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>string (car entry))))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cdr entry)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ e)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>value (symbol (object-\<gtr\>string (cadr ',lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (caddr ',lib)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((rename)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((lambda (e names)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply inlet

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (map (lambda (entry)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((info (assoc (car entry) names)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if info

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons (cadr info) (cdr entry))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry)))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ e)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>value (symbol (object-\<gtr\>string (cadr ',lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr ',lib)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(let ((sym (symbol (object-\<gtr\>string ',lib))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (not (defined? sym))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (format () "~A not loaded~%" sym)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol-\<gtr\>value sym))))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ libs))))

    \;
  </scm-chunk>

  <chapter|(liii base)>

  \;

  Goldfish Schemeè§£é‡Šå™¨é»˜è®¤ä¼šåŠ è½½<scm|(liii base)>ã€‚å¦‚æœä¸æƒ³é»˜è®¤åŠ è½½<scm|(liii base)>ï¼Œè¯·ä½¿ç”¨s7ã€r7rsæˆ–è€…sicpæ¨¡å¼ã€‚

  <scm|(liii base)>ç”±ä»¥ä¸‹å‡½æ•°åº“ç»„æˆï¼š

  <\description>
    <item*|(scheme base)>ç”±R7RSå®šä¹‰çš„SchemeåŸºç¡€å‡½æ•°åº“

    <item*|(srfi srfi-2)>ç”±SRFI-2å®šä¹‰çš„<scm|and-let*>

    <item*|(srfi srfi-8)>ç”±SRFI-8å®šä¹‰çš„<scm|receive>

    <item*|(liii base)>ä¸‰é²¤æ‰©å±•å‡½æ•°å’ŒS7å†…ç½®çš„éR7RSå‡½æ•°ï¼Œä¾‹å¦‚<scm|display*>
  </description>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/scheme/base.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/base.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/base-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define-library (scheme base)

    (export

    \ \ let-values

    \ \ define-record-type

    \ \ square

    \ \ exact inexact

    \ \ floor s7-floor ceiling s7-ceiling truncate s7-truncate round s7-round

    \ \ floor-quotient

    \ \ gcd lcm s7-lcm

    \ \ boolean=?

    \ \ ; R7RS 6.4: list

    \ \ list-copy

    \ \ ; R7RS 6.5: Symbol

    \ \ symbol=?

    \ \ ; R7RS 6.7: String

    \ \ string-copy

    \ \ ; R7RS 6.8: Vector

    \ \ vector-\<gtr\>string string-\<gtr\>vector

    \ \ vector-copy vector-copy! vector-fill!

    \ \ ; R7RS 6.9: Bytevectors

    \ \ bytevector? make-bytevector bytevector bytevector-length

    \ \ bytevector-u8-ref bytevector-u8-set!

    \ \ utf8-\<gtr\>string string-\<gtr\>utf8 u8-string-length

    \ \ ; Input and Output

    \ \ call-with-port port? binary-port? textual-port?

    \ \ input-port-open? output-port-open?

    \ \ open-binary-input-file open-binary-output-file

    \ \ close-port

    \ \ eof-object

    \ \ ; Control flow

    \ \ string-map vector-map string-for-each vector-for-each

    \ \ ; Exception

    \ \ raise guard read-error? file-error?)

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define-library (liii base)

    (import (scheme base)

    \ \ \ \ \ \ \ \ (srfi srfi-2)

    \ \ \ \ \ \ \ \ (srfi srfi-8))

    (export

    \ \ ; (scheme base) defined by R7RS

    \ \ let-values

    \ \ define-record-type

    \ \ square

    \ \ exact inexact

    \ \ floor s7-floor ceiling s7-ceiling truncate s7-truncate round s7-round

    \ \ floor-quotient

    \ \ gcd lcm s7-lcm

    \ \ boolean=?

    \ \ ; R7RS 6.4: list

    \ \ list-copy

    \ \ ; R7RS 6.5: Symbol

    \ \ symbol=?

    \ \ ; R7RS 6.7: String

    \ \ string-copy

    \ \ ; R7RS 6.8 Vector

    \ \ vector-\<gtr\>string string-\<gtr\>vector

    \ \ vector-copy vector-copy! vector-fill!

    \ \ ; R7RS 6.9 Bytevectors

    \ \ bytevector? make-bytevector bytevector bytevector-length

    \ \ bytevector-u8-ref bytevector-u8-set!

    \ \ bytevector-u8-ref bytevector-u8-set!

    \ \ utf8-\<gtr\>string string-\<gtr\>utf8 u8-string-length

    \ \ ; Input and Output

    \ \ call-with-port port? binary-port? textual-port?

    \ \ input-port-open? output-port-open?

    \ \ open-binary-input-file open-binary-output-file

    \ \ close-port

    \ \ eof-object

    \ \ ; Control flow

    \ \ string-map vector-map string-for-each vector-for-each

    \ \ ; Exception

    \ \ raise guard read-error? file-error?

    \ \ ; SRFI-2

    \ \ and-let*

    \ \ ; SRFI-8

    \ \ receive

    \ \ ; Extra routines for (liii base)

    \ \ == != display* in? let1 compose identity typed-lambda

    )

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (liii base)

    \ \ \ \ \ \ \ \ (liii list))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <section|è¡¨è¾¾å¼>

  æœ¬èŠ‚å¯¹åº”R7RSçš„ç¬¬å››èŠ‚ï¼šè¡¨è¾¾å¼ã€‚

  <subsection|åŸè¯­è¡¨è¾¾å¼>

  <subsection|æ´¾ç”Ÿè¡¨è¾¾å¼>

  <paragraph|cond>

  <value|r7rs><paragraph|case><index|case>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (case '+

    \ \ \ \ \ \ \ \ \ ((+ -) 'p0)

    \ \ \ \ \ \ \ \ \ ((* /) 'p1))

    \ \ =\<gtr\> 'p0)

    \;

    (check (case '-

    \ \ \ \ \ \ \ \ \ ((+ -) 'p0)

    \ \ \ \ \ \ \ \ \ ((* /) 'p1))

    \ \ =\<gtr\> 'p0)

    \;

    (check (case '*

    \ \ \ \ \ \ \ \ \ ((+ -) 'p0)

    \ \ \ \ \ \ \ \ \ ((* /) 'p1))

    \ \ =\<gtr\> 'p1)

    \;

    (check (case '@

    \ \ \ \ \ \ \ \ \ ((+ -) 'p0)

    \ \ \ \ \ \ \ \ \ ((* /) 'p1))

    \ \ =\<gtr\> #\<less\>unspecified\<gtr\>)

    \;

    (check (case '&

    \ \ \ \ \ \ \ \ \ ((+ -) 'p0)

    \ \ \ \ \ \ \ \ \ ((* /) 'p1))

    \ \ =\<gtr\> #\<less\>unspecified\<gtr\>)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|and><index|and>

  æ£€æŸ¥ <code*|and> æ˜¯å¦æ­£ç¡®å¤„ç†å¤šä¸ªå¸ƒå°”è¡¨è¾¾å¼ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (and #t #t #t))

    (check-false (and #t #f #t))

    (check-false (and #f #t #f))

    (check-false (and #f #f #f))

    \;
  </scm-chunk>

  éªŒè¯å½“ <code*|and> æ²¡æœ‰å‚æ•°æ—¶çš„è¡Œä¸ºã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (and))

    \;
  </scm-chunk>

  æµ‹è¯• <code*|and> ä¸æ··åˆç±»å‹å‚æ•°çš„ç»„åˆã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (and 1 '() "non-empty" #t))

    (check-false (and #f '() "non-empty" #t))

    (check-false (and 1 '() "non-empty" #f))

    \;
  </scm-chunk>

  æ£€æŸ¥ <code*|and> åœ¨å¤åˆè¡¨è¾¾å¼ä¸­çš„è¡Œä¸ºã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (and (\<gtr\> 5 3) (\<less\> 5 10)))

    (check-false (and (\<gtr\> 5 3) (\<gtr\> 5 10)))

    \;
  </scm-chunk>

  éªŒè¯ <code*|and> çš„çŸ­è·¯è¡Œä¸ºã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-catch 'error-name

    \ \ (and (error 'error-name "This should not be evaluated") #f))

    (check-false (and #f (error "This should not be evaluated")))

    \;
  </scm-chunk>

  éªŒè¯andè¿”å›å€¼éå¸ƒå°”å€¼çš„æƒ…å†µã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (and #t 1) =\<gtr\> 1)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|or><index|or>

  <value|r7rs><paragraph|when>

  <value|r7rs><paragraph|unless>

  <value|r7rs><paragraph|let><index|let>

  <value|r7rs><paragraph|let*>

  <value|r7rs><paragraph|letrec>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (define (test-letrec)

    \ \ (letrec ((even?

    \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (n)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (= n 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (odd? (- n 1)))))

    \ \ \ \ \ \ \ \ \ \ \ \ (odd?

    \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (n)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (= n 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #f

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (even? (- n 1))))))

    \ \ \ \ (list (even? 10) (odd? 10))))

    \;

    (check (test-letrec) =\<gtr\> (list #t #f))

    \;

    (check-catch 'wrong-type-arg

    \ \ (letrec ((a 1) (b (+ a 1))) (list a b)))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|letrec*><index|letrec*>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check

    \ \ (letrec* ((a 1) (b (+ a 1))) (list a b))

    \ \ =\<gtr\> (list 1 2))

    \;
  </scm-chunk>

  \;

  <value|r7rs><paragraph|let-values><index|let-values>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    ; 0-clause BSD

    ; Bill Schottstaedt

    ; from S7 source repo: r7rs.scm

    (define-macro (let-values vars . body)

    \ \ (if (and (pair? vars)

    \ \ \ \ \ \ \ \ \ \ \ (pair? (car vars))

    \ \ \ \ \ \ \ \ \ \ \ (null? (cdar vars)))

    \ \ \ \ \ \ â€˜((lambda ,(caar vars)

    \ \ \ \ \ \ \ \ \ \ ,@body)

    \ \ \ \ \ \ \ \ ,(cadar vars))

    \ \ \ \ \ \ â€˜(with-let

    \ \ \ \ \ \ \ \ (apply sublet (curlet)

    \ \ \ \ \ \ \ \ \ \ (list

    \ \ \ \ \ \ \ \ \ \ \ \ ,@(map

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (v)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((lambda ,(car v)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values ,@(map (lambda (name)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values (symbol-\<gtr\>keyword name) name))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let args-\<gtr\>proper-list ((args (car v)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cond ((symbol? args)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (list args))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((not (pair? args))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ args)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((pair? (car args))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons (caar args)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (args-\<gtr\>proper-list (cdr args))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons (car args)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (args-\<gtr\>proper-list (cdr args)))))))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,(cadr v)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vars)))

    \ \ \ \ \ \ \ \ ,@body)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (let-values (((ret) (+ 1 2))) (+ ret 4)) =\<gtr\> 7)

    (check (let-values (((a b) (values 3 4))) (+ a b)) =\<gtr\> 7)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|let*-values>

  <paragraph|and-let*><index|and-let*>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (and-let* ((hi 3) (ho #f)) (+ hi 1)) =\<gtr\> #f)

    (check (and-let* ((hi 3) (ho #t)) (+ hi 1)) =\<gtr\> 4)

    \;
  </scm-chunk>

  <subparagraph|SRFI>

  <\scm-chunk|goldfish/srfi/srfi-2.scm|false|false>
    ; 0-clause BSD by Bill Schottstaedt from S7 source repo: s7test.scm

    (define-library (srfi srfi-2)

    (export and-let*)

    (begin

    \;

    (define-macro (and-let* vars . body)

    \ \ â€˜(let () (and ,@(map (lambda (v) â€˜(define ,@v)) vars) (begin ,@body))))

    \;

    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <section|ç¨‹åºç»“æ„>

  æœ¬èŠ‚å¯¹åº”R7RSçš„ç¬¬5èŠ‚ï¼šç¨‹åºç»“æ„ã€‚

  <paragraph|define-record-type><index|define-record-type>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    ; 0-clause BSD by Bill Schottstaedt from S7 source repo: r7rs.scm

    (define-macro (define-record-type type make ? . fields)

    \ \ (let ((obj (gensym))

    \ \ \ \ \ \ \ \ (typ (gensym)) ; this means each call on this macro makes a new type

    \ \ \ \ \ \ \ \ (args (map (lambda (field)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values (list 'quote (car field))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((par (memq (car field) (cdr make))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (and (pair? par) (car par)))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields)))

    \ \ \ \ â€˜(begin

    \ \ \ \ \ \ \ (define (,? ,obj)

    \ \ \ \ \ \ \ \ \ (and (let? ,obj)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (eq? (let-ref ,obj ',typ) ',type)))

    \ \ \ \ \ \ \ 

    \ \ \ \ \ \ \ (define ,make\ 

    \ \ \ \ \ \ \ \ \ (inlet ',typ ',type ,@args))

    \;

    \ \ \ \ \ \ \ ,@(map

    \ \ \ \ \ \ \ \ \ \ (lambda (field)

    \ \ \ \ \ \ \ \ \ \ \ \ (when (pair? field)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (null? (cdr field))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (null? (cddr field))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(define (,(cadr field) ,obj)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let-ref ,obj ',(car field)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (define (,(cadr field) ,obj)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let-ref ,obj ',(car field)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (define (,(caddr field) ,obj val)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let-set! ,obj ',(car field) val)))))))

    \ \ \ \ \ \ \ \ \ \ fields)

    \ \ \ \ \ \ \ ',type)))

    \;
  </scm-chunk>

  \;

  <subparagraph|æµ‹è¯•>

  é€šè¿‡<scm|define-record-type>ï¼Œå®šä¹‰äº†ä¸€ç§åä¸º<scm|pare>çš„è®°å½•ç±»å‹ï¼Œå…¶ä¸­<scm|kons>æ˜¯è¿™ç§è®°å½•ç±»å‹çš„æ„é€ å™¨ï¼Œ<scm|pare?>æ˜¯è°“è¯ï¼Œ<scm|kar>å’Œ<scm|kdr>æ˜¯é€‰æ‹©å™¨ï¼Œ<scm|set-kar!>æ˜¯ä¿®æ”¹å™¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (define-record-type :pare

    \ \ (kons x y)

    \ \ pare?

    \ \ (x kar set-kar!)

    \ \ (y kdr))

    \;

    (check (pare? (kons 1 2)) =\<gtr\> #t)

    (check (pare? (cons 1 2)) =\<gtr\> #f)

    (check (kar (kons 1 2)) =\<gtr\> 1)

    (check (kdr (kons 1 2)) =\<gtr\> 2)

    \;

    (check

    \ (let ((k (kons 1 2)))

    \ \ \ (set-kar! k 3)

    \ \ \ (kar k))

    \ \ =\<gtr\> 3)

    \;
  </scm-chunk>

  \;

  ä¸Šé¢é‚£ä¸ªä¾‹å­æ¯”è¾ƒéš¾æ‡‚ï¼Œæä¾›ä¸€ä¸ªæ›´æ˜“æ‡‚çš„ä¾‹å­ï¼š

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (define-record-type :person

    \ \ (make-person name age)

    \ \ person?

    \ \ (name get-name set-name!)

    \ \ (age get-age))

    \;

    (check (person? (make-person "Da" 3)) =\<gtr\> #t)

    (check (get-age (make-person "Da" 3)) =\<gtr\> 3)

    (check (get-name (make-person "Da" 3)) =\<gtr\> "Da")

    (check

    \ \ (let ((da (make-person "Da" 3)))

    \ \ \ \ (set-name! da "Darcy")

    \ \ \ \ (get-name da))

    \ \ =\<gtr\> "Darcy")

    \;
  </scm-chunk>

  <subparagraph|SRFI>

  <\scm-chunk|goldfish/srfi/srfi-9.scm|false|false>
    (define-library (srfi srfi-9)

    (import (scheme base))

    (export define-record-type)

    (begin

    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  \;

  <section|ç›¸ç­‰æ€§åˆ¤æ–­>

  <section|æ•°>

  æœ¬èŠ‚å¯¹åº”R7RSçš„6.2èŠ‚ã€‚

  <subsection|æ•°çš„ç±»å‹>

  <value|r7rs><paragraph|number?><index|number?><scm|(number? obj) =\<gtr\> boolean>

  åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æ•°ã€‚

  <paragraph|complex?>

  åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å¤æ•°ã€‚

  <paragraph|real?>

  <paragraph|rational?>

  <paragraph|integer?>

  <subsection|æ•°çš„å‡†ç¡®æ€§>

  <value|r7rs><paragraph|exact?><index|exact?>

  <todo|<scm|#e3.0>éœ€è¦æ”¯æŒä¸€ä¸‹>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (exact? 1))

    (check-true (exact? 1/2))

    (check-false (exact? 0.3))

    ; (check-true (exact? #e3.0))

    \;
  </scm-chunk>

  <paragraph|inexact?>

  <paragraph|exact-integer?>

  <paragraph|exact>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define exact inexact-\<gtr\>exact)

    \;
  </scm-chunk>

  <paragraph|inexact>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define inexact exact-\<gtr\>inexact)

    \;
  </scm-chunk>

  <subsection|æ•°çš„è¿ç®—>

  <paragraph|zero?>

  <value|r7rs><paragraph|floor><index|floor><scm|(x) =\<gtr\> integer>

  è¿”å›æœ€å¤§çš„ä¸å¤§äº<math|x>çš„æ•´æ•°ã€‚å¦‚æœ<math|x>æ˜¯å‡†ç¡®å€¼ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿæ˜¯å‡†ç¡®å€¼ï¼Œå¦‚æœ<math|x>ä¸æ˜¯å‡†ç¡®å€¼ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿä¸æ˜¯å‡†ç¡®å€¼ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define s7-floor floor)

    \;

    (define (floor x)

    \ \ (if (inexact? x)

    \ \ \ \ \ \ (inexact (s7-floor x))

    \ \ \ \ \ \ (s7-floor x)))

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (floor 1.1) =\<gtr\> 1.0)

    (check (floor 1) =\<gtr\> 1)

    (check (floor 1/2) =\<gtr\> 0)

    (check (floor 0) =\<gtr\> 0)

    (check (floor -1) =\<gtr\> -1)

    (check (floor -1.2) =\<gtr\> -2.0)

    \;

    (check (s7-floor 1.1) =\<gtr\> 1)

    (check (s7-floor -1.2) =\<gtr\> -2)

    \;
  </scm-chunk>

  <paragraph|ceiling>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define s7-ceiling ceiling)

    \;

    (define (ceiling x)

    \ \ (if (inexact? x)

    \ \ \ \ \ \ (inexact (s7-ceiling x))

    \ \ \ \ \ \ (s7-ceiling x)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (ceiling 1.1) =\<gtr\> 2.0)

    (check (ceiling 1) =\<gtr\> 1)

    (check (ceiling 1/2) =\<gtr\> 1)

    (check (ceiling 0) =\<gtr\> 0)

    (check (ceiling -1) =\<gtr\> -1)

    (check (ceiling -1.2) =\<gtr\> -1.0)

    \;

    (check (s7-ceiling 1.1) =\<gtr\> 2)

    (check (s7-ceiling -1.2) =\<gtr\> -1)

    \;
  </scm-chunk>

  <paragraph|truncate>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define s7-truncate truncate)

    \;

    (define (truncate x)

    \ \ (if (inexact? x)

    \ \ \ \ \ \ (inexact (s7-truncate x))

    \ \ \ \ \ \ (s7-truncate x)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (truncate 1.1) =\<gtr\> 1.0)

    (check (truncate 1) =\<gtr\> 1)

    (check (truncate 1/2) =\<gtr\> 0)

    (check (truncate 0) =\<gtr\> 0)

    (check (truncate -1) =\<gtr\> -1)

    (check (truncate -1.2) =\<gtr\> -1.0)

    \;

    (check (s7-truncate 1.1) =\<gtr\> 1)

    (check (s7-truncate -1.2) =\<gtr\> -1)

    \;
  </scm-chunk>

  <paragraph|round>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define s7-round round)

    \;

    (define (round x)

    \ \ (if (inexact? x)

    \ \ \ \ \ \ (inexact (s7-round x))

    \ \ \ \ \ \ (s7-round x)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (round 1.1) =\<gtr\> 1.0)

    (check (round 1.5) =\<gtr\> 2.0)

    (check (round 1) =\<gtr\> 1)

    (check (round 1/2) =\<gtr\> 0)

    (check (round 0) =\<gtr\> 0)

    (check (round -1) =\<gtr\> -1)

    (check (round -1.2) =\<gtr\> -1.0)

    (check (round -1.5) =\<gtr\> -2.0)

    \;
  </scm-chunk>

  \;

  <value|r7rs><paragraph|floor-quotient><index|floor-quotient><scm|((x real?) (y real?)) =\<gtr\> integer>

  <\equation*>
    floor_quotient<around*|(|y,x|)>=<around*|\<lfloor\>|y/x|\<rfloor\>>
  </equation*>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (floor-quotient x y) (floor (/ x y)))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  æ­£å¸¸æƒ…å†µæµ‹è¯•

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (floor-quotient 11 2) =\<gtr\> 5)

    (check (floor-quotient 11 -2) =\<gtr\> -6)

    (check (floor-quotient -11 2) =\<gtr\> -6)

    (check (floor-quotient -11 -2) =\<gtr\> 5)

    \;

    (check (floor-quotient 10 2) =\<gtr\> 5)

    (check (floor-quotient 10 -2) =\<gtr\> -5)

    (check (floor-quotient -10 2) =\<gtr\> -5)

    (check (floor-quotient -10 -2) =\<gtr\> 5)

    \;
  </scm-chunk>

  ç‰¹æ®Šæƒ…å†µæµ‹è¯•

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-catch 'division-by-zero (floor-quotient 11 0))

    (check-catch 'division-by-zero (floor-quotient 0 0))

    \;

    (check (floor-quotient 0 2) =\<gtr\> 0)

    (check (floor-quotient 0 -2) =\<gtr\> 0)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|quotient><index|quotient><scm|(quotient (y real?) (x real?)) =\<gtr\> integer>

  æ±‚ä¸¤ä¸ªæ•°çš„å•†ã€‚

  <\equation*>
    quotient<around*|(|y,x|)>=truncate<around*|(|y/x|)>
  </equation*>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (quotient 11 2) =\<gtr\> 5)

    (check (quotient 11 -2) =\<gtr\> -5)

    (check (quotient -11 2) =\<gtr\> -5)

    (check (quotient -11 -2) =\<gtr\> 5)

    \;

    (check-catch 'division-by-zero (quotient 11 0))

    (check-catch 'division-by-zero (quotient 0 0))

    (check-catch 'wrong-type-arg (quotient 1+i 2))

    \;
  </scm-chunk>

  <paragraph|remainder>

  <paragraph|modulo>

  <value|r7rs><paragraph|gcd><index|gcd><scm|(x ...) =\<gtr\> (y positive?)>

  æ±‚nä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (gcd) =\<gtr\> 0)

    (check (gcd 0) =\<gtr\> 0)

    (check (gcd 1) =\<gtr\> 1)

    (check (gcd 2) =\<gtr\> 2)

    (check (gcd -1) =\<gtr\> 1)

    \;

    (check (gcd 0 1) =\<gtr\> 1)

    (check (gcd 1 0) =\<gtr\> 1)

    (check (gcd 1 2) =\<gtr\> 1)

    (check (gcd 1 10) =\<gtr\> 1)

    (check (gcd 2 10) =\<gtr\> 2)

    (check (gcd -2 10) =\<gtr\> 2)

    \;

    (check (gcd 2 3 4) =\<gtr\> 1)

    (check (gcd 2 4 8) =\<gtr\> 2)

    (check (gcd -2 4 8) =\<gtr\> 2)

    \;
  </scm-chunk>

  <paragraph|lcm>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define s7-lcm lcm)

    \;

    (define (lcm2 x y)

    \ \ (cond ((and (inexact? x) (exact? y))

    \ \ \ \ \ \ \ \ \ (inexact (s7-lcm (exact x) y)))

    \ \ \ \ \ \ \ \ ((and (exact? x) (inexact? y))

    \ \ \ \ \ \ \ \ \ (inexact (s7-lcm x (exact y))))

    \ \ \ \ \ \ \ \ ((and (inexact? x) (inexact? y))

    \ \ \ \ \ \ \ \ \ (inexact (s7-lcm (exact x) (exact y))))

    \ \ \ \ \ \ \ \ (else (s7-lcm x y))))

    \;

    (define (lcm . args)

    \ \ (cond ((null? args) 1)

    \ \ \ \ \ \ \ \ ((null? (cdr args))

    \ \ \ \ \ \ \ \ \ (car args))

    \ \ \ \ \ \ \ \ ((null? (cddr args))

    \ \ \ \ \ \ \ \ \ (lcm2 (car args) (cadr args)))

    \ \ \ \ \ \ \ \ (else (apply lcm (cons (lcm (car args) (cadr args))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr args))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (lcm) =\<gtr\> 1)

    (check (lcm 1) =\<gtr\> 1)

    (check (lcm 0) =\<gtr\> 0)

    (check (lcm 32 -36) =\<gtr\> \ 288)

    (check (lcm 32 -36.0) =\<gtr\> 288.0)

    (check (lcm 2 4) =\<gtr\> 4)

    (check (lcm 2 4.0) =\<gtr\> 4.0)

    (check (lcm 2.0 4.0) =\<gtr\> 4.0)

    (check (lcm 2.0 4) =\<gtr\> 4.0)

    \;
  </scm-chunk>

  \;

  <value|r7rs><paragraph|square><index|square>

  æ±‚ä¸€ä¸ªæ•°çš„å¹³æ–¹ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (square x) (* x x))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (square 2) =\<gtr\> 4)

    \;
  </scm-chunk>

  <paragraph|sqrt>

  <paragraph|exact-integer-sqrt>

  <paragraph|expt>

  <subsection|æ•°çš„è½¬æ¢>

  <section|å¸ƒå°”å€¼>

  <r7rs><paragraph|boolean=?><scm|(obj1 obj2 ...) =\<gtr\> boolean><index|boolean=?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (boolean=? obj1 obj2 . rest)

    \ \ (define (same-boolean obj rest)

    \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ (and (equal? obj (car rest))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (same-boolean obj (cdr rest)))))

    \ \ (cond ((not (boolean? obj1)) #f)

    \ \ \ \ \ \ \ \ ((not (boolean? obj2)) #f)

    \ \ \ \ \ \ \ \ ((not (equal? obj1 obj2)) #f)

    \ \ \ \ \ \ \ \ (else (same-boolean obj1 rest))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (boolean=? #t #t))

    (check-true (boolean=? #f #f))

    (check-true (boolean=? #t #t #t))

    (check-false (boolean=? #t #f))

    (check-false (boolean=? #f #t))

    \;
  </scm-chunk>

  <section|åºå¯¹å’Œåˆ—è¡¨>

  è§<chapter-ref|chapter:liii_list>

  <section|ç¬¦å·>

  <value|r7rs><paragraph|symbol=?><index|symbol=?>

  å¦‚æœæ‰€æœ‰å‚æ•°éƒ½æ˜¯ç¬¦å·å¹¶ä¸”å®ƒä»¬çš„åç§°é€šè¿‡string=?æµ‹è¯•æ˜¯ç›¸åŒçš„ï¼Œè¿”å›#tï¼ˆçœŸï¼‰ï¼Œå¦åˆ™è¿”å›#fï¼ˆå‡ï¼‰ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (symbol=? sym1 sym2 . rest)

    \ \ (define (same-symbol sym rest)

    \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ (and (eq? sym (car rest))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (same-symbol sym (cdr rest)))))

    \ \ (cond ((not (symbol? sym1)) #f)

    \ \ \ \ \ \ \ \ ((not (symbol? sym2)) #f)

    \ \ \ \ \ \ \ \ ((not (eq? sym1 sym2)) #f)

    \ \ \ \ \ \ \ \ (else (same-symbol sym1 rest))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-catch 'wrong-number-of-args (symbol=? 'a))

    (check-catch 'wrong-number-of-args (symbol=? 1))

    \;

    (check-true (symbol=? 'a 'a))

    (check-true (symbol=? 'foo 'foo))

    (check-false (symbol=? 'a 'b))

    (check-false (symbol=? 'foo 'bar))

    \;

    (check-true (symbol=? 'bar 'bar 'bar))

    \;
  </scm-chunk>

  æµ‹è¯•åŠ¨æ€ç”Ÿæˆçš„ç¬¦å·

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (symbol=? (string-\<gtr\>symbol "foo") (string-\<gtr\>symbol "foo")))

    (check-false (symbol=? (string-\<gtr\>symbol "foo") (string-\<gtr\>symbol "bar")))

    \;
  </scm-chunk>

  æµ‹è¯•æ··åˆç±»å‹

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-false (symbol=? 1 1))

    (check-false (symbol=? 'a 1))

    (check-false (symbol=? (string-\<gtr\>symbol "foo") 1))

    \;
  </scm-chunk>

  æµ‹è¯•ç©ºåˆ—è¡¨\ 

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-false (symbol=? 'a 'b '()))

    \;
  </scm-chunk>

  <section|å­—ç¬¦>

  <paragraph|char?><index|char?>

  åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡xæ˜¯å¦æ˜¯å­—ç¬¦ç±»å‹ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (char? #\\A) =\<gtr\> #t)

    (check (char? 1) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|char=?><index|char=?>

  åˆ¤æ–­ä¸¤ä¸ªåŠä»¥ä¸Šå­—ç¬¦å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (char=? #\\A #\\A) =\<gtr\> #t)

    (check (char=? #\\A #\\A #\\A) =\<gtr\> #t)

    (check (char=? #\\A #\\a) =\<gtr\> #f)

    \;
  </scm-chunk>

  <section|å­—ç¬¦ä¸²>

  è§<smart-ref|chapter:liii_string>

  <section|å‘é‡>

  è§<smart-ref|chapter:liii_vector>

  <section|å­—èŠ‚å‘é‡>

  <value|r7rs><paragraph|bytevector?><index|bytevector?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define bytevector? byte-vector?)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (bytevector? #u8(0)))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|make-bytevector><index|make-bytevector>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define make-bytevector make-byte-vector)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (make-bytevector 3 0) =\<gtr\> #u8(0 0 0))

    (check (make-bytevector 3 3) =\<gtr\> #u8(3 3 3))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|bytevector><index|bytevector>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define bytevector byte-vector)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (bytevector 1) =\<gtr\> #u8(1))

    (check (bytevector) =\<gtr\> #u8())

    (check (bytevector 1 2 3) =\<gtr\> #u8(1 2 3))

    \;

    (check-catch 'wrong-type-arg (bytevector 256))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|bytevector-length>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define bytevector-length length)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|bytevector-u8-ref>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define bytevector-u8-ref byte-vector-ref)

    \;
  </scm-chunk>

  \;

  <value|r7rs><paragraph|bytevector-u8-set!>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define bytevector-u8-set! byte-vector-set!)

    \;
  </scm-chunk>

  <paragraph|u8-string-length>

  <value|r7rs><paragraph|utf8-\<gtr\>string><index|utf8-\<gtr\>string>

  <value|r7rs><paragraph|string-\<gtr\>utf8><index|string-\<gtr\>utf8>

  è¿™ä¸‰ä¸ªå‡½æ•°ä¾èµ–äºä¸€æ ·çš„å…¬å…±å­å‡½æ•°ï¼Œæ•…è€Œæ”¾åœ¨ä¸€èµ·å®ç°ã€‚

  <subparagraph|å…¬å…±å­å‡½æ•°>

  é¦–å…ˆå®šä¹‰å…¬å…±å­å‡½æ•°<scm|bytevector-advance-u8>ï¼š<scm|(bv index end) =\<gtr\> index>ã€‚

  <\enumerate>
    <item>å½“å‰ä½ç½®è¶…è¿‡æŒ‡å®šçš„å¼€åŒºé—´çš„ç»“å°¾æ—¶ï¼Œç›´æ¥è¿”å›å½“å‰ä½ç½®

    <item>å½“å‰ä½ç½®æ˜¯éæ³•ä½ç½®ï¼Œç›´æ¥è¿”å›å½“å‰ä½ç½®

    <item>å½“å‰ä½ç½®æ˜¯åˆæ³•ä½ç½®ï¼Œè¿”å›ä¸‹ä¸€ä¸ªä½ç½®
  </enumerate>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define* (bytevector-advance-u8 bv index (end (length bv)))

    \ \ (if (\<gtr\>= index end)

    \ \ \ \ \ \ index \ ; Reached the end without errors, sequence is valid

    \ \ \ \ \ \ (let ((byte (bv index)))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ ;; 1-byte sequence (0xxxxxxx)

    \ \ \ \ \ \ \ \ \ ((\<less\> byte #x80)

    \ \ \ \ \ \ \ \ \ \ (+ index 1))

    \ \ \ \ \ \ \ \ \ \ \ 

    \ \ \ \ \ \ \ \ \ ;; 2-byte sequence (110xxxxx 10xxxxxx)

    \ \ \ \ \ \ \ \ \ ((\<less\> byte #xe0)

    \ \ \ \ \ \ \ \ \ \ (if (\<gtr\>= (+ index 1) end)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Incomplete sequence

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((next-byte (bv (+ index 1))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (not (= (logand next-byte #xc0) #x80))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Invalid continuation byte

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (+ index 2)))))

    \ \ \ \ \ \ \ \ \ \ \ 

    \ \ \ \ \ \ \ \ \ ;; 3-byte sequence (1110xxxx 10xxxxxx 10xxxxxx)

    \ \ \ \ \ \ \ \ \ ((\<less\> byte #xf0)

    \ \ \ \ \ \ \ \ \ \ (if (\<gtr\>= (+ index 2) end)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Incomplete sequence

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((next-byte1 (bytevector-u8-ref bv (+ index 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (next-byte2 (bytevector-u8-ref bv (+ index 2))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (or (not (= (logand next-byte1 #xc0) #x80))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (not (= (logand next-byte2 #xc0) #x80)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Invalid continuation byte(s)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (+ index 3)))))

    \ \ \ \ \ \ \ \ \ \ \ 

    \ \ \ \ \ \ \ \ \ ;; 4-byte sequence (11110xxx 10xxxxxx 10xxxxxx 10xxxxxx)

    \ \ \ \ \ \ \ \ \ ((\<less\> byte #xf8)

    \ \ \ \ \ \ \ \ \ \ (if (\<gtr\>= (+ index 3) end)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Incomplete sequence

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((next-byte1 (bv (+ index 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (next-byte2 (bv (+ index 2)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (next-byte3 (bv (+ index 3))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (or (not (= (logand next-byte1 #xc0) #x80))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (not (= (logand next-byte2 #xc0) #x80))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (not (= (logand next-byte3 #xc0) #x80)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index \ ; Invalid continuation byte(s)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (+ index 4)))))

    \ \ \ \ \ \ \ \ \ (else index))))) \ ; Invalid leading byte

    \;
  </scm-chunk>

  <subparagraph|å®ç°u8-string-length>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (u8-string-length str)

    \ \ (let ((bv (string-\<gtr\>byte-vector str))

    \ \ \ \ \ \ \ \ (N (string-length str)))

    \ \ \ \ (let loop ((pos 0) (cnt 0))

    \ \ \ \ \ \ (let ((next-pos (bytevector-advance-u8 bv pos N)))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ ((= next-pos N)

    \ \ \ \ \ \ \ \ \ \ (+ cnt 1))

    \ \ \ \ \ \ \ \ \ ((= next-pos pos)

    \ \ \ \ \ \ \ \ \ \ (error 'value-error "Invalid UTF-8 sequence at index: " pos))

    \ \ \ \ \ \ \ \ \ (else (loop next-pos (+ cnt 1))))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (u8-string-length "ä¸­æ–‡") =\<gtr\> 2)

    \;
  </scm-chunk>

  <subparagraph|å®ç°utf8-\<gtr\>string>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define* (utf8-\<gtr\>string bv (start 0) (end (bytevector-length bv)))

    \ \ (if (or (\<less\> start 0) (\<gtr\> end (bytevector-length bv)) (\<gtr\> start end))

    \ \ \ \ \ \ (error 'out-of-range start end)

    \ \ \ \ \ \ (let loop ((pos start))

    \ \ \ \ \ \ \ \ (let ((next-pos (bytevector-advance-u8 bv pos end)))

    \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ ((= next-pos end)

    \ \ \ \ \ \ \ \ \ \ \ \ (copy bv (make-string (- end start)) start end))

    \ \ \ \ \ \ \ \ \ \ \ ((= next-pos pos)

    \ \ \ \ \ \ \ \ \ \ \ \ (error 'value-error "Invalid UTF-8 sequence at index: " pos))

    \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ (loop next-pos)))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (utf8-\<gtr\>string <code|<code*|(bytevector #x48 #x65 #x6C #x6C #x6F)>>) =\<gtr\> "Hello")

    (check (utf8-\<gtr\>string #u8(#xC3 #xA4)) =\<gtr\> "Ã¤")

    (check (utf8-\<gtr\>string #u8(#xE4 #xB8 #xAD)) =\<gtr\> "ä¸­")

    (check (utf8-\<gtr\>string #u8(#xF0 #x9F #x91 #x8D)) =\<gtr\> "ğŸ‘")

    \;

    (check-catch 'value-error (utf8-\<gtr\>string (bytevector #xFF #x65 #x6C #x6C #x6F)))

    \;
  </scm-chunk>

  \;

  <subparagraph|å®ç°string-\<gtr\>utf8>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define* (string-\<gtr\>utf8 str (start 0) (end #t))

    \ \ ; start \<less\> end in this case

    \ \ (define (string-\<gtr\>utf8-sub str start end)

    \ \ \ \ (let ((bv (string-\<gtr\>byte-vector str))

    \ \ \ \ \ \ \ \ \ \ (N (string-length str)))

    \ \ \ \ \ \ (let loop ((pos 0) (cnt 0) (start-pos 0))

    \ \ \ \ \ \ \ \ (let ((next-pos (bytevector-advance-u8 bv pos N)))

    \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ ((and (not (zero? start)) (= cnt start))

    \ \ \ \ \ \ \ \ \ \ \ \ (loop next-pos (+ cnt 1) pos))

    \ \ \ \ \ \ \ \ \ \ \ ((and (integer? end) (= cnt end))

    \ \ \ \ \ \ \ \ \ \ \ \ (copy bv (make-byte-vector (- pos start-pos)) start-pos pos))

    \ \ \ \ \ \ \ \ \ \ \ ((and end (= next-pos N))

    \ \ \ \ \ \ \ \ \ \ \ \ (copy bv (make-byte-vector (- N start-pos)) start-pos N))

    \ \ \ \ \ \ \ \ \ \ \ ((= next-pos pos)

    \ \ \ \ \ \ \ \ \ \ \ \ (error 'value-error "Invalid UTF-8 sequence at index: " pos))

    \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ (loop next-pos (+ cnt 1) start-pos)))))))

    \;

    \ \ (when (\<less\> start 0)

    \ \ \ \ \ \ \ \ (error 'out-of-range "start must be greater than 0"))

    \ \ (when (and (integer? end) (\<gtr\>= end (string-length str)))

    \ \ \ \ \ \ \ \ (error 'out-of-range "end must be smaller than string length: "

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ end (string-length str)))

    \ \ (when (and (integer? end) (\<gtr\> start end))

    \ \ \ \ \ \ \ \ (error 'out-of-range "start \<less\>= end failed" start end))

    \ \ 

    \ \ (if (and (integer? end) (= start end))

    \ \ \ \ \ \ (byte-vector)

    \ \ \ \ \ \ (string-\<gtr\>utf8-sub str start end)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string-\<gtr\>utf8 "Hello") =\<gtr\> (bytevector #x48 #x65 #x6C #x6C #x6F))

    (check (string-\<gtr\>utf8 "Hello" 1 2) =\<gtr\> #u8(#x65))

    (check (string-\<gtr\>utf8 "Ã¤") =\<gtr\> #u8(#xC3 #xA4))

    (check (string-\<gtr\>utf8 "ä¸­") =\<gtr\> #u8(#xE4 #xB8 #xAD))

    (check (string-\<gtr\>utf8 "ğŸ‘") =\<gtr\> #u8(#xF0 #x9F #x91 #x8D))

    \;
  </scm-chunk>

  <section|æ§åˆ¶æµ>

  <paragraph|procedure?><index|procedure?>

  <paragraph|apply><index|apply>

  <scm|apply>æ˜¯R7RSå®šä¹‰çš„å‡½æ•°ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (apply + (list 3 4)) =\<gtr\> 7)

    (check (apply + (list 2 3 4)) =\<gtr\> 9)

    \;
  </scm-chunk>

  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<scm|(apply + (list 3 4))>å®é™…è¢«å±•å¼€ä¸º<scm|(+ 3 4)>ã€‚<scm|+>è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ— æ³•æ¥å—ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ©ç”¨<scm|apply>å°±å¯ä»¥æŠŠåˆ—è¡¨å±•å¼€å¹¶ä½œä¸º<scm|+>çš„ä¸¤ä¸ªå‚æ•°ã€‚

  <\big-figure|<scm|<tree|apply|+|(list 3 4)>><space|1em><math|\<Rightarrow\>><space|1em><scm|<tree|+|3|4>>>
    applyçš„åŸç†å¯è§†åŒ–
  </big-figure>

  <paragraph|call-with-current-continuation>

  <paragraph|call/cc>

  <paragraph|values>

  <value|r7rs><paragraph|call-with-values><scm|(producer consumer)>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (call-with-values (lambda () (values 4 5))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (x y) x))

    \ \ \ \ \ \ \ =\<gtr\> 4)

    \;
  </scm-chunk>

  ç”±äº<scm|*>è¿™ä¸ªå‡½æ•°åœ¨æ²¡æœ‰å‚æ•°æ—¶è¿”å›1ï¼Œè€Œ<scm|->åœ¨åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œè¿”å›è¯¥å€¼çš„ç›¸åæ•°ã€‚æ•…è€Œä¸‹é¢è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¿”å›å€¼æ˜¯<scm|-1>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (*) =\<gtr\> 1)

    (check (call-with-values * -) =\<gtr\> -1)

    \;
  </scm-chunk>

  <paragraph|receive><index|receive>

  å®˜ç½‘ï¼š<slink|https://srfi.schemers.org/srfi-8/srfi-8.html>

  å®˜ç½‘çš„å‚è€ƒå®ç°æ˜¯ï¼š

  <\scm-code>
    (define-syntax receive

    \ \ (syntax-rules ()

    \ \ \ \ ((receive formals expression body ...)

    \ \ \ \ \ (call-with-values (lambda () expression)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda formals body ...)))))
  </scm-code>

  ä½†æ˜¯S7 Schemeé‡Œé¢æ²¡æœ‰define-syntaxå’Œsyntax-ruleï¼Œåœ¨å¢¨å¹²ä¸­çš„å®ç°æ˜¯è¿™æ ·çš„ï¼š

  <\session|goldfish|default>
    <\folded-io>
      \<gtr\>\ 
    <|folded-io>
      (define-macro (receive vars vals . body)

      \ \ â€˜((lambda ,vars ,@body) ,vals)) ; GPL
    <|folded-io>
      receive
    </folded-io>

    <\folded-io>
      \<gtr\>\ 
    <|folded-io>
      (receive (a b) (values 1 2) (+ a b))
    <|folded-io>
      3
    </folded-io>

    <\folded-io>
      \<gtr\>\ 
    <|folded-io>
      ((lambda (a b) (+ a b)) 1 2)
    <|folded-io>
      3
    </folded-io>

    <\input>
      \<gtr\>\ 
    <|input>
      \;
    </input>
  </session>

  S7é‡Œé¢æœ‰<scm|call-with-values>ï¼Œä½¿ç”¨<scm|define-macro>å°±å¯ä»¥å®ç°SRFI-8ã€‚

  <\scm-chunk|goldfish/srfi/srfi-8.scm|false|false>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;

    (define-library (srfi srfi-8)

    (export receive) \ \ \ \ \ \ \ \ \ \ \ \ \ 

    (begin

    \;

    (define-macro (receive formals expression . body)

    \ \ â€˜(call-with-values

    \ \ \ \ (lambda () (values ,expression))

    \ \ \ \ (lambda ,formals ,@body)))

    \;

    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check

    \ \ (receive (a b) (values 1 2) (+ a b))

    \ \ =\<gtr\> 3)

    \;
  </scm-chunk>

  <paragraph|dynamic-wind>

  <section|å¼‚å¸¸å¤„ç†>

  <paragraph|guard><index|guard>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (raise . args)

    \ \ (apply throw #t args))

    \;

    (define-macro (guard results . body)

    \ \ â€˜(let ((,(car results)\ 

    \ \ \ \ \ \ \ \ \ \ (catch #t\ 

    \ \ \ \ \ \ \ \ \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,@body)\ 

    \ \ \ \ \ \ \ \ \ \ \ \ (lambda (type info)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (pair? (*s7* 'catches))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda () (apply throw type info))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car info))))))

    \ \ \ \ \ (cond ,@(cdr results)

    \ \ \ \ \ \ \ \ \ \ \ (else\ 

    \ \ \ \ \ \ \ \ \ \ \ \ (if (procedure? ,(car results))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (,(car results))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,(car results))))))

    \;
  </scm-chunk>

  æµ‹è¯•ç”¨ä¾‹

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (guard (condition

    \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ (display "condition: ")

    \ \ \ \ \ \ \ \ \ \ (write condition)

    \ \ \ \ \ \ \ \ \ \ (newline)

    \ \ \ \ \ \ \ \ \ \ 'exception))

    \ \ (+ 1 (raise 'an-error)))

    ; PRINTS: condition: an-error

    \;

    (guard (condition

    \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ (display "something went wrong")

    \ \ \ \ \ \ \ \ \ \ (newline)

    \ \ \ \ \ \ \ \ \ \ 'dont-care))

    \ (+ 1 (raise 'an-error)))

    ; PRINTS: something went wrong

    \;
  </scm-chunk>

  <paragraph|read-error?><index|read-error?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (read-error? obj) (eq? (car obj) 'read-error))

    \;
  </scm-chunk>

  <paragraph|file-error?><index|file-error?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (file-error? obj) (eq? (car obj) 'io-error))

    \;
  </scm-chunk>

  <section|è¾“å…¥å’Œè¾“å‡º>

  <subsection|ç«¯å£>

  <paragraph|call-with-port><index|call-with-port>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (call-with-port port proc)

    \ \ (let ((res (proc port)))

    \ \ \ \ (if res (close-port port))

    \ \ \ \ res))

    \;
  </scm-chunk>

  <paragraph|input-port?><index|input-port?>

  S7å†…ç½®å‡½æ•°ã€‚

  <paragraph|output-port?><index|output-port?>

  S7å†…ç½®å‡½æ•°ã€‚

  <paragraph|port?><index|port?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (port? p) (or (input-port? p) (output-port? p)))

    \;
  </scm-chunk>

  <paragraph|textual-port?><index|textual-port?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define textual-port? port?)

    \;
  </scm-chunk>

  <paragraph|binary-port?><index|binary-port?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define binary-port? port?)

    \;
  </scm-chunk>

  <paragraph|input-port-open?><index|input-port-open?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (input-port-open? p) (not (port-closed? p)))

    \;
  </scm-chunk>

  <paragraph|output-port-open?><index|output-port-open?>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (output-port-open? p) (not (port-closed? p)))

    \;
  </scm-chunk>

  <paragraph|close-port><index|close-port>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (close-port p)

    \ \ (if (input-port? p)

    \ \ \ \ \ \ (close-input-port p)

    \ \ \ \ \ \ (close-output-port p)))

    \;
  </scm-chunk>

  <paragraph|close-input-port><index|close-input-port>

  S7å†…ç½®å‡½æ•°ã€‚

  <paragraph|close-output-port><index|close-output-port>

  S7å†…ç½®å‡½æ•°ã€‚

  <subsection|è¾“å…¥>

  <value|r7rs><paragraph|read><index|read>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (with-input-from-string "(+ 1 2)"

    \ \ (lambda ()

    \ \ \ \ (let ((datum (read)))\ 

    \ \ \ \ \ \ (check-true (list? datum))

    \ \ \ \ \ \ (check datum =\<gtr\> '(+ 1 2)))))

    \;
  </scm-chunk>

  <paragraph|read-char>

  <paragraph|peek-char>

  <paragraph|read-line>

  <paragraph|eof-object?>

  <paragraph|eof-object><index|eof-object>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (eof-object) #\<less\>eof\<gtr\>)

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (eof-object) =\<gtr\> #\<less\>eof\<gtr\>)

    \;
  </scm-chunk>

  <paragraph|char-ready?>

  <paragraph|read-string>

  <paragraph|read-u8>

  <paragraph|peek-u8>

  <paragraph|u8-ready?>

  <paragraph|read-bytevector>

  <paragraph|read-bytevector!>

  <subsection|è¾“å‡º>

  <section|ç³»ç»Ÿæ¥å£>

  <section|ä¸‰é²¤æ‰©å±•åº“>

  <paragraph|==><index|==><scm|(x y) =\<gtr\> bool>

  <scm|equal?>çš„è¯­æ³•ç³–ã€‚

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define == equal?)

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (== (list 1 2) (list 1 2)) =\<gtr\> #t)

    (check (!= (list 1 2) (list 1 2)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|!=><index|!=><scm|(x y) =\<gtr\> bool>

  è¯­æ³•ç³–ã€‚

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define (!= left right)

    \ \ (not (equal? left right)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (== (list 1 2) (list 1 2)) =\<gtr\> #t)

    (check (!= (list 1 2) (list 1 2)) =\<gtr\> #f)

    \;
  </scm-chunk>

  \;

  <paragraph|display*><index|display*><scm|(x y z ...) =\<gtr\> \<less\>#unspecified\<gtr\>>

  <scm|display*>å¯ä»¥è¾“å…¥å¤šä¸ªå‚æ•°ï¼Œæ˜¯<scm|display>çš„åŠ å¼ºç‰ˆã€‚

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define (display* . params)

    \ \ (for-each display params))

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check

    \ \ (with-output-to-string

    \ \ \ \ (lambda ()

    \ \ \ \ \ \ (display* "hello world" "\\n")))

    \ \ =\<gtr\> "hello world\\n")

    \;
  </scm-chunk>

  <paragraph|in?><index|in?><scm|(x sequence) =\<gtr\> bool>

  åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨å¯¹è±¡ä¸­ï¼š

  <\enumerate>
    <item>ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­

    <item>ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨å‘é‡ä¸­

    <item>ä¸€ä¸ªå­—ç¬¦æ˜¯å¦åœ¨å­—ç¬¦ä¸²ä¸­
  </enumerate>

  å…¶ä¸­çš„ç›¸ç­‰æ€§åˆ¤æ–­ä½¿ç”¨çš„æ˜¯<scm|==>ï¼Œä¹Ÿå°±æ˜¯R7RSå®šä¹‰çš„<scm|equal?>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (in? 1 (list )) =\<gtr\> #f)

    (check (in? 1 (list 3 2 1)) =\<gtr\> #t)

    (check (in? #\\x "texmacs") =\<gtr\> #t)

    (check (in? 1 (vector )) =\<gtr\> #f)

    (check (in? 1 (vector 3 2 1)) =\<gtr\> #t)

    (check-catch 'type-error (in? 1 "123"))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define (in? elem l)

    \ \ (cond ((list? l) (not (not (member elem l))))

    \ \ \ \ \ \ \ \ ((vector? l)

    \ \ \ \ \ \ \ \ \ (let loop ((i (- (vector-length l) 1)))

    \ \ \ \ \ \ \ \ \ \ \ (if (\<less\> i 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #f

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (== elem (vector-ref l i))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (- i 1))))))

    \ \ \ \ \ \ \ \ ((and (char? elem) (string? l))

    \ \ \ \ \ \ \ \ \ (in? elem (string-\<gtr\>list l)))

    \ \ \ \ \ \ \ \ (else (error 'type-error "type mismatch"))))

    \;
  </scm-chunk>

  <paragraph|let1><index|let1>

  letçš„è¯­æ³•åµŒå¥—å±‚æ¬¡å¤ªå¤šäº†ï¼Œæ•…è€Œå¼•å…¥let1ï¼Œä½œä¸ºletçš„å•å‚æ•°ç‰ˆæœ¬ï¼Œç®€åŒ–è¯­æ³•ã€‚

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define-macro (let1 name1 value1 . body)

    \ \ â€˜(let ((,name1 ,value1))

    \ \ \ \ \ ,@body))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (let1 x 1 x) =\<gtr\> 1)

    (check (let1 x 1 (+ x 1)) =\<gtr\> 2)

    \;
  </scm-chunk>

  <paragraph|identity><index|identity><scm|(x) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define identity (lambda (x) x))

    \;
  </scm-chunk>

  <paragraph|compose><index|compose><scm|(f g ...) =\<gtr\> f>

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    (define (compose . fs)

    \ \ (if (null? fs)

    \ \ \ \ \ \ (lambda (x) x)

    \ \ \ \ \ \ (lambda (x)

    \ \ \ \ \ \ \ \ ((car fs) ((apply compose (cdr fs)) x)))))

    \ \ 
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true ((compose not zero?) 1))

    (check-false ((compose not zero?) 0))

    \;
  </scm-chunk>

  <paragraph|typed-lambda><index|typed-lambda>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/liii/base.scm|true|true>
    ; 0 clause BSD, from S7 repo stuff.scm

    (define-macro (typed-lambda args . body)

    \ \ ; (typed-lambda ((var [type])...) ...)

    \ \ (if (symbol? args)

    \ \ \ \ \ \ (apply lambda args body)

    \ \ \ \ \ \ (let ((new-args (copy args)))

    \ \ \ \ \ \ \ \ (do ((p new-args (cdr p)))

    \ \ \ \ \ \ \ \ \ \ \ \ ((not (pair? p)))

    \ \ \ \ \ \ \ \ \ \ (if (pair? (car p))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (set-car! p (caar p))))

    \ \ \ \ \ \ \ \ â€˜(lambda ,new-args

    \ \ \ \ \ \ \ \ \ \ \ ,@(map (lambda (arg)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (pair? arg)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(unless (,(cadr arg) ,(car arg))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (error 'type-error

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "~S is not ~S~%" ',(car arg) ',(cadr arg)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (values)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ args)

    \ \ \ \ \ \ \ \ \ \ \ ,@body))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (define add3

    \ \ (typed-lambda

    \ \ \ \ ((i integer?) (x real?) z)

    \ \ \ \ (+ i x z)))

    \;

    (check (add3 1 2 3) =\<gtr\> 6)

    (check-catch 'type-error (add3 1.2 2 3))

    \;
  </scm-chunk>

  \;

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/base.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii error)>

  å¼‚å¸¸çš„å‘½åå‚è€ƒPythonæ ‡å‡†åº“çš„<hlink|å†…ç½®å¼‚å¸¸|https://docs.python.org/3/library/exceptions.html>ã€‚

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/error.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    ; see https://docs.python.org/3/library/exceptions.html#exception-hierarchy

    (define-library (liii error)

    (export ???

    \ \ os-error file-not-found-error not-a-directory-error file-exists-error

    \ \ timeout-error

    \ \ type-error type-error? value-error)

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (liii error)

    \ \ \ \ \ \ \ \ (liii base))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <section|å®ç°>

  <paragraph|os-error><index|os-error>

  ç³»ç»Ÿçº§åˆ«çš„é”™è¯¯ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (os-error . args)

    \ \ (apply error (cons 'os-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'os-error (os-error))

    \;
  </scm-chunk>

  <paragraph|file-not-found-error><index|file-not-found-error>

  æ–‡ä»¶æœªæ‰¾åˆ°ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (file-not-found-error . args)

    \ \ (apply error (cons 'file-not-found-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'file-not-found-error (file-not-found-error))

    \;
  </scm-chunk>

  <paragraph|not-a-directory-error><index|not-a-directory-error>

  ä¸æ˜¯ä¸€ä¸ªç›®å½•ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (not-a-directory-error . args)

    \ \ (apply error (cons 'not-a-directory-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'not-a-directory-error (not-a-directory-error))

    \;
  </scm-chunk>

  <paragraph|file-exists-error><index|file-exists-error>

  æ–‡ä»¶å·²å­˜åœ¨ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (file-exists-error . args)

    \ \ (apply error (cons 'file-exists-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'file-exists-error (file-exists-error))

    \;
  </scm-chunk>

  <paragraph|timeout-error><index|timeout-error>

  è¶…æ—¶é”™è¯¯ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (timeout-error . args)

    \ \ (apply error (cons 'timeout-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'timeout-error (timeout-error))

    \;
  </scm-chunk>

  <paragraph|type-error><index|type-error>

  å¦‚æœç±»å‹ä¸åŒ¹é…ï¼Œç›´æ¥æŠ¥é”™ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (type-error . args)

    \ \ (apply error (cons 'type-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'type-error (type-error))

    (check-catch 'type-error (type-error "msg"))

    (check-catch 'type-error (type-error "msg" "msg2"))

    \;
  </scm-chunk>

  <paragraph|type-error?><index|type-error?>

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (type-error? err)

    \ \ (in? err â€˜(type-error wrong-type-arg)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-true (type-error? 'type-error))

    (check-true (type-error? 'wrong-type-arg))

    \;
  </scm-chunk>

  <paragraph|value-error><index|value-error>

  å€¼ä¸æ­£ç¡®

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (value-error . args)

    \ \ (apply error (cons 'value-error args)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'value-error (value-error))

    \;
  </scm-chunk>

  <paragraph|???><index|???>

  Scalaé£æ ¼æœªå®ç°é”™è¯¯ï¼Œä¸€èˆ¬ç”¨äºæ ‡è®°ä¸ºå®ç°çš„æ¥å£ã€‚

  <\scm-chunk|goldfish/liii/error.scm|true|true>
    (define (???)

    \ \ (error 'not-implemented-error "???"))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|true>
    (check-catch 'not-implemented-error (???))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/error.scm|true|false>
    ) ; begin

    ) ; define-library

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/error-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii check)>

  <section|åè®®>

  <\scm-chunk|goldfish/liii/check.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-78.scm|false|true>
    ; \<less\>PLAINTEXT\<gtr\>

    ; Copyright (c) 2005-2006 Sebastian Egner.

    ;\ 

    ; Permission is hereby granted, free of charge, to any person obtaining

    ; a copy of this software and associated documentation files (the

    ; ''Software''), to deal in the Software without restriction, including

    ; without limitation the rights to use, copy, modify, merge, publish,

    ; distribute, sublicense, and/or sell copies of the Software, and to

    ; permit persons to whom the Software is furnished to do so, subject to

    ; the following conditions:

    ;\ 

    ; The above copyright notice and this permission notice shall be

    ; included in all copies or substantial portions of the Software.

    ;\ 

    ; THE SOFTWARE IS PROVIDED â€˜â€˜AS IS'', WITHOUT WARRANTY OF ANY KIND,

    ; EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF

    ; MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND

    ; NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE

    ; LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION

    ; OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION

    ; WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

    ;\ 

    ; -----------------------------------------------------------------------

    ;\ 

    ; Lightweight testing (reference implementation)

    ; ==============================================

    ;

    ; Sebastian.Egner@philips.com

    ; in R5RS + SRFI 23 (error) + SRFI 42 (comprehensions)

    ;

    ; history of this file:

    ; \ \ SE, 25-Oct-2004: first version based on code used in SRFIs 42 and 67

    ; \ \ SE, 19-Jan-2006: (arg ...) made optional in check-ec

    ;

    ; Naming convention "check:\<less\>identifier\<gtr\>" is used only internally.

    ;

    ; Copyright (c) 2024 The Goldfish Scheme Authors

    ; Follow the same License as the original one

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  \;

  <section|æ¥å£>

  å°†<scm|check:proc>å¯¼å‡ºçš„åŸå› æ˜¯<scm|check>æ˜¯ä½¿ç”¨å®å®ç°çš„ï¼Œè€Œå®é‡Œé¢ç”¨åˆ°äº†<scm|check:proc>ï¼Œä¸å¯¼å‡ºæ— æ³•ç”Ÿæ•ˆã€‚

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define-library (liii check)

    (export test check check-set-mode! check:proc

    \ \ check-catch check-report check-failed?

    \ \ check-true check-false)

    (import (srfi srfi-78)

    \ \ \ \ \ \ \ \ (rename (srfi srfi-78)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check-report srfi-78-check-report)))

    (begin

    \;
  </scm-chunk>

  \;

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define-library (srfi srfi-78)

    (export check check-set-mode! check-report check-reset!

    \ \ \ \ \ \ \ \ check-passed? check-failed?

    \ \ \ \ \ \ \ \ check:proc)

    (begin

    \;
  </scm-chunk>

  \;

  \;

  \;

  <section|å®ç°>

  ä½¿ç”¨displayä½œä¸ºæµ‹è¯•ç»“æœçš„å±•ç¤ºå‡½æ•°ï¼Œæ¯”writeå¥½ï¼Œå› ä¸ºdisplayå¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ–‡æœ¬ä¸­çš„æ±‰å­—ã€‚

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define check:write display)

    \;
  </scm-chunk>

  <paragraph|check-set-mode!><index|check-set-mode!>

  \;

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define check:mode #f)

    \;

    (define (check-set-mode! mode)

    \ \ (set! check:mode

    \ \ \ \ \ \ \ \ (case mode

    \ \ \ \ \ \ \ \ \ \ ((off) \ \ \ \ \ \ \ \ \ \ 0)

    \ \ \ \ \ \ \ \ \ \ ((summary) \ \ \ \ \ \ 1)

    \ \ \ \ \ \ \ \ \ \ ((report-failed) 10)

    \ \ \ \ \ \ \ \ \ \ ((report) \ \ \ \ \ \ \ 100)

    \ \ \ \ \ \ \ \ \ \ (else (error "unrecognized mode" mode)))))

    \;

    \;
  </scm-chunk>

  å°†æ£€æŸ¥æ¨¡å¼åˆå§‹åŒ–ä¸º<scm|'report>ï¼š

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (check-set-mode! 'report)

    \;
  </scm-chunk>

  ä»¥<scm|check>å‡½æ•°ä¸ºä¾‹ï¼Œä¸åŒçš„æ£€æŸ¥æ¨¡å¼ä¸‹ï¼Œå¾—åˆ°çš„ç»“æœä¸åŒã€‚å¯ä»¥ä½¿ç”¨å•å…ƒæµ‹è¯•æ¥æŸ¥çœ‹è¿™å››ç§æµ‹è¯•ç”¨ä¾‹å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼š

  <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|true>
    (import (srfi srfi-78))

    \;
  </scm-chunk>

  <\description>
    <item*|report>é»˜è®¤æ£€æŸ¥æ¨¡å¼ï¼Œæ— è®ºæ­£ç¡®è¿˜æ˜¯é”™è¯¯ï¼Œéƒ½ä¼šå±•ç¤ºè¯¦ç»†çš„ä¿¡æ¯ã€‚

    <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|true>
      ;

      ; Copyright (C) 2024 The Goldfish Scheme Authors

      ;

      ; Licensed under the Apache License, Version 2.0 (the "License");

      ; you may not use this file except in compliance with the License.

      ; You may obtain a copy of the License at

      ;

      ; http://www.apache.org/licenses/LICENSE-2.0

      ;

      ; Unless required by applicable law or agreed to in writing, software

      ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

      ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

      ; License for the specific language governing permissions and limitations

      ; under the License.

      ;

      \;

      (display "----------\\n")

      (display "check mode: report\\n")

      \;

      (check-set-mode! 'report)

      \;

      (check (+ 1 2) =\<gtr\> 3)

      \;

      (check (+ 1 2) =\<gtr\> 4)

      \;

      (check-reset!)

      \;
    </scm-chunk>

    <item*|off>è®¾ç½®ä¸ºoffçš„æ—¶å€™ï¼Œç¦ç”¨åç»­çš„æµ‹è¯•ç”¨ä¾‹ã€‚

    <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|true>
      (display "\\n----------\\n")

      (display "check mode: off\\n")

      \;

      (check-set-mode! 'off)

      \;

      (check (+ 1 2) =\<gtr\> 3)

      \;

      (check (+ 1 2) =\<gtr\> 4)

      \;

      (check-reset!)

      \;
    </scm-chunk>

    <item*|report-failed>è®¾ç½®ä¸ºreport-failedçš„æ—¶å€™ï¼Œåœ¨checkæ­£ç¡®æ—¶åªè¿”å›æ­£ç¡®çš„æµ‹è¯•æ•°é‡ï¼Œåœ¨checké”™è¯¯æ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯ã€‚

    <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|true>
      (display "\\n----------\\n")

      (display "check mode: report-failed\\n")

      \;

      (check-set-mode! 'report-failed)

      \;

      (check (+ 1 2) =\<gtr\> 3)

      \;

      (check (+ 1 2) =\<gtr\> 4)

      \;

      (check-reset!)

      \;
    </scm-chunk>

    <item*|summary>è®¾ç½®ä¸ºsummaryçš„æ—¶å€™ï¼Œä¸æ±‡æŠ¥é”™è¯¯ï¼Œéœ€è¦æ˜¾ç¤ºè°ƒç”¨<scm|check-report>æ‰èƒ½æ˜¾ç¤ºçš„æµ‹è¯•æ±‡æ€»ç»“æœï¼Œæ˜¾å¼è°ƒç”¨<scm|check:failed>æ˜¾å¼æŸ¥çœ‹é”™è¯¯çš„ä¾‹å­ã€‚

    <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|true>
      (display "\\n----------\\n")

      (display "check mode: summary\\n")

      \;

      (check-set-mode! 'summary)

      \;

      (check (+ 1 2) =\<gtr\> 3)

      \;

      (check (+ 1 2) =\<gtr\> 4)

      \;

      (check-report)

      \;
    </scm-chunk>

    è¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦æŸ¥çœ‹é”™è¯¯ï¼Œé‚£ä¹ˆå¯ä»¥é‡æ–°è®¾ç½®æ£€æŸ¥æ¨¡å¼ï¼Œé‡æ–°æ£€æŸ¥æŠ¥å‘Šï¼š

    <\scm-chunk|tests/goldfish/srfi/srfi-78-test.scm|true|false>
      (check-set-mode! 'report)

      \;

      (check-report)

      \;
    </scm-chunk>
  </description>

  <paragraph|check-failed?><index|check-failed?>

  \;

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define check:correct 0)

    (define check:failed '())

    \;

    (define (check-reset!)

    \ \ (set! check:correct 0)

    \ \ (set! check:failed '()))

    \;

    (define (check:add-correct!)

    \ \ (set! check:correct (+ check:correct 1)))

    \;

    (define (check:add-failed! expression actual-result expected-result)

    \ \ (set! check:failed

    \ \ \ \ \ \ \ \ (cons (list expression actual-result expected-result)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ check:failed)))

    \;
  </scm-chunk>

  \;

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define (check:report-expression expression)

    \ \ (newline)

    \ \ (check:write expression)

    \ \ (display " =\<gtr\> "))

    \;

    (define (check:report-actual-result actual-result)

    \ \ (check:write actual-result)

    \ \ (display " ; "))

    \;

    (define (check:report-correct cases)

    \ \ (display "correct")

    \ \ (if (not (= cases 1))

    \ \ \ \ \ \ (begin (display " (")

    \ \ \ \ \ \ \ \ \ \ \ \ \ (display cases)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (display " cases checked)")))

    \ \ (newline))

    \;

    (define (check:report-failed expected-result)

    \ \ (display "*** failed ***")

    \ \ (newline)

    \ \ (display "; expected result: ")

    \ \ (check:write expected-result)

    \ \ (newline))

    \;

    (define (check-passed? expected-total-count)

    \ \ (and (= (length check:failed) 0)

    \ \ \ \ \ \ \ (= check:correct expected-total-count)))

    \;

    (define (check-failed?)

    \ \ (\<gtr\>= (length check:failed) 1))

    \;
  </scm-chunk>

  <paragraph|check><index|check>

  checkçš„å…·ä½“è¿‡ç¨‹ï¼Œä¾æ®ä¸åŒçš„æ£€æŸ¥æ¨¡å¼ï¼Œåšä¸åŒçš„å¤„ç†ï¼š

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define (check:proc expression thunk equal expected-result)

    \ \ (case check:mode

    \ \ \ \ ((0) #f)

    \ \ \ \ ((1)

    \ \ \ \ \ (let ((actual-result (thunk)))

    \ \ \ \ \ \ \ (if (equal actual-result expected-result)

    \ \ \ \ \ \ \ \ \ \ \ (check:add-correct!)

    \ \ \ \ \ \ \ \ \ \ \ (check:add-failed! expression actual-result expected-result))))

    \ \ \ \ ((10)

    \ \ \ \ \ (let ((actual-result (thunk)))

    \ \ \ \ \ \ \ (if (equal actual-result expected-result)

    \ \ \ \ \ \ \ \ \ \ \ (check:add-correct!)

    \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-expression expression)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-actual-result actual-result)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-failed expected-result)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (check:add-failed! expression actual-result expected-result)))))

    \ \ \ \ ((100)

    \ \ \ \ \ (check:report-expression expression)

    \ \ \ \ \ (let ((actual-result (thunk)))

    \ \ \ \ \ \ \ (check:report-actual-result actual-result)

    \ \ \ \ \ \ \ (if (equal actual-result expected-result)

    \ \ \ \ \ \ \ \ \ \ \ (begin (check:report-correct 1)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check:add-correct!))

    \ \ \ \ \ \ \ \ \ \ \ (begin (check:report-failed expected-result)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check:add-failed! expression\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ actual-result\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expected-result)))))

    \ \ \ \ (else (error "unrecognized check:mode" check:mode))))

    \;
  </scm-chunk>

  checkçš„æ¥å£å®ç°ï¼Œä½¿ç”¨S7 Schemeçš„<scm|define-macro>å®ç°ï¼š

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define-macro (check expr =\<gtr\> expected)

    \ \ â€˜(check:proc ',expr (lambda () ,expr) equal? ,expected))

    \;
  </scm-chunk>

  <paragraph|check-true><index|check-true>

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define-macro (check-true body)

    \ \ â€˜(check ,body =\<gtr\> #t))

    \;
  </scm-chunk>

  <paragraph|check-false><index|check-false>

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define-macro (check-false body)

    \ \ â€˜(check ,body =\<gtr\> #f))

    \;
  </scm-chunk>

  <paragraph|check-catch><index|check-catch>

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define-macro (check-catch error-id body)

    \ \ â€˜(check

    \ \ \ \ (catch ,error-id

    \ \ \ \ \ \ (lambda () ,body)

    \ \ \ \ \ \ (lambda args ,error-id))

    \ \ \ \ \ \ =\<gtr\> ,error-id))

    \;
  </scm-chunk>

  <paragraph|test><index|test><scm|(obj1 obj2) =\<gtr\> boolean>

  <scm|test>å‡½æ•°æ˜¯ä¸ºäº†å…¼å®¹S7 Schemeä»“åº“é‡Œé¢çš„æµ‹è¯•ç”¨ä¾‹ã€‚

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define-macro (test left right)

    \ \ â€˜(check ,left =\<gtr\> ,right))

    \;
  </scm-chunk>

  <paragraph|check-report><index|check-report>

  <\scm-chunk|goldfish/liii/check.scm|true|true>
    (define (check-report . msg)

    \ \ (if (not (null? msg))

    \ \ \ \ (begin

    \ \ \ \ \ \ (display (car msg))))

    \ \ (srfi-78-check-report)

    \ \ (if (check-failed?) (exit -1)))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|true>
    (define (check-report)

    \ \ (if (\<gtr\>= check:mode 1)

    \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ (newline)

    \ \ \ \ \ \ \ \ (display "; *** checks *** : ")

    \ \ \ \ \ \ \ \ (display check:correct)

    \ \ \ \ \ \ \ \ (display " correct, ")

    \ \ \ \ \ \ \ \ (display (length check:failed))

    \ \ \ \ \ \ \ \ (display " failed.")

    \ \ \ \ \ \ \ \ (if (or (null? check:failed) (\<less\>= check:mode 1))

    \ \ \ \ \ \ \ \ \ \ \ \ (newline)

    \ \ \ \ \ \ \ \ \ \ \ \ (let* ((w (car (reverse check:failed)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (expression (car w))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (actual-result (cadr w))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (expected-result (caddr w)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (display " First failed example:")

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (newline)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-expression expression)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-actual-result actual-result)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (check:report-failed expected-result))))))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/srfi/srfi-78.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/check.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <chapter|(liii case)>

  <scm|case*>å…‹æœäº†R7RSä¸­<scm|case>æ— æ³•å¤„ç†å­—ç¬¦ä¸²ç­‰çš„ç¼ºç‚¹ã€‚

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/case-test.scm|false|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (liii case))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <paragraph|case*><index|case*>

  <\scm-chunk|tests/goldfish/liii/case-test.scm|true|true>
    ; 0 clause BSD, from S7 repo s7test.scm

    (define (scase x)

    \ \ (case* x

    \ \ \ \ ((a b) 'a-or-b)

    \ \ \ \ ((1 2/3 3.0) =\<gtr\> (lambda (a) (* a 2)))

    \ \ \ \ ((pi) 1 123)

    \ \ \ \ (("string1" "string2"))

    \ \ \ \ ((#\<less\>symbol?\<gtr\>) 'symbol!)

    \ \ \ \ (((+ x #\<less\>symbol?\<gtr\>)) 'got-list)

    \ \ \ \ ((#(1 x 3)) 'got-vector)

    \ \ \ \ (((+ #\<less\>\<gtr\>)) 'empty)

    \ \ \ \ (((* #\<less\>x:symbol?\<gtr\> #\<less\>x\<gtr\>)) 'got-label)

    \ \ \ \ (((#\<less\>\<gtr\> #\<less\>x:\<gtr\> #\<less\>x\<gtr\>)) 'repeated)

    \ \ \ \ (((#\<less\>symbol?\<gtr\> #\<less\>symbol?\<gtr\>)) 'two)

    \ \ \ \ (((#\<less\>x:\<gtr\> #\<less\>x\<gtr\>)) 'pair)

    \ \ \ \ ((#(#\<less\>x:\<gtr\> #\<less\>x\<gtr\>)) 'vector)

    \ \ \ \ ((#(#\<less\>symbol?\<gtr\> #\<less\>...\<gtr\> #\<less\>number?\<gtr\>)) 'vectsn)

    \ \ \ \ ((#(#\<less\>...\<gtr\> #\<less\>number?\<gtr\>)) 'vectstart)

    \ \ \ \ ((#(#\<less\>string?\<gtr\> #\<less\>char-whitespace?\<gtr\> #\<less\>...\<gtr\>)) 'vectstr)

    \ \ \ \ (else 'oops)))

    \;

    (test (scase 3.0) 6.0)

    (test (scase 'pi) 123)

    (test (scase "string1") "string1")

    (test (scase "string3") 'oops)

    (test (scase 'a) 'a-or-b)

    (test (scase 'abc) 'symbol!)

    (test (scase #()) 'oops)

    (test (scase '(+ x z)) 'got-list)

    (test (scase #(1 x 3)) 'got-vector)

    (test (scase '(+ x 3)) 'oops)

    (test (scase '(+ x)) 'empty)

    (test (scase '(* z z)) 'got-label)

    (test (scase '(* z x)) 'oops)

    (test (scase '(+ (abs x) (abs x))) 'repeated)

    (test (scase '(+ (abs x) (abs y))) 'oops)

    (test (scase '(a b)) 'two)

    (test (scase '(1 1)) 'pair)

    (test (scase '(1 1 2)) 'oops)

    (test (scase #(1 1)) 'vector)

    (test (scase #(a b c 3)) 'vectsn)

    (test (scase #(1 b 2)) 'vectstart)

    (test (scase #("asdf" #\\space +nan.0 #\<less\>eof\<gtr\>)) 'vectstr)

    (test (scase #(a 3)) 'vectsn)

    (test (scase #(1)) 'vectstart)

    (test (scase #("asdf" #\\space)) 'vectstr)

    (test (scase #("asdf")) 'oops)

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|tests/goldfish/liii/case-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii string)><label|chapter:liii_string>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/string.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/string.scm|true|false>
    (define-library (liii string)

    (export

    \ \ ; S7 built-in

    \ \ string? string-ref string-length

    \ \ ; from (scheme base)

    \ \ string-copy string-for-each string-map

    \ \ ; from (srfi srfi-13)

    \ \ string-null? string-join

    \ \ string-every string-any

    \ \ string-take string-take-right string-drop string-drop-right

    \ \ string-pad string-pad-right

    \ \ string-trim string-trim-right string-trim-both

    \ \ string-prefix? string-suffix?

    \ \ string-index string-index-right

    \ \ string-contains string-count

    \ \ string-reverse

    \ \ string-tokenize

    )

    (import (srfi srfi-13)

    \ \ \ \ \ \ \ \ (scheme base)

    \ \ \ \ \ \ \ \ (liii error))

    (begin

    ) ; end of begin

    ) ; end of library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define-library (srfi srfi-13)

    \ \ (import

    \ \ \ \ (scheme base)

    \ \ \ \ (srfi srfi-1))

    \ \ (export

    \ \ \ \ string-null? string-copy string-join

    \ \ \ \ string-every string-any

    \ \ \ \ string-take string-take-right string-drop string-drop-right\ 

    \ \ \ \ string-pad string-pad-right

    \ \ \ \ string-trim string-trim-right string-trim-both

    \ \ \ \ string-prefix? string-suffix?\ 

    \ \ \ \ string-index string-index-right

    \ \ \ \ string-contains string-count

    \ \ \ \ string-reverse

    \ \ \ \ string-tokenize)

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (liii string))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <section|å†…éƒ¨å…¬å…±å­å‡½æ•°>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (%string-from-range str start_end)

    \ \ (cond ((null-list? start_end) str)

    \ \ \ \ \ \ \ \ ((= (length start_end) 1)

    \ \ \ \ \ \ \ \ \ \ (substring str (car start_end)))

    \ \ \ \ \ \ \ \ ((= (length start_end) 2)

    \ \ \ \ \ \ \ \ \ (substring str (first start_end) (second start_end)))

    \ \ \ \ \ \ \ \ (else (error 'wrong-number-of-args "%string-from-range"))))

    \;
  </scm-chunk>

  <todo|æµ‹è¯•ä¸€ä¸‹è¾¹ç•Œæ¡ä»¶ï¼Œè¿™æ ·åé¢æ¼æµ‹ä¹Ÿæ²¡å…³ç³»äº†ã€‚>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (%make-criterion char/pred?)

    \ \ (cond ((char? char/pred?) (lambda (x) (char=? x char/pred?)))

    \ \ \ \ \ \ \ \ ((procedure? char/pred?) char/pred?)

    \ \ \ \ \ \ \ \ (else (error 'wrong-type-arg "%make-criterion"))))

    \;
  </scm-chunk>

  <section|è°“è¯>

  <r7rs><paragraph|string?><index|string?>

  <scm|string?>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„è°“è¯å‡½æ•°ï¼Œå½“ä¸”ä»…å½“å‚æ•°å¯¹è±¡ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚<scm|"MathAgape">ï¼‰æ—¶è¿”å›<scm|#t>ï¼Œå¦åˆ™éƒ½è¿”å›<scm|#f>ã€‚å½“å‚æ•°ä¸ºç¬¦å·ï¼ˆä¾‹å¦‚<scm|'MathAgape>ï¼‰ã€å­—ç¬¦ï¼ˆä¾‹å¦‚<scm|#/MathAgape>ï¼‰ã€æ•°å­—ï¼ˆä¾‹å¦‚<scm|123>ï¼‰ã€åˆ—è¡¨ï¼ˆä¾‹å¦‚<scm|'(1 2 3)>ï¼‰è¿™äº›éå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œéƒ½è¿”å›<scm|#f>ã€‚<scm|string?>ç”¨äºç¡®å®šå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å½“ä½œå­—ç¬¦ä¸²å¤„ç†ï¼Œåœ¨éœ€è¦æ‰§è¡Œå¯¹å­—ç¬¦ä¸²ç‰¹å®šæ“ä½œæ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œé¿å…ç±»å‹é”™è¯¯ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string? "MathAgape") =\<gtr\> #t)

    (check (string? "") =\<gtr\> #t)

    \;

    (check (string? 'MathAgape) =\<gtr\> #f)

    (check (string? #/MathAgape) =\<gtr\> #f)

    (check (string? 123) =\<gtr\> #f)

    (check (string? '(1 2 3)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <section|åˆ—è¡¨-å­—ç¬¦ä¸²è½¬æ¢>

  <r7rs><paragraph|string-\<gtr\>list><index|string-\<gtr\>list>

  <scm|string-\<gtr\>list>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦åˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string-\<gtr\>list "MathAgape")

    \ \ =\<gtr\> '(#\\M #\\a #\\t #\\h #\\A #\\g #\\a #\\p #\\e))

    \;

    (check (string-\<gtr\>list "") =\<gtr\> '())

    \;
  </scm-chunk>

  <r7rs><paragraph|list-\<gtr\>string><index|list-\<gtr\>string>

  <scm|list-\<gtr\>string>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œç”¨äºå°†å­—ç¬¦åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check

    \ \ (list-\<gtr\>string '(#\\M #\\a #\\t #\\h #\\A #\\g #\\a #\\p #\\e))

    \ \ =\<gtr\> "MathAgape")

    \;

    (check (list-\<gtr\>string '()) =\<gtr\> "")

    \;
  </scm-chunk>

  <paragraph|string-join><scm|(l [delim [grammer]]) =\<gtr\> string><index|string-join>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-join l . delim+grammer)

    \ \ (define (extract-params params-l)

    \ \ \ \ (cond ((null-list? params-l)

    \ \ \ \ \ \ \ \ \ \ \ (list "" 'infix))

    \ \ \ \ \ \ \ \ \ \ ((and (= (length params-l) 1)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string? (car params-l)))

    \ \ \ \ \ \ \ \ \ \ \ (list (car params-l) 'infix))

    \ \ \ \ \ \ \ \ \ \ ((and (= (length params-l) 2)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string? (first params-l))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (symbol? (second params-l)))

    \ \ \ \ \ \ \ \ \ \ \ params-l)

    \ \ \ \ \ \ \ \ \ \ ((\<gtr\> (length params-l) 2)

    \ \ \ \ \ \ \ \ \ \ \ (error 'wrong-number-of-args "optional params in string-join"))

    \ \ \ \ \ \ \ \ \ \ (else (error 'type-error "optional params in string-join"))))

    \ \ 

    \ \ (define (string-join-sub l delim)

    \ \ \ \ (cond ((null-list? l) "")

    \ \ \ \ \ \ \ \ \ \ ((= (length l) 1) (car l))

    \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ (string-append

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car l)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ delim

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string-join-sub (cdr l) delim)))))

    \ \ 

    \ \ (let* ((params \ (extract-params delim+grammer))

    \ \ \ \ \ \ \ \ \ (delim \ \ (first params))

    \ \ \ \ \ \ \ \ \ (grammer (second params))

    \ \ \ \ \ \ \ \ \ (ret \ \ \ \ (string-join-sub l delim)))

    \ \ \ \ (case grammer

    \ \ \ \ \ \ ('infix ret)

    \ \ \ \ \ \ ('strict-infix

    \ \ \ \ \ \ \ (if (null-list? l)

    \ \ \ \ \ \ \ \ \ \ \ (error 'value-error "empty list not allowed")

    \ \ \ \ \ \ \ \ \ \ \ ret))

    \ \ \ \ \ \ ('suffix

    \ \ \ \ \ \ \ \ (if (null-list? l) "" (string-append ret delim)))

    \ \ \ \ \ \ ('prefix

    \ \ \ \ \ \ \ \ (if (null-list? l) "" (string-append delim ret)))

    \ \ \ \ \ \ (else (error 'value-error "invalid grammer")))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-join '("a" "b" "c")) =\<gtr\> "abc")

    \;

    (check (string-join '("a" "b" "c") ":") =\<gtr\> "a:b:c")

    (check (string-join '("a" "b" "c") ":" 'infix) =\<gtr\> "a:b:c")

    (check (string-join '("a" "b" "c") ":" 'suffix) =\<gtr\> "a:b:c:")

    (check (string-join '("a" "b" "c") ":" 'prefix) =\<gtr\> ":a:b:c")

    \;

    (check (string-join '() ":") =\<gtr\> "")

    (check (string-join '() ":" 'infix) =\<gtr\> "")

    (check (string-join '() ":" 'prefix) =\<gtr\> "")

    (check (string-join '() ":" 'suffix) =\<gtr\> "")

    \;

    (check-catch 'value-error (string-join '() ":" 'strict-infix))

    (check-catch 'type-error (string-join '() ":" 2))

    (check-catch 'value-error (string-join '() ":" 'no-such-grammer))

    (check-catch 'wrong-number-of-args (string-join '() ":" 1 2 3))

    \;
  </scm-chunk>

  <section|è°“è¯>

  <paragraph|string-null?><index|string-null?><scm|(str) =\<gtr\> boolean>

  <scm|<code|<code*|string-null?>>>æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°ï¼Œå½“ä¸”ä»…å½“å‚æ•°å­—ç¬¦ä¸²ä¸ºç©ºï¼ˆå³é•¿åº¦ä¸º0ï¼‰æ—¶è¿”å›<scm|#t>ï¼Œå¦åˆ™éƒ½è¿”å›<scm|#f>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‚æ•°æ˜¯éå­—ç¬¦ä¸²æˆ–é•¿åº¦ä¸ä¸º0çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-null? str)

    \ \ (and (string? str)\ 

    \ \ \ \ \ \ \ ((lambda (x) (= x 0)) (string-length str))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-null? ""))

    \;

    (check-false (string-null? "MathAgape"))

    \;

    (check-false (string-null? 'not-a-string))

    \;
  </scm-chunk>

  <paragraph|string-every><index|string-every>

  <scm|string-every>æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²<scm|str>å’Œä¸€ä¸ªè¯„ä¼°è§„åˆ™<scm|criterion>ä¸ºå‚æ•°ï¼Œä»¥åŠæœ€å¤š2ä¸ªéè´Ÿæ•´æ•°ä¸ºå¯é€‰å‚æ•°<scm|. start_end>ç”¨äºæŒ‡å®šæœç´¢çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œæ£€æŸ¥æŒ‡å®šèŒƒå›´å†…å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦æ˜¯å¦éƒ½æ»¡è¶³è¯„ä¼°è§„åˆ™<scm|criterion>ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-every char/pred? str . start+end)

    \ \ (define (string-every-sub pred? str)

    \ \ \ \ (let

    \ \ \ \ \ \ loop ((i 0) (len (string-length str)))

    \ \ \ \ \ \ (or (= i len)

    \ \ \ \ \ \ \ \ \ \ (and (pred? (string-ref str i))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) len)))))

    \ \ 

    \ \ (let ((str-sub (%string-from-range str start+end))

    \ \ \ \ \ \ \ \ (criterion (%make-criterion char/pred?)))

    \ \ \ \ (string-every-sub criterion str-sub)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-every #\\x "xxxxxx"))

    (check-false (string-every #\\x "xxx0xx"))

    \;

    (check-true (string-every char-numeric? "012345"))

    (check-false (string-every char-numeric? "012d45"))

    \;
  </scm-chunk>

  æ³¨æ„ï¼Œè¯„ä¼°è§„åˆ™<scm|criterion>å¿…é¡»æ˜¯è°“è¯æˆ–å­—ç¬¦ï¼Œå¦åˆ™æŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-catch 'wrong-type-arg (string-every 1 "012345"))

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every

    \ \ \ \ \ \ \ \ \ #\\012345

    \ \ \ \ \ \ \ \ \ "012345"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every

    \ \ \ \ \ \ \ \ \ "012345"

    \ \ \ \ \ \ \ \ \ "012345"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  æ³¨æ„ï¼Œè°“è¯è¦ä½¿ç”¨å­—ç¬¦å±æ€§æµ‹è¯•å‡½æ•°ï¼ˆä¾‹å¦‚<scm|char-numeric?>ï¼‰ï¼Œä¸è¦ç”¨ç±»å‹æ£€æŸ¥å‡½æ•°ï¼ˆä¾‹å¦‚<scm|<code*|number?>>ï¼‰ï¼Œå¦åˆ™å¤±å»äº†æ£€æŸ¥çš„æ„ä¹‰ã€‚

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-every char-numeric? "012345"))

    (check-false (string-every number? "012345"))

    \;
  </scm-chunk>

  å¯¹äºå¯é€‰å‚æ•°<scm|. start_end>ï¼šæ²¡æœ‰å¯é€‰å‚æ•°æ—¶ï¼Œé»˜è®¤æœç´¢æ•´ä¸ªå­—ç¬¦ä¸²ï¼›åªæœ‰1ä¸ªå¯é€‰å‚æ•°æ—¶ï¼Œè¯¥æ•°æŒ‡å®šçš„æ˜¯èµ·å§‹ä½ç½®ï¼Œç»“æŸä½ç½®é»˜è®¤ä¸ºå­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦ã€‚æ³¨æ„ï¼Œæœ‰2ä¸ªå¯é€‰å‚æ•°æ—¶ï¼Œç¬¬äºŒä¸ªæ•°ä¸èƒ½å°äºç¬¬ä¸€ä¸ªæ•°ï¼Œå¦åˆ™æŠ¥é”™ï¼›æŒ‡å®šçš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ä¸èƒ½è¶…è¿‡å­—ç¬¦ä¸²<scm|str>çš„èµ·å§‹èŒƒå›´ï¼Œå¦åˆ™æŠ¥é”™ï¼›å¯é€‰å‚æ•°è¶…è¿‡2ä¸ªæ—¶ï¼ŒæŠ¥é”™ã€‚ï¼ˆæ³¨æ„ï¼Œå¯é€‰å‚æ•°çš„è§„åˆ™é€‚ç”¨äºåé¢æ‰€æœ‰è°ƒç”¨åˆ°<scm|%string-from-range>çš„å‡½æ•°ï¼‰

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-every char-numeric? "ab2345" 2))

    (check-false (string-every char-numeric? "ab2345" 1))

    (check-false (string-every \ char-numeric? "ab234f" 2))

    \;

    (check-true (string-every char-numeric? "ab234f" 2 4))

    (check-true (string-every char-numeric? "ab234f" 2 2))

    \;

    (check

    \ \ (string-every\ 

    \ \ \ \ <code*|char-numeric?>

    \ \ \ \ "ab234f"

    \ \ \ \ 1

    \ \ \ \ 4)

    \ \ =\<gtr\>

    \ \ #f)

    \;

    (check

    \ \ (string-every\ 

    \ \ \ \ char-numeric?

    \ \ \ \ "ab234f"

    \ \ \ \ 2

    \ \ \ \ 5)

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (string-every\ 

    \ \ \ \ <code*|char-numeric?>

    \ \ \ \ "ab234f"

    \ \ \ \ 2

    \ \ \ \ 6)

    \ \ =\<gtr\>

    \ \ #f)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every\ 

    \ \ \ \ \ \ \ \ char-numeric?

    \ \ \ \ \ \ \ "ab234f"

    \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ 7))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every\ 

    \ \ \ \ \ \ \ \ char-numeric?

    \ \ \ \ \ \ \ "ab234f"

    \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'wrong-number-of-args

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every\ 

    \ \ \ \ \ \ \ \ char-numeric?

    \ \ \ \ \ \ \ "ab234f"

    \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ 7

    \ \ \ \ \ \ \ 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <paragraph|string-any><index|string-any>

  <scm|string-any>æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºå‚æ•°ï¼Œç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨å­—ç¬¦éƒ½æ»¡è¶³è°“è¯ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°“è¯å¿…é¡»æ˜¯å­—ç¬¦å±æ€§æµ‹è¯•å‡½æ•°ï¼Œå¦åˆ™æŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-any char/pred? str . start+end)

    \ \ (define (string-any-sub pred? str)

    \ \ \ \ (let

    \ \ \ \ \ \ loop ((i 0) (len (string-length str)))

    \ \ \ \ \ \ (if (= i len)

    \ \ \ \ \ \ \ \ \ \ #f \ \ 

    \ \ \ \ \ \ \ \ \ \ (or (pred? (string-ref str i))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) len)))))

    \ \ 

    \ \ (let ((str_sub (%string-from-range str start+end))

    \ \ \ \ \ \ \ \ (criterion (%make-criterion char/pred?)))

    \ \ \ \ (string-any-sub criterion str_sub)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-any #\\0 "xxx0xx"))

    (check-false (string-any #\\0 "xxxxxx"))

    (check-true (string-any char-numeric? "xxx0xx"))

    (check-false (string-any char-numeric? "xxxxxx"))

    \;
  </scm-chunk>

  æ³¨æ„ï¼Œè¯„ä¼°è§„åˆ™<scm|criterion>å¿…é¡»æ˜¯è°“è¯æˆ–å­—ç¬¦ï¼Œå¦åˆ™æŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every

    \ \ \ \ \ \ \ \ \ 0

    \ \ \ \ \ \ \ \ \ "xxx0xx"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-any

    \ \ \ \ \ \ \ \ \ (lambda (n) (= n 0))

    \ \ \ \ \ \ \ \ \ "xxx0xx"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-every

    \ \ \ \ \ \ \ \ \ "0"

    \ \ \ \ \ \ \ \ \ "xxx0xx"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  å¯¹äºå¯é€‰å‚æ•°ï¼š

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-any char-alphabetic? "01c345" 2))

    \;

    (check-false (string-any char-alphabetic? "01c345" 3))

    \;

    (check

    \ \ (string-any\ 

    \ \ \ \ <code*|char-alphabetic?>

    \ \ \ \ "01c345"

    \ \ \ \ 2

    \ \ \ \ 4)

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (string-any\ 

    \ \ \ \ <code*|char-alphabetic?>

    \ \ \ \ "01c345"

    \ \ \ \ 2

    \ \ \ \ 2)

    \ \ =\<gtr\>

    \ \ #f)

    \;

    (check

    \ \ (string-any\ 

    \ \ \ \ <code*|char-alphabetic?>

    \ \ \ \ "01c345"

    \ \ \ \ 3

    \ \ \ \ 4)

    \ \ =\<gtr\>

    \ \ #f)

    \;

    (check

    \ \ (string-any\ 

    \ \ \ \ char-alphabetic?

    \ \ \ \ "01c345"

    \ \ \ \ 2

    \ \ \ \ 6)

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-any\ 

    \ \ \ \ \ \ \ \ \ char-alphabetic?

    \ \ \ \ \ \ \ \ "01c345"

    \ \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ \ 7))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-any\ 

    \ \ \ \ \ \ \ \ \ char-alphabetic?

    \ \ \ \ \ \ \ \ "01c345"

    \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'wrong-number-of-args

    \ \ \ \ (lambda ()\ 

    \ \ \ \ \ \ (string-any\ 

    \ \ \ \ \ \ \ \ \ char-alphabetic?

    \ \ \ \ \ \ \ \ "01c345"

    \ \ \ \ \ \ \ 2

    \ \ \ \ \ \ \ 7

    \ \ \ \ \ \ \ 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <section|é€‰æ‹©å™¨>

  <r7rs><paragraph|string-length><index|string-length>

  <scm|string-length>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å­—ç¬¦ä¸²é•¿åº¦çš„æ•´æ•°ï¼Œå³å­—ç¬¦ä¸²ä¸­åŒ…å«çš„å­—ç¬¦æ•°ã€‚å½“å‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string-length "MathAgape") =\<gtr\> 9)

    (check (string-length "") =\<gtr\> 0)

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (string-length 'not-a-string))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <r7rs><paragraph|string-ref><index|string-ref>

  <scm|string-ref>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªç§°ä¸ºç´¢å¼•å€¼çš„éè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œé€šè¿‡ç´¢å¼•å€¼kè¿”å›å­—ç¬¦ä¸²çš„ç¬¬kä¸ªå…ƒç´ ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ã€‚å½“å‚æ•°ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼ŒæŠ¥é”™ã€‚å½“kä¸ºè´Ÿæ•°ï¼ŒæŠ¥é”™ã€‚å½“kå¤§äºç­‰äºå­—ç¬¦ä¸²ä¸­å­—ç¬¦æ•°æ—¶ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string-ref "MathAgape" 0) =\<gtr\> #\\M)

    (check (string-ref "MathAgape" 2) =\<gtr\> #\\t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-ref "MathAgape" -1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-ref "MathAgape" 9))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-ref "" 0))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <r7rs><paragraph|string-copy><index|string-copy>

  <scm|string-copy>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªç°æœ‰å­—ç¬¦ä¸²çš„å‰¯æœ¬ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªä¸åŸå§‹å­—ç¬¦ä¸²å†…å®¹å®Œå…¨ç›¸åŒçš„æ–°å­—ç¬¦ä¸²ï¼Œä½†å®ƒä»¬åœ¨å†…å­˜ä¸­æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å®ä½“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå§‹å­—ç¬¦ä¸²å’Œå‰¯æœ¬å­—ç¬¦ä¸²å†…å®¹ç›¸åŒï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œè¿™å¯ä»¥ç”¨<code|<code*|equal?>>å’Œ<code|<code*|eq?>>å¯¹æ¯”å‡ºæ¥ã€‚

  <scm|string-copy>å’Œ<scm|%string-from-range>çš„å®ç°æ¯”è¾ƒæ¥è¿‘ï¼ŒåŒºåˆ«åœ¨äºï¼šåœ¨æ²¡æœ‰æŒ‡å®šå­—ç¬¦ä¸²çš„èŒƒå›´çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<scm|substring>æ¥æ¨¡æ‹Ÿæ•´ä¸ªå­—ç¬¦ä¸²çš„æ‹·è´ã€‚S7å†…ç½®çš„å‡½æ•°åªæä¾›äº†æ•´ä¸ªå­—ç¬¦ä¸²çš„æ‹·è´ï¼ŒR7RSå’ŒSRFI-13æ˜¯éœ€è¦é¢å¤–çš„å­—ç¬¦ä¸²çš„èŒƒå›´çš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å®ç°ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (string-copy str . start_end)

    \ \ (cond ((null? start_end)

    \ \ \ \ \ \ \ \ \ (substring str 0))

    \ \ \ \ \ \ \ \ ((= (length start_end) 1)

    \ \ \ \ \ \ \ \ \ \ (substring str (car start_end)))

    \ \ \ \ \ \ \ \ ((= (length start_end) 2)

    \ \ \ \ \ \ \ \ \ (substring str (car start_end) (cadr start_end)))

    \ \ \ \ \ \ \ \ (else (error 'wrong-number-of-args))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (define original-string "MathAgape")

    (define copied-string (string-copy original-string))

    \;

    (check-true (equal? original-string copied-string))

    (check-false (eq? original-string copied-string))

    \;

    (check-true

    \ \ (equal? (string-copy "MathAgape" 4)

    \ \ \ \ \ \ \ \ \ \ (string-copy "MathAgape" 4)))

    \;

    (check-false

    \ \ (eq? (string-copy "MathAgape" 4)

    \ \ \ \ \ \ \ (string-copy "MathAgape" 4)))

    \;

    (check-true

    \ \ (equal? (string-copy "MathAgape" 4 9)

    \ \ \ \ \ \ \ \ \ \ (string-copy "MathAgape" 4 9)))

    \;

    (check-false

    \ \ (eq? (string-copy "MathAgape" 4 9)

    \ \ \ \ \ \ \ (string-copy "MathAgape" 4 9)))

    \;
  </scm-chunk>

  \;

  <paragraph|string-take><index|string-take>

  <scm|string-take>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å‰kä¸ªå­—ç¬¦ç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²å­—ç¬¦æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-take str k)

    \ \ (list-\<gtr\>string (take (string-\<gtr\>list str) k)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-take "MathAgape" 4) =\<gtr\> "Math")

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (string-take "MathAgape" 20))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <paragraph|string-take-right><index|string-take-right>

  <scm|string-take-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œå–å‡ºå­—ç¬¦ä¸²çš„åkä¸ªå­—ç¬¦ç»„æˆæ–°å­—ç¬¦ä¸²ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²å­—ç¬¦æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-take-right str k)

    \ \ (list-\<gtr\>string (take-right (string-\<gtr\>list str) k)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-take-right "MathAgape" 1) =\<gtr\> "e")

    \;

    (check-catch 'wrong-type-arg (string-take-right "MathAgape" 20))

    \;
  </scm-chunk>

  <paragraph|string-drop><index|string-drop>

  <scm|string-drop>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œè¿”å›å»æ‰å­—ç¬¦ä¸²å‰kä¸ªå­—ç¬¦ç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²å­—ç¬¦æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-drop str k)

    \ \ (list-\<gtr\>string (drop (string-\<gtr\>list str) k)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-drop "MathAgape" 8) =\<gtr\> "e")

    \;

    (check-catch 'wrong-type-arg (string-drop "MathAgape" 20))

    \;
  </scm-chunk>

  <paragraph|string-drop-right><index|string-drop-right><scm|(str k) =\<gtr\> string>

  <scm|string-drop-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œå»æ‰å­—ç¬¦ä¸²çš„åkä¸ªå­—ç¬¦ç»„æˆæ–°å­—ç¬¦ä¸²ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²å­—ç¬¦æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚å½“kä¸ºè´Ÿæ•°ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-drop-right str k)

    \ \ (list-\<gtr\>string (drop-right (string-\<gtr\>list str) k)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-drop-right "MathAgape" 5) =\<gtr\> "Math")

    \;

    (check-catch 'wrong-type-arg (string-drop "MathAgape" 20))

    \;
  </scm-chunk>

  <paragraph|string-pad><index|string-pad>

  <scm|string-pad>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæŒ‡å®šé•¿åº¦ï¼ˆéè´Ÿæ•´æ•°ï¼‰ä¸ºå‚æ•°ï¼Œä»å·¦å¡«å……ç©ºæ ¼å­—ç¬¦ç›´åˆ°æŒ‡å®šé•¿åº¦ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ã€‚å½“æŒ‡å®šé•¿åº¦ç­‰äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿”å›çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²å†…å®¹ç›¸åŒã€‚å½“æŒ‡å®šé•¿åº¦å°äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œåˆ™ä»å·¦å»æ‰å­—ç¬¦ç›´åˆ°æŒ‡å®šé•¿åº¦ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ã€‚å½“å‚æ•°çš„æŒ‡å®šé•¿åº¦ä¸ºè´Ÿæ•°æ—¶ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-pad str len . char+start+end)

    \ \ (define (string-pad-sub str len ch)

    \ \ \ \ (let ((orig-len (string-length str)))

    \ \ \ \ \ \ (if (\<less\> len orig-len)

    \ \ \ \ \ \ \ \ \ \ (string-take-right str len)

    \ \ \ \ \ \ \ \ \ \ (string-append (make-string (- len orig-len) ch) str))))

    \ \ 

    \ \ (cond ((null-list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-pad-sub str len #\\ ))

    \ \ \ \ \ \ \ \ ((list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-pad-sub

    \ \ \ \ \ \ \ \ \ \ \ (%string-from-range str (cdr char+start+end))

    \ \ \ \ \ \ \ \ \ \ \ len

    \ \ \ \ \ \ \ \ \ \ \ (car char+start+end)))

    \ \ \ \ \ \ \ \ (else (error 'wrong-type-arg "string-pad"))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check

    \ \ (string-pad "MathAgape" 15)

    \ \ =\<gtr\>

    \ \ " \ \ \ \ \ MathAgape")

    \;

    (check

    \ \ (string-pad "MathAgape" 12 #\\1)

    \ \ =\<gtr\>

    \ \ "111MathAgape")

    \;

    (check

    \ \ (string-pad "MathAgape" 6 #\\1 0 4)

    \ \ =\<gtr\>

    \ \ "11Math")

    \;

    (check

    \ \ (string-pad "MathAgape" 9)

    \ \ =\<gtr\>

    \ \ "MathAgape")

    \;

    (check

    \ \ (string-pad "MathAgape" 5)

    \ \ =\<gtr\>

    \ \ "Agape")

    \;

    (check

    \ \ (string-pad "MathAgape" 2 #\\1 0 4)

    \ \ =\<gtr\>

    \ \ "th")

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (string-pad "MathAgape" -1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <paragraph|string-pad-right><index|string-pad-right>

  <scm|string-pad-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæŒ‡å®šé•¿åº¦ï¼ˆéè´Ÿæ•´æ•°ï¼‰ä¸ºå‚æ•°ï¼Œä»å³å¡«å……ç©ºæ ¼å­—ç¬¦ç›´åˆ°æŒ‡å®šé•¿åº¦ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ã€‚å½“æŒ‡å®šé•¿åº¦ç­‰äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿”å›çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²å†…å®¹ç›¸åŒã€‚å½“æŒ‡å®šé•¿åº¦å°äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œåˆ™ä»å³å»æ‰å­—ç¬¦ç›´åˆ°æŒ‡å®šé•¿åº¦ï¼Œè¿”å›è¿™ä¸ªæ–°å­—ç¬¦ã€‚å½“å‚æ•°çš„æŒ‡å®šé•¿åº¦ä¸ºè´Ÿæ•°æ—¶ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-pad-right str len . char+start+end)

    \ \ (define (string-pad-right-sub str len ch)

    \ \ \ \ (let ((orig-len (string-length str)))

    \ \ \ \ \ \ (if (\<less\> len orig-len)

    \ \ \ \ \ \ \ \ \ \ (string-take str len)

    \ \ \ \ \ \ \ \ \ \ (string-append str (make-string (- len orig-len) ch)))))

    \ \ 

    \ \ (cond ((null-list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-pad-right-sub str len #\\ ))

    \ \ \ \ \ \ \ \ ((list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-pad-right-sub

    \ \ \ \ \ \ \ \ \ \ \ (%string-from-range str (cdr char+start+end))

    \ \ \ \ \ \ \ \ \ \ \ len

    \ \ \ \ \ \ \ \ \ \ \ (car char+start+end)))

    \ \ \ \ \ \ \ \ (else (error 'wrong-type-arg "string-pad"))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-pad-right "MathAgape" 15) =\<gtr\> "MathAgape \ \ \ \ \ ")

    \;

    (check (string-pad-right "MathAgape" 12 #\\1) =\<gtr\> "MathAgape111")

    \;

    (check

    \ \ (string-pad-right "MathAgape" 6 #\\1 0 4)

    \ \ =\<gtr\>

    \ \ "Math11")

    \;

    (check

    \ \ (string-pad-right "MathAgape" 9)

    \ \ =\<gtr\>

    \ \ "MathAgape")

    \;

    (check

    \ \ (string-pad-right "MathAgape" 9 #\\1)

    \ \ =\<gtr\>

    \ \ "MathAgape")

    \;

    (check

    \ \ (string-pad-right "MathAgape" 4)

    \ \ =\<gtr\>

    \ \ "Math")

    \;

    (check

    \ \ (string-pad "MathAgape" 2 #\\1 0 4)

    \ \ =\<gtr\>

    \ \ "th")

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (string-pad-right "MathAgape" -1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <paragraph|string-trim><index|string-trim>

  <scm|string-trim>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»é™¤å­—ç¬¦ä¸²å·¦ç«¯çš„ç©ºç™½å­—ç¬¦ã€‚ç©ºç™½å­—ç¬¦é€šå¸¸åŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ã€‚å½“åŸå­—ç¬¦ä¸²åªåŒ…å«ç©ºç™½å­—ç¬¦ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (%trim-do str string-trim-sub criterion+start+end)

    \ \ (cond ((null-list? criterion+start+end)

    \ \ \ \ \ \ \ \ \ (string-trim-sub str #\\ ))

    \ \ \ \ \ \ \ \ ((list? criterion+start+end)

    \ \ \ \ \ \ \ \ \ (if (char? (car criterion+start+end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (string-trim-sub

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (%string-from-range str (cdr criterion+start+end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car criterion+start+end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (string-trim-sub

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (%string-from-range str criterion+start+end)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #\\ )))

    \ \ \ \ \ \ \ \ (else (error 'wrong-type-arg "string-trim"))))

    \;

    (define (string-trim str . criterion+start+end)

    \ \ (define (string-trim-sub str space-or-char)

    \ \ \ \ (let loop ((i 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (len (string-length str)))

    \ \ \ \ \ \ \ \ \ (if (or (= i len) (not (char=? space-or-char (string-ref str i))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (substring str i len)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) len))))

    \ \ (%trim-do str string-trim-sub criterion+start+end))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-trim " \ 2 4 \ ") =\<gtr\> "2 4 \ ")

    (check (string-trim " \ 2 4 \ " 2) =\<gtr\> "2 4 \ ")

    (check (string-trim " \ 2 4 \ " 3) =\<gtr\> "4 \ ")

    (check (string-trim " \ 2 4 \ " 4) =\<gtr\> "4 \ ")

    (check (string-trim " \ 2 4 \ " 5) =\<gtr\> "")

    \;

    (check-catch 'out-of-range (string-trim " \ 2 4 \ " 8))

    \;

    (check

    \ \ (string-trim " \ 2 4 \ " 0 4)

    \ \ =\<gtr\>

    \ \ "2 ")

    \;

    (check

    \ \ (string-trim " \ 2 4 \ " 0 7)

    \ \ =\<gtr\>

    \ \ "2 4 \ ")

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-trim " \ 2 4 \ " 0 8))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (string-trim " \ 2 4 \ " #\\ )

    \ \ =\<gtr\>

    \ \ "2 4 \ ")

    \;

    (check

    \ \ (string-trim "-- 2 4 --" #\\-)

    \ \ =\<gtr\>

    \ \ " 2 4 --")

    \;

    (check

    \ \ (string-trim " - 345" #\\- 1)

    \ \ =\<gtr\>

    \ \ " 345")

    \;

    (check

    \ \ (string-trim " - 345" #\\- 1 4)

    \ \ =\<gtr\>

    \ \ " 3")

    \;
  </scm-chunk>

  <paragraph|string-trim-right><index|string-trim-right>

  <scm|string-trim-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»é™¤å­—ç¬¦ä¸²å³ç«¯çš„ç©ºç™½å­—ç¬¦ã€‚å½“åŸå­—ç¬¦ä¸²åªåŒ…å«ç©ºç™½å­—ç¬¦ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-trim-right str . criterion+start+end)

    \ \ (define (string-trim-right-sub str space-or-char)

    \ \ \ \ (let loop ((i (- (string-length str) 1)))

    \ \ \ \ \ \ (cond ((negative? i) "")

    \ \ \ \ \ \ \ \ \ \ \ \ ((char=? space-or-char (string-ref str i)) (loop (- i 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ (else (substring str 0 (+ i 1))))))

    \ \ (%trim-do str string-trim-right-sub criterion+start+end))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-trim-right " \ 2 4 \ ") =\<gtr\> " \ 2 4")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 1)

    \ \ =\<gtr\>

    \ \ " 2 4")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 2)

    \ \ =\<gtr\>

    \ \ "2 4")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 3)

    \ \ =\<gtr\>

    \ \ " 4")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 4)

    \ \ =\<gtr\>

    \ \ "4")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 5)

    \ \ =\<gtr\>

    \ \ "")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 6)

    \ \ =\<gtr\>

    \ \ "")

    \;

    (check

    \ \ (string-trim-right " \ 2 4 \ " 7)

    \ \ =\<gtr\>

    \ \ "")

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-trim-right " \ 2 4 \ " 8))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check (string-trim-right " \ 2 4 \ " 0 4) =\<gtr\> " \ 2")

    (check (string-trim-right " \ 2 4 \ " 0 7) =\<gtr\> " \ 2 4")

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (string-trim-right " \ 2 4 \ " 0 8))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check (string-trim-right " \ 2 4 \ " #\\ ) =\<gtr\> " \ 2 4")

    (check (string-trim-right "-- 2 4 --" #\\-) =\<gtr\> "-- 2 4 ")

    (check (string-trim-right "012-" #\\- 1) =\<gtr\> "12")

    (check (string-trim-right "012-4" #\\- 0 4) =\<gtr\> "012")

    \;
  </scm-chunk>

  <paragraph|string-trim-both><index|string-trim-both>

  <scm|string-trim-both>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ã€‚å½“åŸå­—ç¬¦ä¸²åªåŒ…å«ç©ºç™½å­—ç¬¦ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-trim-both str . criterion+start+end)

    \ \ (define (string-trim-both-sub str space-or-char)

    \ \ \ \ (let loop ((i 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (len (string-length str)))

    \ \ \ \ (if (or (= i len) (not (char=? space-or-char (string-ref str i))))

    \ \ \ \ \ \ \ \ (let loop-end ((j (- len 1)))

    \ \ \ \ \ \ \ \ \ \ (if (or (\<less\> j 0) (not (char=? space-or-char (string-ref str j))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (substring str i (+ j 1))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop-end (- j 1))))

    \ \ \ \ \ \ \ \ (loop (+ i 1) len))))

    \ \ (%trim-do str string-trim-both-sub criterion+start+end))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-trim-both " \ 2 4 \ ") =\<gtr\> "2 4")

    (check (string-trim-both "--2 4--" #\\-) =\<gtr\> "2 4")

    \;
  </scm-chunk>

  <section|å‰ç¼€å’Œåç¼€>

  <paragraph|string-prefix?><index|string-prefix?>

  <scm|string-prefix?>æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€ã€‚è‹¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€ï¼Œåˆ™å‡½æ•°è¿”å›<scm|#t>ï¼›å¦åˆ™è¿”å›<scm|#f>ã€‚ç‰¹åˆ«åœ°ï¼Œç©ºå­—ç¬¦ä¸²æ˜¯ä»»æ„å­—ç¬¦ä¸²çš„å‰ç¼€ï¼›ä¸¤ä¸ªå†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²äº’ä¸ºå‰ç¼€ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-prefix? prefix str)

    \ \ (let* ((prefix-len (string-length prefix))

    \ \ \ \ \ \ \ \ \ (str-len (string-length str)))

    \ \ \ \ (and (\<less\>= prefix-len str-len)

    \ \ \ \ \ \ \ \ \ (let loop ((i 0))

    \ \ \ \ \ \ \ \ \ \ \ (or (= i prefix-len)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (and (char=? (string-ref prefix i)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string-ref str i))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1))))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-prefix? "Ma" "MathAgape"))

    (check-true (string-prefix? "" "MathAgape"))

    (check-true (string-prefix? "MathAgape" "MathAgape"))

    (check-false (string-prefix? "a" "MathAgape"))

    \;
  </scm-chunk>

  <paragraph|string-suffix?><index|string-suffix?>

  <scm|string-suffix?>æ˜¯ä¸€ä¸ªè°“è¯å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„åç¼€ã€‚è‹¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„åç¼€ï¼Œåˆ™å‡½æ•°è¿”å›<scm|#t>ï¼›å¦åˆ™è¿”å›<scm|#f>ã€‚ç‰¹åˆ«åœ°ï¼Œç©ºå­—ç¬¦ä¸²æ˜¯ä»»æ„å­—ç¬¦ä¸²çš„åç¼€ï¼›ä¸¤ä¸ªå†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²äº’ä¸ºåç¼€ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-suffix? suffix str)

    \ \ (let* ((suffix-len (string-length suffix))

    \ \ \ \ \ \ \ \ \ (str-len (string-length str)))

    \ \ \ \ (and (\<less\>= suffix-len str-len)

    \ \ \ \ \ \ \ \ \ (let loop ((i 0)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (j (- str-len suffix-len)))

    \ \ \ \ \ \ \ \ \ \ \ (or (= i suffix-len)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (and (char=? (string-ref suffix i)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (string-ref str j))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) (+ j 1))))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-suffix? "e" "MathAgape"))

    (check-true (string-suffix? "" "MathAgape"))

    (check-true (string-suffix? "MathAgape" "MathAgape"))

    (check-false (string-suffix? "p" "MathAgape"))

    \;
  </scm-chunk>

  <section|æœç´¢>

  <paragraph|string-index><index|string-index>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-index str char/pred? . start+end)

    \ \ (define (string-index-sub str pred?)

    \ \ \ \ (let loop ((i 0))

    \ \ \ \ \ \ (cond ((\<gtr\>= i (string-length str)) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ ((pred? (string-ref str i)) i)

    \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ i 1))))))

    \ \ 

    \ \ (let* ((start (if (null-list? start+end) 0 (car start+end)))

    \ \ \ \ \ \ \ \ \ (str-sub (%string-from-range str start+end))

    \ \ \ \ \ \ \ \ \ (pred? (%make-criterion char/pred?))

    \ \ \ \ \ \ \ \ \ (ret (string-index-sub str-sub pred?)))

    \ \ \ \ (if ret (+ start ret) ret)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-index "0123456789" #\\2) =\<gtr\> 2)

    (check (string-index "0123456789" #\\2 2) =\<gtr\> 2)

    (check (string-index "0123456789" #\\2 3) =\<gtr\> #f)

    (check (string-index "01x3456789" char-alphabetic?) =\<gtr\> 2)

    \;
  </scm-chunk>

  <paragraph|string-index-right><index|string-index-right>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-index-right str char/pred? . start+end)

    \ \ (define (string-index-right-sub str pred?)

    \ \ \ \ (let loop ((i (- (string-length str) 1)))

    \ \ \ \ \ \ (cond ((\<less\> i 0) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ ((pred? (string-ref str i)) i)

    \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (- i 1))))))

    \ \ 

    \ \ (let* ((start (if (null-list? start+end) 0 (car start+end)))

    \ \ \ \ \ \ \ \ (str-sub (%string-from-range str start+end))

    \ \ \ \ \ \ \ \ (pred? (%make-criterion char/pred?))

    \ \ \ \ \ \ \ \ (ret (string-index-right-sub str-sub pred?)))

    \ \ \ \ (if ret (+ start ret) ret)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-index-right "0123456789" #\\8) =\<gtr\> 8)

    (check (string-index-right "0123456789" #\\8 2) =\<gtr\> 8)

    (check (string-index-right "0123456789" #\\8 9) =\<gtr\> #f)

    (check (string-index-right "01234567x9" char-alphabetic?) =\<gtr\> 8)

    \;
  </scm-chunk>

  <paragraph|string-contains><index|string-contains>

  <scm|string-contains>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«å¦ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼ŒåŒ…å«åˆ™è¿”å›<scm|#t>ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-contains str sub-str)

    \ \ (let loop ((i 0))

    \ \ \ \ (let ((len (string-length str))

    \ \ \ \ \ \ \ \ \ \ (sub-str-len (string-length sub-str)))

    \ \ \ \ \ \ (if (\<gtr\> i (- len sub-str-len))\ 

    \ \ \ \ \ \ \ \ \ \ #f

    \ \ \ \ \ \ \ \ \ \ (if (string=?\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (substring

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ str

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (+ i sub-str-len))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sub-str)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ #t

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1)))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check-true (string-contains "0123456789" "3"))

    (check-true (string-contains "0123456789" "34"))

    (check-false (string-contains "0123456789" "24"))

    \;
  </scm-chunk>

  <paragraph|string-count><index|string-count>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-count str char/pred? . start+end)

    \ \ (let ((str-sub (%string-from-range str start+end))

    \ \ \ \ \ \ \ \ (criterion (%make-criterion char/pred?)))

    \ \ \ \ (count criterion (string-\<gtr\>list str-sub))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-count "xyz" #\\x) =\<gtr\> 1)

    (check (string-count "xyz" #\\x 0 1) =\<gtr\> 1)

    (check (string-count "xyz" #\\y 0 1) =\<gtr\> 0)

    (check (string-count "xyz" #\\x 0 3) =\<gtr\> 1)

    (check (string-count "xyz" (lambda (x) (char=? x #\\x))) =\<gtr\> 1)

    \;
  </scm-chunk>

  <section|ç¿»è½¬å’Œè¿½åŠ >

  <paragraph|string-reverse><index|string-reverse>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-reverse str . start+end)

    \ \ (cond ((null-list? start+end)

    \ \ \ \ \ \ \ \ \ (reverse str))

    \ \ \ \ \ \ \ \ ((= (length start+end) 1)

    \ \ \ \ \ \ \ \ \ (let ((start (first start+end)))

    \ \ \ \ \ \ \ \ \ \ \ (string-append (substring str 0 start)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (reverse (substring str start)))))

    \ \ \ \ \ \ \ \ ((= (length start+end) 2)

    \ \ \ \ \ \ \ \ \ (let ((start (first start+end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (end (second start+end)))

    \ \ \ \ \ \ \ \ \ \ \ (string-append (substring str 0 start)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (reverse (substring str start end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (substring str end))))

    \ \ \ \ \ \ \ \ (else (error 'wrong-number-of-args "string-reverse"))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check (string-reverse "01234") =\<gtr\> "43210")

    \;

    (check-catch 'out-of-range (string-reverse "01234" -1))

    \;

    (check (string-reverse "01234" 0) =\<gtr\> "43210")

    (check (string-reverse "01234" 1) =\<gtr\> "04321")

    (check (string-reverse "01234" 5) =\<gtr\> "01234")

    \;

    (check-catch 'out-of-range (string-reverse "01234" 6))

    \;

    (check (string-reverse "01234" 0 2) =\<gtr\> "10234")

    (check (string-reverse "01234" 1 3) =\<gtr\> "02134")

    (check (string-reverse "01234" 1 5) =\<gtr\> "04321")

    (check (string-reverse "01234" 0 5) =\<gtr\> "43210")

    \;

    (check-catch 'out-of-range (string-reverse "01234" 1 6))

    \;

    (check-catch 'out-of-range (string-reverse "01234" -1 3))

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|string-append><index|string-append>

  <scm|string-append>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ï¼Œç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ã€‚å®ƒä¼šå°†æ‰€æœ‰æä¾›çš„å­—ç¬¦ä¸²å‚æ•°é€ä¸ªæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¸ä¼šè¢«ä¿®æ”¹ã€‚å½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (string-append "Math" "Agape") =\<gtr\> "MathAgape")

    \;

    (check (string-append) =\<gtr\> "")

    \;
  </scm-chunk>

  <section|Fold, unfold & map>

  <r7rs><paragraph|string-map><index|string-map>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (string-map p . args) (apply string (apply map p args)))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check

    \ \ (string-map

    \ \ \ \ (lambda (ch) (integer-\<gtr\>char (+ 1 (char-\<gtr\>integer ch))))

    \ \ \ \ "HAL")

    \ \ =\<gtr\> "IBM")

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|string-for-each><scm|(proc str1 [str2 ...])><index|string-for-each>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define string-for-each for-each)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check

    \ \ (let ((lst '()))

    \ \ \ \ (string-for-each

    \ \ \ \ \ \ (lambda (x) (set! lst (cons (char-\<gtr\>integer x) lst)))

    \ \ \ \ \ \ "12345")

    \ \ \ \ lst)

    \ \ =\<gtr\> '(53 52 51 50 49))

    \;

    (check

    \ \ (let ((lst '()))

    \ \ \ \ (string-for-each

    \ \ \ \ \ \ (lambda (x) (set! lst (cons (- (char-\<gtr\>integer x) (char-\<gtr\>integer #\\0)) lst)))

    \ \ \ \ \ \ "12345")

    \ \ \ \ lst)

    \ \ =\<gtr\> '(5 4 3 2 1))

    \;

    (check

    \ \ (let ((lst '()))

    \ \ \ \ (string-for-each

    \ \ \ \ \ \ (lambda (x) (set! lst (cons (- (char-\<gtr\>integer x) (char-\<gtr\>integer #\\0)) lst)))

    \ \ \ \ \ \ "123")

    \ \ \ \ lst)

    \ \ =\<gtr\> '(3 2 1))

    \;

    (check

    \ \ (let ((lst '()))

    \ \ \ \ (string-for-each

    \ \ \ \ \ \ (lambda (x) (set! lst (cons (- (char-\<gtr\>integer x) (char-\<gtr\>integer #\\0)) lst)))

    \ \ \ \ \ \ "")

    \ \ \ \ lst)

    \ \ =\<gtr\> '())

    \;
  </scm-chunk>

  <section|æ’å…¥å’Œè§£æ>

  <paragraph|string-tokenize><index|string-tokenize>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|true>
    (define (string-tokenize str . char+start+end)

    \ \ 

    \ \ (define (string-tokenize-sub str char)

    \ \ \ \ 

    \ \ \ \ (define (tokenize-helper tokens cursor)

    \ \ \ \ \ \ (let ((sep-pos/false (string-index str char cursor)))

    \ \ \ \ \ \ \ \ (if (not sep-pos/false)

    \ \ \ \ \ \ \ \ \ \ \ \ (reverse (cons (substring str cursor) tokens))

    \ \ \ \ \ \ \ \ \ \ \ \ (let ((new-tokens

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (= cursor sep-pos/false)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tokens

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons (substring str cursor sep-pos/false) tokens)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (next-cursor (+ sep-pos/false 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (tokenize-helper new-tokens next-cursor)))))

    \ \ 

    \ \ \ \ \ \ (tokenize-helper '() 0))

    \ \ 

    \ \ (cond ((null-list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-tokenize-sub str #\\ ))

    \ \ \ \ \ \ \ \ ((list? char+start+end)

    \ \ \ \ \ \ \ \ \ (string-tokenize-sub

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (%string-from-range str (cdr char+start+end))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car char+start+end)))

    \ \ \ \ \ \ \ \ (else (error 'wrong-type-arg "string-tokenize"))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|true>
    (check

    \ \ (string-tokenize "1 22 333")

    \ \ =\<gtr\> '("1" "22" "333"))

    \;

    (check

    \ \ (string-tokenize "1 22 333" #\\2)

    \ \ =\<gtr\> '("1 " " 333"))

    \;

    (check

    \ \ (string-tokenize "1 22 333" #\\ \ 2)

    \ \ =\<gtr\> â€˜("22" "333"))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/srfi/srfi-13.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/string-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii list)><label|chapter:liii_list>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/list.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|false|true>
    ;;; SRFI-1 list-processing library \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -*- Scheme -*-

    ;;; Reference implementation

    ;;;

    ;;; SPDX-License-Identifier: MIT

    ;;;

    ;;; Copyright (c) 1998, 1999 by Olin Shivers. You may do as you please with

    ;;; this code as long as you do not remove this copyright notice or

    ;;; hold me liable for its use. Please send bug reports to shivers@ai.mit.edu.

    ;;; \ \ \ \ -Olin

    ;;;

    ;;; Copyright (c) 2024 The Goldfish Scheme Authors

    ;;; Follow the same License as the original one

    \;
  </scm-chunk>

  <section|æ¥å£>

  Liii Listå‡½æ•°åº“æ˜¯é‡‘é±¼æ ‡å‡†åº“ä¸­çš„Listå‡½æ•°åº“ï¼Œå…¶ä¸­çš„å¤§éƒ¨åˆ†å‡½æ•°æ¥è‡ªå‡½æ•°åº“<scm|(srfi srfi-1)>ï¼Œå°éƒ¨åˆ†æ˜¯ä¸‰é²¤è‡ªå·±è®¾è®¡çš„å‡½æ•°ã€‚æ¥è‡ªSRFI 1çš„ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨Liii Listä¸­å¯¼å‡ºç›¸å…³å‡½æ•°åï¼Œç›¸å…³å®ç°å’Œå•å…ƒæµ‹è¯•éƒ½åœ¨SRFI 1ä¸­ç»´æŠ¤ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define-library (liii list)

    (export

    \ \ ; S7 built-in

    \ \ cons car cdr map for-each

    \ \ ; SRFI 1: Constructors

    \ \ circular-list iota list-copy

    \ \ ; SRFI 1: Predicates

    \ \ null-list? circular-list?

    \ \ ; SRFI 1: Selectors

    \ \ first second third fourth fifth sixth seventh eighth ninth tenth

    \ \ take drop take-right drop-right

    \ \ last-pair last

    \ \ ; SRFI 1: fold, unfold & map

    \ \ count fold fold-right reduce reduce-right

    \ \ filter partition remove append-map

    \ \ ; SRFI 1: Searching

    \ \ find any every list-index

    \ \ take-while drop-while

    \ \ ; SRFI 1: deleting

    \ \ delete

    \ \ ; Liii List extensions

    \ \ list-view flatmap

    \ \ list-null? list-not-null? not-null-list?

    \ \ length=? length\<gtr\>? length\<gtr\>=? flatten

    )

    (import (srfi srfi-1)

    \ \ \ \ \ \ \ \ (liii error))

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define-library (srfi srfi-1)

    (import (liii error)

    \ \ \ \ \ \ \ \ (liii base))

    (export

    \ \ ; SRFI 1: Constructors

    \ \ circular-list iota list-copy\ 

    \ \ circular-list? null-list?

    \ \ first second third fourth fifth

    \ \ sixth seventh eighth ninth tenth

    \ \ take drop take-right drop-right count fold fold-right

    \ \ reduce reduce-right append-map filter partition remove find

    \ \ delete delete-duplicates

    \ \ take-while drop-while list-index any every

    \ \ last-pair last)

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  åœ¨é‡‘é±¼Schemeä¸­çš„SRFI 1å®ç°éœ€è¦éµå¾ªæœ€å°ä¾èµ–åŸåˆ™ï¼Œç›®å‰<scm|delete-duplicates>æ˜¯ä¸€ä¸ªå¤æ‚åº¦æ¯”è¾ƒé«˜çš„å®ç°ï¼Œåœ¨SRFI 1ä¸­ä¿ç•™ï¼Œä½†å¹¶ä¸åœ¨<scm|(liii list)>å¯¼å‡ºï¼Œæ•…è€Œåœ¨æœ¬æµ‹è¯•æ–‡ä»¶çš„å¼€å¤´éœ€è¦ä»<scm|(srfi srfi-1)>å•ç‹¬å¯¼å…¥ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (import (liii list)

    \ \ \ \ \ \ \ \ (liii check)

    \ \ \ \ \ \ \ \ (only (srfi srfi-1) delete-duplicates))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <section|SRFI-1>

  SRFI-1ä¸­æœ‰ä¸€éƒ¨åˆ†å‡½æ•°å·²ç»åœ¨R7RSçš„<scm|(scheme base)>åº“é‡Œé¢äº†ã€‚æœ¬èŠ‚åŒ…å«äº†R7RSå®šä¹‰çš„<scm|(scheme base)>é‡Œé¢å’Œåˆ—è¡¨ç›¸å…³çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°çš„å®ç°å’Œæµ‹è¯•å‡åœ¨<shell|base.scm>å’Œ<shell|base-test.scm>ä¸­ç»´æŠ¤ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡<scm|(import (liii base))>å¯¼å…¥è¿™äº›å‡½æ•°ï¼Œæˆ–è€…ä½¿ç”¨<scm|(import (liii list))>å¯¼å…¥è¿™äº›å‡½æ•°ã€‚

  <subsection|æ„é€ å™¨>

  <r7rs><paragraph|cons><index|cons>

  S7 Schemeå†…ç½®çš„R7RSä¸­å®šä¹‰çš„å‡½æ•°ã€‚

  <paragraph|list><index|list>

  S7 Schemeå†…ç½®çš„R7RSä¸­å®šä¹‰çš„å‡½æ•°ã€‚

  <paragraph|make-list><index|make-list><scm|(make-list k [fill]) =\<gtr\> list>

  S7 Schemeå†…ç½®çš„R7RSä¸­å®šä¹‰çš„å‡½æ•°ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (make-list 3 #\\a) =\<gtr\> (list #\\a #\\a #\\a))

    (check (make-list 3) =\<gtr\> (list #f #f #f))

    \;

    (check (make-list 0) =\<gtr\> (list ))

    \;
  </scm-chunk>

  <paragraph|circular-list><index|circular-list>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    ; 0 clause BSD, from S7 repo stuff.scm

    (define circular-list

    \ \ (lambda objs

    \ \ \ \ (let ((lst (copy objs)))

    \ \ \ \ \ \ (set-cdr! (list-tail lst (- (length lst) 1)) lst))))

    \;
  </scm-chunk>

  <paragraph|iota><index|iota>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    ; 0 clause BSD, from S7 repo stuff.scm

    (define* (iota n (start 0) (incr 1))

    \ \ (when (not (integer? n))

    \ \ \ \ (type-error "iota: n must be a integer"))

    \ \ (when (\<less\> n 0)

    \ \ \ \ (value-error "iota: n must be postive but received ~d" n))

    \ \ (let ((lst (make-list n)))

    \ \ \ \ (do ((p lst (cdr p))

    \ \ \ \ \ \ \ \ \ (i start (+ i incr)))

    \ \ \ \ \ \ ((null? p) lst)

    \ \ \ \ \ \ (set! (car p) i))))

    \;
  </scm-chunk>

  æµ‹è¯•ç”¨ä¾‹

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (iota 3) =\<gtr\> (list 0 1 2))

    (check (iota 3 7) =\<gtr\> (list 7 8 9))

    (check (iota 2 7 2) =\<gtr\> (list 7 9))

    \;

    (check-catch 'value-error (iota -1))

    (check-catch 'type-error (iota 'a))

    \;
  </scm-chunk>

  <paragraph|list-copy><index|list-copy>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    ; 0 clause BSD, from S7 repo r7rs.scm

    (define list-copy copy)

    \;
  </scm-chunk>

  æµ‹è¯•ç”¨ä¾‹

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    ;; list-copy tests

    \;

    ;; Check that copying an empty list works as expected

    (check (list-copy '()) =\<gtr\> '())

    \;

    ;; Check that copying a list of numbers works correctly

    (check (list-copy '(1 2 3 4 5)) =\<gtr\> '(1 2 3 4 5))

    \;

    ;; Check that copying a list of symbols works correctly

    (check (list-copy '(a b c d)) =\<gtr\> '(a b c d))

    \;

    ;; Check that copying nested lists works correctly

    (check (list-copy '((1 2) (3 4) (5 6))) =\<gtr\> '((1 2) (3 4) (5 6)))

    \;

    ;; Check that copying the list does not result in the same object

    (check-false (eq? (list-copy '(1 2 3)) '(1 2 3)))

    \;

    ;; Check if list-copy is a deep copy or not\ 

    (let ((obj1 '(1 2 3 4))

    \ \ \ \ \ \ (obj2 (list-copy '(1 2 3 4))))

    \ \ (check obj1 =\<gtr\> obj2)

    \ \ (set-car! obj1 3)

    \ \ (check-false (eq? obj1 obj2)))

    \;
  </scm-chunk>

  <subsection|è°“è¯>

  <value|r7rs><paragraph|pair?><scm|(obj) =\<gtr\> bool><index|pair?>

  <scm|pair?>æ˜¯S7 Schemeå†…ç½®çš„å‡½æ•°ï¼šå½“ä¸”ä»…å½“objæ˜¯åºå¯¹æ—¶ï¼Œè¿”å›çœŸã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (pair? '(a . b)) =\<gtr\> #t)

    (check (pair? '(a b c)) =\<gtr\> #t)

    (check (pair? '()) =\<gtr\> #f)

    (check (pair? '#(a b)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|list?><scm|(obj) =\<gtr\> bool><index|list?>

  åŸºæœ¬åˆ—è¡¨æµ‹è¯•ï¼šæ£€æŸ¥ç©ºåˆ—è¡¨å’ŒåŒ…å«å…ƒç´ çš„åˆ—è¡¨æ˜¯å¦è¢«è¯†åˆ«ä¸ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (list? '()))

    (check-true (list? '(a)))

    (check-true (list? '(a b c)))

    (check-true (list? '(1 . 2)))

    (check-true (list? '(1 2 . 3)))

    \;
  </scm-chunk>

  åµŒå¥—åˆ—è¡¨æµ‹è¯•ï¼šæ£€æŸ¥åŒ…å«å…¶ä»–åˆ—è¡¨ä½œä¸ºå…ƒç´ çš„åˆ—è¡¨æ˜¯å¦è¢«æ­£ç¡®è¯†åˆ«ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (list? '((a) (b) (c))))

    (check-true (list? '(a (b) c)))

    \;
  </scm-chunk>

  å¾ªç¯åˆ—è¡¨æµ‹è¯•ï¼šæ£€æŸ¥å‡½æ•°æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¾ªç¯åˆ—è¡¨ç»“æ„ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-true (list? (let ((x '(1 2 3))) (set-cdr! (cddr x) x) x)))

    \;
  </scm-chunk>

  éåˆ—è¡¨æµ‹è¯•ï¼šæ£€æŸ¥åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠå‘é‡æ˜¯å¦è¢«æ­£ç¡®åœ°è¯†åˆ«ä¸ºéåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check-false (list? #t))

    (check-false (list? #f))

    (check-false (list? 123))

    (check-false (list? "Hello"))

    (check-false (list? '#(1 2 3)))\ 

    (check-false (list? '#()))

    (check-false (list? '12345))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|null?><scm|(obj) =\<gtr\> bool><index|null?>

  <scm|null?>æ˜¯S7 Schemeå†…ç½®çš„å‡½æ•°ï¼šå½“ä¸”ä»…å½“objæ˜¯ç©ºåˆ—è¡¨çš„æ—¶å€™ï¼Œè¿”å›å€¼ä¸ºçœŸã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (null? '()) =\<gtr\> #t)

    (check (null? '(1)) =\<gtr\> #f)

    (check (null? '(1 2)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|circular-list?><index|circular-list?>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    ; 0 clause BSD, from S7 repo stuff.scm

    (define circular-list?

    \ \ (lambda (obj)

    \ \ \ \ (catch #t

    \ \ \ \ \ \ (lambda () (infinite? (length obj)))

    \ \ \ \ \ \ (lambda args #f))))

    \;
  </scm-chunk>

  <todo|åœ¨Windowsä¸ŠCIçš„ç»“æœæ˜¯#fï¼Œéœ€è¦ä¿®å¤è¿™ä¸ªé—®é¢˜>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    ; (check (circular-list? (circular-list 1 2)) =\<gtr\> #t)

    \;
  </scm-chunk>

  <paragraph|null-list?><index|null-list?>

  <scm|null-list?>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›<scm|#t>å½“ä¸”ä»…å½“å‚æ•°æ˜¯ç©ºåˆ—è¡¨ã€‚å½“å‚æ•°ä¸ºç©ºåˆ—è¡¨ï¼Œè¿”å›<scm|#t>ï¼›å¦åˆ™æŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (null-list? l)

    \ \ (cond ((pair? l) #f)

    \ \ \ \ \ \ \ \ ((null? l) #t)

    \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ (error 'wrong-type-arg "null-list?: argument out of domain" l))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (null-list? '()) =\<gtr\> #t)

    \;
  </scm-chunk>

  å½“å‚æ•°ä¸ºåºå¯¹ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (null-list? '(1 . 2)) =\<gtr\> #f)

    \;
  </scm-chunk>

  å½“å‚æ•°ä¸ºéç©ºåˆ—è¡¨ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (null-list? '(1 2)) =\<gtr\> #f)

    \;
  </scm-chunk>

  å½“å‚æ•°æ—¢ä¸æ˜¯åºå¯¹ä¹Ÿä¸æ˜¯åˆ—è¡¨ï¼ŒæŠ¥é”™ã€‚

  è¾¨æï¼š<scm|null?>åœ¨å‚æ•°ä¸ºéåºå¯¹æ—¶ï¼Œä¸æŠ¥é”™ï¼Œåªæ˜¯è¿”å›<scm|#f>ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (null? 1) =\<gtr\> #f)

    \;
  </scm-chunk>

  å¦‚æœå·²ç»ç¡®å®šéœ€è¦åˆ¤åˆ«çš„å¯¹è±¡æ˜¯åˆ—è¡¨ï¼Œä½¿ç”¨<scm|null-list?>æ›´åŠ åˆé€‚ã€‚<scm|null?>æ— æ³•åˆ†è¾¨éç©ºçš„åºå¯¹å’Œéç©ºçš„åˆ—è¡¨ï¼Œå‘½åä¸Šåæ¨¡ç³Šï¼Œä¸æ¨èä½¿ç”¨ã€‚

  <subsection|é€‰æ‹©å™¨>

  <paragraph|car><index|car>

  ä¸€ä¸ªåºå¯¹ç”±<scm|\<less\>car\<gtr\>>éƒ¨åˆ†ä¸<scm|\<less\>cdr\<gtr\>>éƒ¨åˆ†ç»„æˆï¼Œå½¢å¦‚ï¼š<scm|(\<less\>car\<gtr\> . \<less\>cdr\<gtr\>)>ã€‚<scm|car>æ˜¯S7 Schemeå†…ç½®çš„R7RSå®šä¹‰çš„å‡½æ•°ï¼Œç”¨äºè¿”å›åºå¯¹çš„<scm|\<less\>car\<gtr\>>éƒ¨åˆ†ã€‚<scm|car>çš„å‚æ•°å¿…é¡»æ˜¯åºå¯¹ï¼Œå¦åˆ™æŠ¥é”™ï¼›ç‰¹åˆ«åœ°ï¼Œç©ºåˆ—è¡¨ä¸æ˜¯åºå¯¹ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (car '(a b c . d)) =\<gtr\> 'a)

    (check (car '(a b c)) =\<gtr\> 'a)

    \;

    (check-catch 'wrong-type-arg (car '()))

    \;
  </scm-chunk>

  <paragraph|cdr><index|cdr>

  <scm|cdr>æ˜¯S7 Schemeå†…ç½®çš„R7RSå®šä¹‰çš„å‡½æ•°ï¼Œç”¨äºè¿”å›åºå¯¹çš„<scm|\<less\>cdr\<gtr\>>éƒ¨åˆ†ã€‚<scm|cdr>çš„å‚æ•°å¿…é¡»æ˜¯åºå¯¹ï¼Œå¦åˆ™æŠ¥é”™ï¼›ç‰¹åˆ«åœ°ï¼Œç©ºåˆ—è¡¨ä¸æ˜¯åºå¯¹ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (cdr '(a b c . d)) =\<gtr\> '(b c . d))

    (check (cdr '(a b c)) =\<gtr\> '(b c))

    \ \ 

    (check-catch 'wrong-type-arg (cdr '()))

    \;
  </scm-chunk>

  <paragraph|caar><index|caar><scm|(caar pair) =\<gtr\> obj>

  <scm|caar>æ˜¯S7 Schemeå†…ç½®çš„R7RSå®šä¹‰çš„å‡½æ•°ï¼Œç”¨äºè¿”å›åºå¯¹<scm|\<less\>car\<gtr\>>éƒ¨åˆ†çš„<scm|\<less\>car\<gtr\>>éƒ¨åˆ†ã€‚å‚æ•°å¿…é¡»æ˜¯åºå¯¹ï¼Œä¸”è¯¥åºå¯¹çš„<scm|\<less\>car\<gtr\>>éƒ¨åˆ†çš„å†…å®¹ä¹Ÿè¦æ˜¯åºå¯¹ï¼Œå¦åˆ™æŠ¥é”™ã€‚ç‰¹åˆ«åœ°ï¼Œç©ºåˆ—è¡¨ä¸æ˜¯åºå¯¹ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (caar '((a . b) . c)) =\<gtr\> 'a)

    \;

    (check-catch 'wrong-type-arg (caar '(a b . c)))

    (check-catch 'wrong-type-arg (caar '()))

    \;
  </scm-chunk>

  <paragraph|list-ref><index|list-ref>

  <scm|list-ref>æ˜¯S7 Schemeå†…ç½®çš„R7RSå®šä¹‰çš„å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªç§°ä¸ºç´¢å¼•å€¼çš„éè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œé€šè¿‡ç´¢å¼•å€¼kè¿”å›åˆ—è¡¨çš„ç¬¬kä¸ªå…ƒç´ ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ã€‚å½“å‚æ•°ä¸ºç©ºåˆ—è¡¨æ—¶ï¼ŒæŠ¥é”™ã€‚å½“kä¸ºè´Ÿæ•°ï¼ŒæŠ¥é”™ã€‚å½“kå¤§äºç­‰äºåˆ—è¡¨ä¸­å…ƒç´ æ•°æ—¶ï¼ŒæŠ¥é”™ã€‚

  æ³¨æ„<scm|(cons '(1 2) '(3 4))>å…¶å®æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†è¿™ä¸ªåˆ—è¡¨çš„å…ƒç´ ä¸éƒ½æ˜¯æ•´æ•°ã€‚è¿™ä¸ªä¾‹å­å®¹æ˜“ç†è§£æˆç»“æœæ˜¯ä¸€ä¸ªåºå¯¹ä¸”ä¸æ˜¯åˆ—è¡¨ã€‚

  <\session|goldfish|default>
    <\unfolded-io>
      \<gtr\>\ 
    <|unfolded-io>
      (cons '(1 2) '(3 4))
    <|unfolded-io>
      ((1 2) 3 4)
    </unfolded-io>

    <\input>
      \<gtr\>\ 
    <|input>
      \;
    </input>
  </session>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (list-ref (cons '(1 2) '(3 4)) 1) =\<gtr\> 3)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (list-ref '(a b c) 2) =\<gtr\> 'c)

    \;

    (check-catch 'wrong-type-arg (list-ref '() 0))

    \;

    (check-catch 'out-of-range (list-ref '(a b c) -1))

    (check-catch 'out-of-range (list-ref '(a b c) 3))

    \;
  </scm-chunk>

  <paragraph|first><index|first>

  <scm|first>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ<scm|car>çš„åŒä¹‰è¯ï¼Œç”¨äºè¿”å›åˆ—è¡¨çš„ç¬¬1ä¸ªå…ƒç´ ã€‚å½“åˆ—è¡¨å…ƒç´ ä¸è¶³1ä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (first '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 1)

    (check (first '(left . right)) =\<gtr\> 'left)

    \;

    (check-catch 'wrong-type-arg (first '()))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define first car)

    \;
  </scm-chunk>

  <paragraph|second><index|second>

  <scm|second>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ<scm|cadr>çš„åŒä¹‰è¯ï¼Œç”¨äºè¿”å›åˆ—è¡¨çš„ç¬¬2ä¸ªå…ƒç´ ã€‚å½“åˆ—è¡¨å…ƒç´ ä¸è¶³2ä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (second '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 2)

    \;

    (check-catch 'wrong-type-arg (second '(left . right)))

    (check-catch 'wrong-type-arg (second '(1)))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define second cadr)

    \;
  </scm-chunk>

  <paragraph|third><index|third>

  <scm|third>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ<scm|caddr>çš„åŒä¹‰è¯ï¼Œç”¨äºè¿”å›åˆ—è¡¨çš„ç¬¬3ä¸ªå…ƒç´ ã€‚å½“åˆ—è¡¨å…ƒç´ ä¸è¶³3ä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (third '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 3)

    \;

    (check-catch 'wrong-type-arg (third '(1 2)))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define third caddr)

    \;
  </scm-chunk>

  <paragraph|fourth><index|fourth>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (fourth x) (list-ref x 3))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fourth '(1 2 3 4 5 6)) =\<gtr\> 4)

    \;
  </scm-chunk>

  <paragraph|fifth><index|fifth>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (fifth x) (list-ref x 4))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fifth '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 5)

    \;
  </scm-chunk>

  <paragraph|sixth><index|sixth>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (sixth x) (list-ref x 5))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (sixth '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 6)

    \;
  </scm-chunk>

  <paragraph|seventh><index|seventh>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (seventh x) (list-ref x 6))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (seventh '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 7)

    \;
  </scm-chunk>

  <paragraph|eighth><index|eighth>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (eighth x) (list-ref x 7))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (eighth '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 8)

    \;
  </scm-chunk>

  <paragraph|ninth><index|ninth>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (ninth x) (list-ref x 8))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (ninth '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 9)

    \;
  </scm-chunk>

  <paragraph|tenth><index|tenth>

  <scm|tenth>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè¿”å›åˆ—è¡¨çš„ç¬¬10ä¸ªå…ƒç´ ã€‚å½“åˆ—è¡¨å…ƒç´ ä¸è¶³10ä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (tenth '(1 2 3 4 5 6 7 8 9 10)) =\<gtr\> 10)

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (tenth x)\ 

    \ \ (cadr (cddddr (cddddr x))))

    \;
  </scm-chunk>

  <paragraph|take><index|take>

  <scm|take>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œè¿”å›åˆ—è¡¨çš„å‰kä¸ªå…ƒç´ ç»„æˆçš„æ–°åˆ—è¡¨ã€‚å½“åˆ—è¡¨å…ƒç´ æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (take '(1 2 3 4) 3) =\<gtr\> '(1 2 3))

    (check (take '(1 2 3 4) 4) =\<gtr\> '(1 2 3 4))

    (check (take '(1 2 3 . 4) 3) =\<gtr\> '(1 2 3))

    \;

    (check-catch 'wrong-type-arg (take '(1 2 3 4) 5))

    (check-catch 'wrong-type-arg (take '(1 2 3 . 4) 4))

    \;
  </scm-chunk>

  <subparagraph|å®ç°>

  <\session|goldfish|default>
    <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
      (define (take l k)

      \ \ (let loop ((l l) (k k))

      \ \ \ \ (if (zero? k) '()

      \ \ \ \ \ \ \ \ (cons (car l)

      \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (cdr l) (- k 1))))))

      \;
    </scm-chunk>
  </session>

  <paragraph|drop><index|drop>

  <scm|drop>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œè¿”å›å»æ‰åˆ—è¡¨å‰kä¸ªå…ƒç´ ç»„æˆçš„æ–°åˆ—è¡¨ã€‚å½“åˆ—è¡¨å…ƒç´ æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (drop '(1 2 3 4) 2) =\<gtr\> '(3 4))

    \;

    (check (drop '(1 2 3 4) 4) =\<gtr\> '())

    \;

    (check-catch 'wrong-type-arg (drop '(1 2 3 4) 5))

    \;

    (check (drop '(1 2 3 . 4) 3) =\<gtr\> 4)

    \;

    (check-catch 'wrong-type-arg (drop '(1 2 3 . 4) 4))

    \;
  </scm-chunk>

  <\session|goldfish|default>
    \;

    <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
      (define (drop l k)

      \ \ (let iter ((l l) (k k))

      \ \ \ \ (if (zero? k) l (iter (cdr l) (- k 1)))))

      \;
    </scm-chunk>
  </session>

  <paragraph|take-right><index|take-right>

  <scm|take-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œå–å‡ºåˆ—è¡¨çš„åkä¸ªå…ƒç´ ç»„æˆæ–°åˆ—è¡¨ï¼Œè¿”å›è¿™ä¸ªæ–°åˆ—è¡¨ã€‚å½“åˆ—è¡¨å…ƒç´ æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (take-right '(1 2 3 4) 3) =\<gtr\> '(2 3 4))

    \;

    (check (take-right '(1 2 3 4) 4) =\<gtr\> '(1 2 3 4))

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (take-right '(1 2 3 4) 5))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;

    (check (take-right '(1 2 3 . 4) 3) =\<gtr\> '(1 2 3 . 4))

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (take-right '(1 2 3 . 4) 4))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (take-right l k)

    \ \ (let lp ((lag l) \ (lead (drop l k)))

    \ \ \ \ (if (pair? lead)

    \ \ \ \ \ \ \ \ (lp (cdr lag) (cdr lead))

    \ \ \ \ \ \ \ \ lag)))

    \;
  </scm-chunk>

  <paragraph|drop-right><index|drop-right>

  <scm|drop-right>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªéè´Ÿæ•´æ•°kä¸ºå‚æ•°ï¼Œå»æ‰åˆ—è¡¨çš„åkä¸ªå…ƒç´ ç»„æˆæ–°åˆ—è¡¨ï¼Œè¿”å›è¿™ä¸ªæ–°åˆ—è¡¨ã€‚å½“åˆ—è¡¨å…ƒç´ æ•°é‡ä¸è¶³kä¸ªï¼ŒæŠ¥é”™ã€‚å½“kä¸ºè´Ÿæ•°ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (drop-right l k)

    \ \ (let recur ((lag l) (lead (drop l k)))

    \ \ \ \ (if (pair? lead)

    \ \ \ \ \ \ \ \ (cons (car lag) (recur (cdr lag) (cdr lead)))

    \ \ \ \ \ \ \ \ '())))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (drop-right '(1 2 3 4) 2) =\<gtr\> '(1 2))

    \;

    (check (drop-right '(1 2 3 4) 4) =\<gtr\> '())

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (drop-right '(1 2 3 4) 5))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (drop-right '(1 2 3 4) -1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;

    (check (drop-right '(1 2 3 . 4) 3) =\<gtr\> '())

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (drop-right '(1 2 3 . 4) 4))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;
  </scm-chunk>

  <paragraph|last-pair><index|last-pair>

  <scm|last-pair>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åºå¯¹å½¢å¼è¿”å›åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå‚æ•°å¿…é¡»æ˜¯åºå¯¹ï¼Œç©ºåˆ—è¡¨æŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (last-pair l)

    \ \ (if (pair? (cdr l))

    \ \ \ \ \ \ (last-pair (cdr l)) l))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (last-pair '(a b c)) =\<gtr\> '(c))

    (check (last-pair '(c)) =\<gtr\> '(c))

    \;

    (check (last-pair '(a b . c)) =\<gtr\> '(b . c))

    (check (last-pair '(b . c)) =\<gtr\> '(b . c))

    \;

    (check-catch 'wrong-type-arg (last-pair '()))

    \;
  </scm-chunk>

  <paragraph|last><index|last>

  <scm|last>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»¥ç¬¦å·å½¢å¼è¿”å›åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå‚æ•°å¿…é¡»æ˜¯åºå¯¹ï¼Œç©ºåˆ—è¡¨æŠ¥é”™ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (last l)

    \ \ (car (last-pair l)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (last '(a b c)) =\<gtr\> 'c)

    (check (last '(c)) =\<gtr\> 'c)

    \;

    (check (last '(a b . c)) =\<gtr\> 'b)

    (check (last '(b . c)) =\<gtr\> 'b)

    \;

    (check-catch 'wrong-type-arg (last '()))

    \;
  </scm-chunk>

  <subsection|å¸¸ç”¨å‡½æ•°>

  <value|r7rs><paragraph|length><scm|(lst) -\<gtr\> integer><index|length>

  <scm|length>æ˜¯ä¸€ä¸ªS7å†…ç½®å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œè¿”å›è¯¥åˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡ã€‚å¦‚æœå‚æ•°ä¸æ˜¯åˆ—è¡¨ï¼Œè¿”å›0ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (length ()) =\<gtr\> 0)

    (check (length '(a b c)) =\<gtr\> 3)

    (check (length '(a (b) (c d e))) =\<gtr\> 3)

    \;

    (check (length 2) =\<gtr\> #f)

    (check (length '(a . b)) =\<gtr\> -1)

    \;
  </scm-chunk>

  <paragraph|append><index|append>

  <scm|append>æ˜¯ä¸€ä¸ªS7å†…ç½®çš„R7RSå®šä¹‰çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶å¤šä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼ŒæŒ‰é¡ºåºæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚<scm|append>æ²¡æœ‰å‚æ•°æ—¶ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (append '(a) '(b c d)) =\<gtr\> '(a b c d))

    (check (append '(a b) 'c) =\<gtr\> '(a b . c))

    \;

    (check (append () 'c) =\<gtr\> 'c)

    (check (append) =\<gtr\> '())

    \;
  </scm-chunk>

  <paragraph|count><index|count>

  <scm|count>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ï¼›è¿”å›æ»¡è¶³è°“è¯æ¡ä»¶çš„å…ƒç´ åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (count pred list1 . lists)

    \ \ (let lp ((lis list1) (i 0))

    \ \ \ \ (if (null-list? lis) i

    \ \ \ \ \ \ \ \ (lp (cdr lis) (if (pred (car lis)) (+ i 1) i)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (count even? '(3 1 4 1 5 9 2 5 6)) =\<gtr\> 3)

    \;
  </scm-chunk>

  <subsection|æŠ˜å å’Œæ˜ å°„>

  <r7rs><paragraph|map><index|map>

  <scm|map>æ˜¯S7çš„å†…ç½®é«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºä»å‚æ•°ï¼ŒæŠŠè¯¥å‡½æ•°åº”ç”¨äºè¯¥åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (map square (list 1 2 3 4 5)) =\<gtr\> '(1 4 9 16 25))

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|for-each><index|for-each><scm|(for-each proc list1 [list2 ...])>

  <scm|for-each>æ˜¯S7å†…ç½®çš„é«˜é˜¶å‡½æ•°ã€‚<scm|for-each>çš„å‚æ•°ä¸<scm|map>çš„å‚æ•°ç±»ä¼¼ï¼Œä½†<scm|for-each>è°ƒç”¨<scm|proc>æ˜¯ä¸ºäº†å®ƒçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯ä¸ºäº†å®ƒçš„è¿”å›å€¼ã€‚ä¸<scm|map>ä¸åŒï¼Œ<scm|for-each>ä¿è¯ä¼šæŒ‰ç…§ä»ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°æœ€åä¸€ä¸ªå…ƒç´ çš„é¡ºåºè°ƒç”¨<scm|proc>ï¼Œå¹¶ä¸”<scm|for-each>è¿”å›çš„å€¼æ˜¯æœªæŒ‡å®šçš„ã€‚å¦‚æœç»™å‡ºäº†å¤šä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸”ä¸æ˜¯æ‰€æœ‰åˆ—è¡¨çš„é•¿åº¦éƒ½ç›¸åŒï¼Œ<scm|for-each>ä¼šåœ¨æœ€çŸ­çš„åˆ—è¡¨ç”¨å°½æ—¶ç»ˆæ­¢ã€‚å½“<scm|proc>ä¸æ¥å—ä¸<scm|lists>æ•°é‡ç›¸åŒçš„å‚æ•°ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check

    \ \ (let ((v (make-vector 5)))

    \ \ \ \ (for-each (lambda (i) (vector-set! v i (* i i)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (iota 5))

    \ \ \ \ v)

    \ \ =\<gtr\> #(0 1 4 9 16))

    \;

    (check

    \ \ (let ((v (make-vector 5 #f)))

    \ \ \ \ (for-each (lambda (i) (vector-set! v i (* i i)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (iota 4))

    \ \ \ \ v)

    \ \ =\<gtr\> #(0 1 4 9 #f))

    \;

    (check

    \ \ (let ((v (make-vector 5 #f)))

    \ \ \ \ (for-each (lambda (i) (vector-set! v i (* i i)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (iota 0))

    \ \ \ \ v)

    \ \ =\<gtr\> #(#f #f #f #f #f))

    \;
  </scm-chunk>

  \;

  <paragraph|fold><index|fold>

  <scm|fold>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªåˆå§‹å€¼å’Œä¸€ä¸ªåˆ—è¡¨ï¼Œå°†å‡½æ•°ç´¯ç§¯åœ°åº”ç”¨åˆ°ä¸€ä¸ªåˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ä¸Šï¼Œä»å·¦åˆ°å³ï¼Œä»è€Œå°†åˆ—è¡¨æŠ˜å æˆä¸€ä¸ªå•ä¸€çš„å€¼ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (fold f initial l)

    \ \ (when (not (procedure? f))

    \ \ \ \ (error 'type-error "The first param must be a procedure"))

    \ \ (if (null? l)

    \ \ \ \ \ \ initial

    \ \ \ \ \ \ (fold f

    \ \ \ \ \ \ \ \ \ \ \ \ (f (car l) initial)

    \ \ \ \ \ \ \ \ \ \ \ \ (cdr l))))

    \;
  </scm-chunk>

  è¿™æ˜¯SRFI-1å®˜æ–¹æä¾›çš„å®ç°ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸ç”¨ã€‚

  <\scm-code>
    (define (fold kons knil lis1 . lists)

    \ \ (if (pair? lists)

    \ \ \ \ \ \ (let lp ((lists (cons lis1 lists)) (ans knil))

    \ \ \ \ \ \ \ \ (receive (cars+ans cdrs) (%cars+cdrs+ lists ans)

    \ \ \ \ \ \ \ \ \ \ (if (null? cars+ans) ans

    \ \ \ \ \ \ \ \ \ \ \ \ \ (lp cdrs (apply kons cars+ans)))))

    \;

    \ \ \ \ \ \ (let lp ((lis lis1) (ans knil))

    \ \ \ \ \ \ \ \ (if (null-list? lis) ans

    \ \ \ \ \ \ \ \ \ \ \ \ (lp (cdr lis) (kons (car lis) ans))))))
  </scm-code>

  å¸¸è§çš„ç”¨æ³•ï¼š

  ä»åˆå§‹å€¼å¼€å§‹ï¼Œä¾æ¬¡ç´¯åŠ åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ•°ï¼›å½“åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨æ—¶ï¼Œè¿”å›åˆå§‹å€¼ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fold + 0 '(1 2 3 4)) =\<gtr\> 10)

    (check (fold + 0 '()) =\<gtr\> 0)

    \;

    (check-catch 'type-error (fold 0 + '(1 2 3 4)))

    \;
  </scm-chunk>

  åè½¬åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fold cons () '(1 2 3 4)) =\<gtr\> '(4 3 2 1))

    \;
  </scm-chunk>

  ç»Ÿè®¡åˆ—è¡¨ä¸­æ»¡è¶³è°“è¯çš„å…ƒç´ æ•°é‡ï¼Œè¿”å›è¿™ä¸ªæ•°é‡ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (fold (lambda (x count) (if (symbol? x) (+ count 1) count))

    \ \ \ \ \ \ \ \ 0

    \ \ \ \ \ \ \ \ '(a b 1 2 3 4))

    \ \ =\<gtr\> 2)

    \;
  </scm-chunk>

  <paragraph|fold-right><index|fold-right>

  <scm|fold-right>ä¸<scm|fold>ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œ<scm|fold-right>æ˜¯ä»å³åˆ°å·¦æŠ˜å ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (fold-right f initial l)

    \ \ (if (null? l)

    \ \ \ \ initial

    \ \ \ \ (f (car l)

    \ \ \ \ \ \ \ \ (fold-right f

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ initial

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cdr l)))))

    \;
  </scm-chunk>

  è¿™æ˜¯SRFI-1å®˜æ–¹æä¾›çš„å®ç°ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸ç”¨ï¼š

  <\scm-code>
    (define (fold-right kons knil lis1 . lists)

    \ \ (if (pair? lists)

    \ \ \ \ \ \ (let recur ((lists (cons lis1 lists)))

    \ \ \ \ \ \ \ \ (let ((cdrs (%cdrs lists)))

    \ \ \ \ \ \ \ \ \ \ (if (null? cdrs) knil

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply kons (%cars+ lists (recur cdrs))))))

    \;

    \ \ \ \ \ \ (let recur ((lis lis1))

    \ \ \ \ \ \ \ \ (if (null-list? lis) knil

    \ \ \ \ \ \ \ \ \ \ \ \ (let ((head (car lis)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (kons head (recur (cdr lis))))))))
  </scm-code>

  åœ¨ç”¨ä½œç´¯åŠ ã€ç»Ÿè®¡æ—¶ï¼Œ<scm|fold-right>ä¸<scm|fold>çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fold-right + 0 '(1 2 3 4)) =\<gtr\> 10)

    \;

    (check (fold-right + 0 '()) =\<gtr\> 0)

    \;

    (check

    \ \ (fold-right (lambda (x count) (if (symbol? x) (+ count 1) count))

    \ \ \ \ \ \ \ \ 0

    \ \ \ \ \ \ \ \ '(a b 1 2 3 4))

    \ \ =\<gtr\>

    \ \ 2)

    \;
  </scm-chunk>

  ä½†<scm|fold-right>ä¸<scm|fold>çš„æŠ˜å æ–¹å‘æ˜¯ç›¸åçš„ï¼Œè¿™å°±ä½¿å¾—åˆ—è¡¨åŸæœ¬çš„é¡ºåºå¾—ä»¥ä¿æŒï¼Œä¸ä¼šåè½¬ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (fold-right cons () '(1 2 3 4)) =\<gtr\> '(1 2 3 4))

    \;
  </scm-chunk>

  <paragraph|reduce><index|reduce>

  <scm|reduce>ä¸<scm|fold>ç±»ä¼¼ï¼Œä½†æœ‰å¾®å¦™ä¸”å…³é”®çš„ä¸åŒã€‚åªæœ‰åœ¨åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨æ—¶ï¼Œæ‰ä¼šä½¿ç”¨è¿™ä¸ªåˆå§‹å€¼ã€‚åœ¨åˆ—è¡¨ä¸æ˜¯ç©ºåˆ—è¡¨æ—¶ï¼Œåˆ™æŠŠåˆ—è¡¨çš„<scm|\<less\>car\<gtr\>>éƒ¨åˆ†å–å‡ºä½œä¸º<scm|fold>çš„åˆå§‹å€¼ï¼ŒåˆæŠŠåˆ—è¡¨çš„<scm|\<less\>cdr\<gtr\>>éƒ¨åˆ†å–å‡ºä½œä¸º<scm|fold>çš„åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (reduce f initial l)

    \ \ (if (null-list? l) initial

    \ \ \ \ \ \ (fold f (car l) (cdr l))))

    \;
  </scm-chunk>

  åœ¨ç”¨ä½œç´¯åŠ æ—¶ï¼Œ<scm|reduce>ä¸<scm|fold>çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (reduce + 0 '(1 2 3 4)) =\<gtr\> 10)

    (check (reduce + 0 '()) =\<gtr\> 0)

    \;
  </scm-chunk>

  ä¸é€‚ç”¨äºåè½¬åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œä½†å½“åˆ—è¡¨éç©ºï¼Œè¿”å›çš„ä¸å†æ˜¯åˆ—è¡¨ï¼Œè€Œæ˜¯åºå¯¹ã€‚å› ä¸º<scm|reduce>ä¼šæŠŠéç©ºåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å–å‡ºæ¥ä½œä¸º<scm|fold>çš„åˆå§‹å€¼ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (reduce cons () '(1 2 3 4)) =\<gtr\> '(4 3 2 . 1))

    \;
  </scm-chunk>

  ä¸é€‚ç”¨äºç»Ÿè®¡åˆ—è¡¨ä¸­æ»¡è¶³è°“è¯çš„å…ƒç´ æ•°é‡ï¼Œå› ä¸º<scm|reduce>ä¼šæŠŠéç©ºåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å–å‡ºæ¥ä½œä¸º<scm|fold>çš„åˆå§‹å€¼ï¼Œå¼•å‘é”™è¯¯ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check-catch 'wrong-type-arg\ 

    \ \ (reduce (lambda (x count) (if (symbol? x) (+ count 1) count))

    \ \ \ \ \ \ \ \ \ \ 0

    \ \ \ \ \ \ \ \ \ \ '(a b 1 2 3 4)))

    \;
  </scm-chunk>

  <paragraph|reduce-right><index|reduce-right>

  <scm|reduce-right>ä¸<scm|reduce>ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œ<scm|reduce-right>æ˜¯ä»å³åˆ°å·¦è§„çº¦ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (reduce-right f initial l)

    \ \ (if (null-list? l) initial

    \ \ \ \ \ \ (let recur ((head (car l)) (l (cdr l)))

    \ \ \ \ \ \ \ \ (if (pair? l)

    \ \ \ \ \ \ \ \ \ \ \ \ (f head (recur (car l) (cdr l)))

    \ \ \ \ \ \ \ \ \ \ \ \ head))))

    \;
  </scm-chunk>

  åœ¨ç”¨ä½œç´¯åŠ æ—¶ï¼Œ<scm|reduce-right>ä¸<scm|fold>çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (reduce-right + 0 '(1 2 3 4)) =\<gtr\> 10)

    \;

    (check (reduce-right + 0 '()) =\<gtr\> 0)

    \;
  </scm-chunk>

  ä¹Ÿä¸é€‚ç”¨äºé‡åˆ—åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œä»¥åŠç»Ÿè®¡åˆ—è¡¨ä¸­æ»¡è¶³è°“è¯çš„å…ƒç´ æ•°é‡ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (reduce-right cons () '(1 2 3 4))

    \ \ \ \ \ \ \ =\<gtr\> '(1 2 3 . 4) )

    \;

    (check

    \ \ (reduce-right (lambda (x count) (if (symbol? x) (+ count 1) count))

    \ \ \ \ \ \ \ \ 0

    \ \ \ \ \ \ \ \ '(a b 1 2 3 4))

    \ \ =\<gtr\> 6)

    \;
  </scm-chunk>

  <paragraph|append-map><index|append-map>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define append-map

    \ \ (typed-lambda ((proc procedure?) (lst list?))

    \ \ \ \ (let loop ((rest lst)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (result '()))

    \ \ \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ \ \ \ \ result

    \ \ \ \ \ \ \ \ \ \ (loop (cdr rest)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (append result (proc (car rest))))))))

    \;
  </scm-chunk>

  \;

  <subsection|è¿‡æ»¤å’Œåˆ†ç»„>

  <paragraph|filter><index|filter>

  <scm|filter>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­ç­›å‡ºæ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œç»„æˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œè¿”å›è¿™ä¸ªæ–°åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (filter pred l)

    \ \ (let recur ((l l))

    \ \ \ \ (if (null-list? l) l

    \ \ \ \ \ \ \ \ (let ((head (car l))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (tail (cdr l)))

    \ \ \ \ \ \ \ \ \ \ (if (pred head)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (let ((new-tail (recur tail)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (eq? tail new-tail) l

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons head new-tail)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (recur tail))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (filter even? '(-2 -1 0 1 2)) =\<gtr\> '(-2 0 2))

    \;
  </scm-chunk>

  <paragraph|partition><index|partition>

  <scm|partition>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­åˆ†åˆ«ç­›å‡ºæ»¡è¶³å’Œä¸æ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œå„ç»„æˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œè¿”å›ä»¥è¿™ä¸¤ä¸ªæ–°åˆ—è¡¨ç»„æˆçš„åºå¯¹ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (partition pred l)

    \ \ (let loop ((lst l) (satisfies '()) (dissatisfies '()))

    \ \ \ \ (cond ((null? lst)

    \ \ \ \ \ \ \ \ \ \ \ (cons satisfies dissatisfies))

    \ \ \ \ \ \ \ \ \ \ ((pred (car lst))

    \ \ \ \ \ \ \ \ \ \ \ (loop (cdr lst) (cons (car lst) satisfies) dissatisfies))

    \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ (loop (cdr lst) satisfies (cons (car lst) dissatisfies))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (partition symbol? '(one 2 3 four five 6))

    \ \ =\<gtr\> (cons '(five four one) '(6 3 2)))

    \;
  </scm-chunk>

  <paragraph|remove><index|remove>

  <scm|remove>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œä»è¿™ä¸ªåˆ—è¡¨ä¸­å»æ‰æ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œç»„æˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œè¿”å›è¿™ä¸ªæ–°åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (remove pred l)

    \ \ (filter (lambda (x) (not (pred x))) l))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (remove even? '(-2 -1 0 1 2)) =\<gtr\> '(-1 1))

    \;
  </scm-chunk>

  <subsection|æœç´¢>

  <paragraph|memq><index|memq>

  <scm|memq>æ˜¯ä¸€ä¸ªS7å†…ç½®å‡½æ•°ï¼Œå’Œ<scm|member>ç±»ä¼¼ï¼Œä½†åˆ¤æ–­å…ƒç´ ç­‰ä»·çš„è°“è¯æ˜¯<scm|eq?>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ£€æŸ¥çš„æ˜¯ä¸¤ä¸ªå…ƒç´ åœ¨æ˜¯å¦æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå³å®ƒä»¬æ˜¯å¦å…·æœ‰ç›¸åŒçš„å†…å­˜åœ°å€ã€‚

  å¯¹æ¯”ä½¿ç”¨<scm|equal?>çš„<scm|member>æˆ–ä½¿ç”¨<scm|<scm|eqv?>>çš„<scm|memv>ï¼Œè¿™ç§æ£€æŸ¥æœ€ä¸ºâ€œä¸¥æ ¼â€ï¼Œé€‚ç”¨äºåˆ¤æ–­çš„å…ƒç´ ç±»å‹æœ€å°‘ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œé€‚ç”¨äºåˆ¤æ–­å¸ƒå°”å€¼ï¼ˆ<scm|#t>ã€<scm|#f>ï¼‰ã€ç¬¦å·ã€æ•´æ•°ï¼ˆæµ®ç‚¹æ•°å’Œå¤æ•°ä¸è¡Œï¼‰ã€å‡½æ•°ï¼ˆçš„å€¼ï¼‰è¿™äº›ç±»å‹çš„å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (memq #f '(1 #f 2 3)) =\<gtr\> '(#f 2 3))

    (check (memq 'a '(1 a 2 3)) =\<gtr\> '(a 2 3))

    (check (memq 2 '(1 2 3)) =\<gtr\> '(2 3))

    \;

    (check (memq 2.0 '(1 2.0 3)) =\<gtr\> #f)

    (check (memq 2+0i '(1 2+0i 3)) =\<gtr\> #f)

    \;

    (define num1 3)

    (define num2 3)

    (check (memq num1 '(3 num2)) =\<gtr\> '(3 num2))

    (check (memq 3 '(num1 num2)) =\<gtr\> #f)

    (check (memq 'num1 '(num1 num2)) =\<gtr\> '(num1 num2))

    \;

    (check (memq (+ 1 1) '(1 2 3)) =\<gtr\> '(2 3))

    \;
  </scm-chunk>

  <paragraph|memv><index|memv>

  <scm|memv>æ˜¯ä¸€ä¸ªS7å†…ç½®å‡½æ•°ï¼Œå’Œ<scm|member>ç±»ä¼¼ï¼Œä½†åˆ¤æ–­å…ƒç´ å…ƒç´ çš„è°“è¯æ˜¯<scm|eqv?>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ£€æŸ¥çš„æ˜¯ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸åŒæˆ–åœ¨æ•°å€¼ä¸Šç­‰ä»·ã€‚

  æ¯”ä½¿ç”¨<scm|equal?>çš„<scm|member>â€œä¸¥æ ¼â€ï¼Œä½†æ¯”ä½¿ç”¨<scm|<scm|eq?>>çš„<scm|memq>â€œå®½æ¾â€ï¼Œé€‚ç”¨äºåˆ¤æ–­çš„å…ƒç´ ç±»å‹æ¬¡å…¨ï¼ˆ<scm|memv>èƒ½å®ç°çš„åŠŸèƒ½<scm|member>éƒ½èƒ½å®ç°ï¼‰ï¼Œé€Ÿåº¦ä¸­ç­‰ï¼Œé€‚ç”¨äºåˆ¤æ–­æ•°å€¼ç±»å…ƒç´ ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°ï¼‰æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ã€‚ä½†æ˜¯æ³¨æ„ï¼Œå³ä½¿æ•°å€¼ç›¸åŒä¹Ÿä¸è§†ä¸ºåŒä¸€å…ƒç´ ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (memv 2 '(1 2 3)) =\<gtr\> '(2 3))

    (check (memv 2.0 '(1 2.0 3)) =\<gtr\> '(2.0 3))

    (check (memv 2+0i '(1 2+0i 3)) =\<gtr\> '(2+0i 3))

    \;

    (check (memv 2 '(1 2.0 3)) =\<gtr\> #f)

    (check (memv 2 '(1 2+0i 3)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|member><index|member>

  <scm|member>æ˜¯ä¸€ä¸ªS7å†…ç½®å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå…ƒç´ å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œè¿”å›åŒ…å«è¯¥å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­åˆ—è¡¨ã€‚å½“å…ƒç´ ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè¿”å›<scm|#f>ã€‚å½“åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (member 2 '(1 2 3)) =\<gtr\> '(2 3))

    (check (member 0 '(1 2 3)) =\<gtr\> #f)

    (check (member 0 '()) =\<gtr\> #f)

    \ 
  </scm-chunk>

  æ³¨æ„ï¼Œåˆ¤æ–­ä¸¤ä¸ªå…ƒç´ ç­‰ä»·çš„è°“è¯æ˜¯<scm|equal?>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ£€æŸ¥çš„æ˜¯ä¸¤ä¸ªå…ƒç´ åœ¨ç»“æ„å’Œå†…å®¹ä¸Šæ˜¯å¦ç­‰ä»·ã€‚

  å¯¹æ¯”ä½¿ç”¨<scm|eq?>çš„<scm|memq>æˆ–ä½¿ç”¨<scm|<scm|eqv?>>çš„<scm|memv>ï¼Œè¿™ç§æ£€æŸ¥æœ€ä¸ºâ€œå®½æ¾â€ï¼Œé€‚ç”¨åˆ¤æ–­çš„å…ƒç´ ç±»å‹æœ€å…¨ï¼Œä½†é€Ÿåº¦æœ€æ…¢ï¼ˆå› ä¸ºå®ƒä¼šé€’å½’åœ°æ¯”è¾ƒå¤åˆæ•°æ®ç»“æ„çš„æ¯ä¸ªéƒ¨åˆ†ï¼‰ï¼Œå»ºè®®ç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²ã€åºå¯¹ã€åˆ—è¡¨è¿™äº›ç±»å‹çš„å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œå¦‚æœæ— éœ€åˆ¤æ–­è¿™äº›ç±»å‹ï¼Œå»ºè®®é€‰ç”¨<scm|memv>æˆ–<scm|memq>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (member "1" '(0 "1" 2 3)) =\<gtr\> '("1" 2 3))

    (check (member '(1 . 2) '(0 (1 . 2) 3)) =\<gtr\> '((1 . 2) 3))

    (check (member '(1 2) '(0 (1 2) 3)) =\<gtr\> '((1 2) 3))

    \;
  </scm-chunk>

  <paragraph|find><index|find>

  <scm|find>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œè¿”å›è¯¥åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³è°“è¯çš„å…ƒç´ ã€‚å½“åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨ï¼Œæˆ–åˆ—è¡¨ä¸­æ²¡æœ‰æ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (find pred l)

    \ \ (cond ((null? l) #f)

    \ \ \ \ \ \ \ \ ((pred (car l)) (car l))\ 

    \ \ \ \ \ \ \ \ (else (find pred (cdr l)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (find even? '(3 1 4 1 5 9)) =\<gtr\> 4)

    \;

    (check (find even? '()) =\<gtr\> #f)

    \;

    (check (find even? '(1 3 5 7 9)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|take-while><index|take-while>

  <scm|take-while>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼ŒæŒ‰åˆ—è¡¨é¡ºåºç­›å‡ºæ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œç›´åˆ°ä¸æ»¡è¶³è°“è¯çš„é‚£ä¸ªä¸€ä¸ªå°±åœæ­¢ç­›é€‰ï¼Œè¿”å›ç­›å‡ºçš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (take-while pred lst)

    \ \ (if (null? lst)\ 

    \ \ \ \ \ \ '()

    \ \ \ \ \ \ (if (pred (car lst))

    \ \ \ \ \ \ \ \ \ \ (cons (car lst) (take-while pred (cdr lst)))

    \ \ \ \ \ \ \ \ \ \ '())))

    \;
  </scm-chunk>

  å½“å‚æ•°çš„åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨ï¼Œæ— è®ºè°“è¯æ˜¯ä»€ä¹ˆéƒ½è¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check <code*|(take-while even? '())> =\<gtr\> '())

    \;
  </scm-chunk>

  å½“åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³è°“è¯ï¼Œè¿”å›åŸåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (take-while (lambda (x) #t) '(1 2 3))

    \ \ =\<gtr\> '(1 2 3))

    \;
  </scm-chunk>

  å½“åˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ æ»¡è¶³è°“è¯ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (take-while (lambda (x) #f) '(1 2 3))

    \ \ =\<gtr\> '())

    \;
  </scm-chunk>

  å½“åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±ä¸æ»¡è¶³è°“è¯ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (take-while (lambda (x) (not (= x 1))) '(1 2 3))

    \ \ =\<gtr\> '())

    \;
  </scm-chunk>

  ç­›å‡ºå…ƒç´ çš„è¿‡ç¨‹æŒ‰ç…§åˆ—è¡¨çš„é¡ºåºè¿›è¡Œï¼Œå½“ä¸€ä¸ªå…ƒç´ å·²ç»ä¸æ»¡è¶³è°“è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¹‹åçš„å…ƒç´ ä¸ä¼šè¢«ç­›å‡ºã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (take-while (lambda (x) (\<less\> x 3)) '(1 2 3 0))

    \ \ =\<gtr\> '(1 2))

    \;
  </scm-chunk>

  <paragraph|drop-while><index|drop-while>

  <scm|drop-while>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼ŒæŒ‰åˆ—è¡¨é¡ºåºä¸¢æ‰æ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œç›´åˆ°ä¸æ»¡è¶³è°“è¯çš„é‚£ä¸ªä¸€ä¸ªå°±åœæ­¢ä¸¢æ‰ï¼Œè¿”å›å‰©ä¸‹çš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (drop-while pred l)

    \ \ (if (null? l)

    \ \ \ \ \ \ '()

    \ \ \ \ \ \ (if (pred (car l))

    \ \ \ \ \ \ \ \ \ \ (drop-while pred (cdr l))

    \ \ \ \ \ \ \ \ \ \ l)))

    \;
  </scm-chunk>

  å½“åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (drop-while even? '()) =\<gtr\> '())

    \;
  </scm-chunk>

  å½“åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³è°“è¯ï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (drop-while (lambda (x) #t) '(1 2 3)) =\<gtr\> '())

    \;
  </scm-chunk>

  å½“åˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ æ»¡è¶³è°“è¯ï¼Œè¿”å›åŸåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (drop-while (lambda (x) #f) '(1 2 3)) =\<gtr\> '(1 2 3))

    \;
  </scm-chunk>

  å½“åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±ä¸æ»¡è¶³è°“è¯ï¼Œè¿”å›åŸåˆ—è¡¨ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (drop-while (lambda (x) (not (= x 1))) '(1 2 3))

    \ \ =\<gtr\> '(1 2 3))

    \;
  </scm-chunk>

  <paragraph|list-index><index|list-index>

  <scm|list-index>æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªè°“è¯å’Œä¸€ä¸ªåˆ—è¡¨ä¸ºå‚æ•°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆè°“è¯è¦æ±‚çš„å…ƒç´ çš„ä½ç½®ç´¢å¼•ã€‚å½“åˆ—è¡¨ä¸ºç©ºåˆ—è¡¨ï¼Œæˆ–åˆ—è¡¨ä¸­æ²¡æœ‰æ»¡è¶³è°“è¯çš„å…ƒç´ ï¼Œè¿”å›<scm|#f>ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (list-index pred l)

    \ \ \ \ (let loop ((index 0) (l l))

    \ \ \ \ \ \ (if (null? l)

    \ \ \ \ \ \ \ \ \ \ #f

    \ \ \ \ \ \ \ \ \ \ (if (pred (car l))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ index

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ index 1) (cdr l))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (list-index even? '(3 1 4 1 5 9)) =\<gtr\> 2)

    (check (list-index even? '()) =\<gtr\> #f)

    (check (list-index even? '(1 3 5 7 9)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|any><index|any>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (any pred? l)

    \ \ (cond ((null? l) #f)

    \ \ \ \ \ \ \ \ ((pred? (car l)) #t)

    \ \ \ \ \ \ \ \ (else (any pred? (cdr l)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (any integer? '()) =\<gtr\> #f)

    (check (any integer? '(a 3.14 "3")) =\<gtr\> #f)

    (check (any integer? '(a 3.14 3)) =\<gtr\> #t)

    \;
  </scm-chunk>

  <paragraph|every><index|every>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (every pred? l)

    \ \ (cond ((null? l) #t)

    \ \ \ \ \ \ \ \ ((not (pred? (car l))) #f)

    \ \ \ \ \ \ \ \ (else (every pred? (cdr l)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (every integer? '()) =\<gtr\> #t)

    (check (every integer? '(a 3.14 3)) =\<gtr\> #f)

    (check (every integer? '(1 2 3)) =\<gtr\> #t)

    \;
  </scm-chunk>

  <subsection|åˆ é™¤>

  å…¬å…±å­å‡½æ•°ï¼Œç”¨äºå¤„ç†å¯é€‰çš„<scm|maybe-equal>å‚æ•°ã€‚

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (%extract-maybe-equal maybe-equal)

    \ \ (let ((my-equal (if (null-list? maybe-equal)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car maybe-equal))))

    \ \ \ \ (if (procedure? my-equal)

    \ \ \ \ \ \ \ \ my-equal

    \ \ \ \ \ \ \ \ (error 'wrong-type-arg "maybe-equal must be procedure"))))
  </scm-chunk>

  <paragraph|delete><index|delete>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    (define (delete x l . maybe-equal)

    \ \ (let ((my-equal (%extract-maybe-equal maybe-equal)))

    \ \ \ \ (filter (lambda (y) (not (my-equal x y))) l)))

    \;
  </scm-chunk>

  æµ‹è¯•ç”¨ä¾‹

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (delete 1 (list 1 2 3 4)) =\<gtr\> (list 2 3 4))

    \;

    (check (delete 0 (list 1 2 3 4)) =\<gtr\> (list 1 2 3 4))

    \;

    (check (delete #\\a (list #\\a #\\b #\\c) char=?)

    \ \ \ \ \ \ \ =\<gtr\> (list #\\b #\\c))

    \;

    (check (delete #\\a (list #\\a #\\b #\\c) (lambda (x y) #f))

    \ \ \ \ \ \ \ =\<gtr\> (list #\\a #\\b #\\c))

    \;

    (check (delete 1 (list )) =\<gtr\> (list ))

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda ()

    \ \ \ \ \ \ (check (delete 1 (list 1 2 3 4) 'not-pred) =\<gtr\> 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;
  </scm-chunk>

  <paragraph|delete-duplicates><index|delete-duplicates>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|true>
    ;;; right-duplicate deletion

    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    ;;; delete-duplicates delete-duplicates!

    ;;;

    ;;; Beware -- these are N^2 algorithms. To efficiently remove duplicates

    ;;; in long lists, sort the list to bring duplicates together, then use a

    ;;; linear-time algorithm to kill the dups. Or use an algorithm based on

    ;;; element-marking. The former gives you O(n lg n), the latter is linear.

    \;

    (define (delete-duplicates lis . maybe-equal)

    \ \ (let ((my-equal (%extract-maybe-equal maybe-equal)))

    \ \ \ \ (let recur ((lis lis))

    \ \ \ \ \ \ (if (null-list? lis)

    \ \ \ \ \ \ \ \ \ \ lis

    \ \ \ \ \ \ \ \ \ \ (let* ((x (car lis))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (tail (cdr lis))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (new-tail (recur (delete x tail my-equal))))

    \ \ \ \ \ \ \ \ \ \ \ \ (if (eq? tail new-tail)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lis

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cons x new-tail)))))))

    \;
  </scm-chunk>

  æµ‹è¯•ç”¨ä¾‹

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (delete-duplicates (list 1 1 2 3)) =\<gtr\> (list 1 2 3))

    (check (delete-duplicates (list 1 2 3)) =\<gtr\> (list 1 2 3))

    (check (delete-duplicates (list 1 1 1)) =\<gtr\> (list 1))

    \;

    (check (delete-duplicates (list )) =\<gtr\> (list ))

    \;

    (check (delete-duplicates (list 1 1 2 3) (lambda (x y) #f))

    \ \ \ \ \ \ \ =\<gtr\> (list 1 1 2 3))

    \;
  </scm-chunk>

  å¦‚æœåˆ¤æ–­ç›¸ç­‰çš„å‡½æ•°ç±»å‹ä¸æ­£ç¡®ï¼Œä¼šæŠ¥é”™ï¼š

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda

    \ \ \ \ \ \ ()

    \ \ \ \ \ \ (check (delete-duplicates (list 1 1 2 3) 'not-pred) =\<gtr\> 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\> #t)

    \;
  </scm-chunk>

  <section|ä¸‰é²¤æ‰©å±•åº“>

  <paragraph|length=?><index|length=?><scm|(x l) =\<gtr\> boolean>

  <\description>
    <item*|x>æœŸæœ›çš„åˆ—è¡¨é•¿åº¦ï¼Œå¦‚æœé•¿åº¦ä¸ºè´Ÿæ•°ï¼Œè¯¥å‡½æ•°ä¼šæŠ›å‡º<scm|value-error>

    <item*|l>åˆ—è¡¨
  </description>

  å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªåˆ—è¡¨<scm|l>çš„é•¿åº¦æ˜¯å¦ä¸º<scm|x>ã€‚ç”±äº<scm|(= x (length l))>è¿™ç§åˆ¤æ–­æ–¹å¼çš„å¤æ‚åº¦æ˜¯<math|O<around*|(|n|)>>ï¼Œæ•…è€Œéœ€è¦<scm|length=?>è¿™ç§å¿«é€Ÿçš„åˆ¤æ–­æ–¹å¼ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check-true (length=? 3 (list 1 2 3)))

    (check-false (length=? 2 (list 1 2 3)))

    (check-false (length=? 4 (list 1 2 3)))

    \;

    (check-true (length=? 0 (list )))

    (check-catch 'value-error (length=? -1 (list )))

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (length=? x scheme-list)

    \ \ (when (\<less\> x 0)

    \ \ \ \ (value-error "length=?: expected non-negative integer x but received ~d" x))

    \ \ (cond ((and (= x 0) (null? scheme-list)) #t)

    \ \ \ \ \ \ \ \ ((or (= x 0) (null? scheme-list)) #f)

    \ \ \ \ \ \ \ \ (else (length=? (- x 1) (cdr scheme-list)))))

    \;
  </scm-chunk>

  <paragraph|length\<gtr\>?><scm|(lst len) =\<gtr\> bool><index|length\<gtr\>?>

  ä½¿ç”¨è´ªå¿ƒç­–ç•¥ï¼Œå…ˆè®¿é—®åˆ—è¡¨çš„å‰lenä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨é•¿åº¦ä¸å¤§äºlenï¼Œé‚£ä¹ˆè¿”å›å¸ƒå°”å€¼å‡ï¼Œå¦åˆ™è¿”å›å¸ƒå°”å€¼çœŸã€‚lstå¹¶ä¸ä¸€å®šæ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„åˆ—è¡¨ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ æ˜¯ç©ºåˆ—è¡¨ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯åºå¯¹ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (length\<gtr\>? lst len)

    \ \ (let loop ((lst lst)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (cnt 0))

    \ \ \ \ (cond ((null? lst) (\<less\> len cnt))

    \ \ \ \ \ \ \ \ \ \ ((pair? lst) (loop (cdr lst) (+ cnt 1)))

    \ \ \ \ \ \ \ \ \ \ (else (\<less\> len cnt)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check-true (length\<gtr\>? '(1 2 3 4 5) 3))

    (check-false (length\<gtr\>? '(1 2) 3))

    (check-false (length\<gtr\>? '() 0))

    \;

    (check-true (length\<gtr\>? '(1) 0))

    (check-false (length\<gtr\>? '() 1))

    \;

    (check-false (length\<gtr\>? '(1 2 . 3) 2))

    (check-true (length\<gtr\>? '(1 2 . 3) 1))

    \;
  </scm-chunk>

  <paragraph|length\<gtr\>=?><scm|(lst len) =\<gtr\> bool><index|length\<gtr\>=?>

  ä½¿ç”¨è´ªå¿ƒç­–ç•¥ï¼Œå…ˆè®¿é—®åˆ—è¡¨çš„å‰lenä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨é•¿åº¦å°äºlenï¼Œé‚£ä¹ˆè¿”å›å¸ƒå°”å€¼å‡ï¼Œå¦åˆ™è¿”å›å¸ƒå°”å€¼çœŸã€‚lstå¹¶ä¸ä¸€å®šæ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„åˆ—è¡¨ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ æ˜¯ç©ºåˆ—è¡¨ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯åºå¯¹ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (length\<gtr\>=? lst len)

    \ \ (let loop ((lst lst)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (cnt 0))

    \ \ \ \ (cond ((null? lst) (\<less\>= len cnt))

    \ \ \ \ \ \ \ \ \ \ ((pair? lst) (loop (cdr lst) (+ cnt 1)))

    \ \ \ \ \ \ \ \ \ \ (else (\<less\>= len cnt)))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check-true (length\<gtr\>=? '(1 2 3 4 5) 3))

    (check-false (length\<gtr\>=? '(1 2) 3))

    (check-true (length\<gtr\>=? '() 0))

    \;

    (check-true (length\<gtr\>=? '(1) 0))

    (check-false (length\<gtr\>=? '() 1))

    \;

    (check-false (length\<gtr\>=? '(1 2 . 3) 3))

    (check-true (length\<gtr\>=? '(1 2 . 3) 2))

    \;
  </scm-chunk>

  <paragraph|list-view><index|list-view>

  ç”±äºSchemeçš„Listå’Œæ•°æ®çš„æµå‘æ˜¯ç›¸åçš„ï¼š

  <\scm-code>
    (map (lambda (x) (* x x))

    \ \ \ \ \ (map (lambda (x) (+ x 1))

    \ \ \ \ \ \ \ \ \ \ (list 1 2 3)))
  </scm-code>

  \;

  æ‰€ä»¥æˆ‘ä»¬å®ç°äº†<scm|list-view>ï¼Œé‡‡ç”¨å’ŒScalaçš„Listç±»ä¼¼çš„è¯­æ³•æ¥å¤„ç†æ•°æ®ï¼š

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check ((list-view (list 1 2 3))) =\<gtr\> (list 1 2 3))

    \;

    (check (((list-view (list 1 2 3))

    \ \ \ \ \ \ \ \ map (lambda (x) (+ x 1)))) =\<gtr\> (list 2 3 4))

    \;

    (check (((list-view (list 1 2 3))

    \ \ \ \ \ \ \ \ map (lambda (x) (+ x 1))

    \ \ \ \ \ \ \ \ map (lambda (x) (* x x))))

    \ \ \ \ \ \ \ =\<gtr\> (list 4 9 16))

    \;
  </scm-chunk>

  <scm|(list-view 1 2 3)>å¾—åˆ°çš„æ˜¯å‡½æ•°ï¼Œéœ€è¦åœ¨å¤–é¢å†åŠ ä¸€å±‚æ‹¬å·æ‰èƒ½å¾—åˆ°<scm|(list 1 2 3)>ã€‚

  <\big-figure|<wide-tabular|<tformat|<table|<row|<\cell>
    <\scm-code>
      (map (lambda (x) (* x x))

      \ \ \ \ \ (map (lambda (x) (+ x 1))

      \ \ \ \ \ \ \ \ \ \ (list 1 2 3)))
    </scm-code>
  </cell>|<\cell>
    <\scm-code>
      (((list-view 1 2 3)

      \ \ \ \ \ \ \ \ map (lambda (x) (+ x 1))

      \ \ \ \ \ \ \ \ map (lambda (x) (* x x))))
    </scm-code>
  </cell>>>>>>
    ä½¿ç”¨listå¤„ç†æ•°æ®å’Œä½¿ç”¨list-viewå¤„ç†æ•°æ®çš„å¯¹æ¯”
  </big-figure>

  å®ç°list-viewæ—¶éœ€è¦è€ƒè™‘ä¸‰ç§æƒ…å†µå’Œä¸€ç§ä¾‹å¤–æƒ…å†µã€‚

  <\description>
    <item*|æ— å‚æ•°>ä¹Ÿå°±æ˜¯ç›´æ¥åœ¨list-viewå¾—åˆ°çš„ç»“æœå¤–é¢æ·»åŠ æ‹¬å·ï¼Œæ­¤æ—¶å¾—åˆ°çš„æ˜¯list-viewå¯¹åº”çš„list

    <item*|æœ‰ä¸¤ä¸ªå‚æ•°>è¿™é‡Œä¸¾ä¾‹è¯´æ˜ï¼Œ<scm|((list-view 1 2 3) map (lambda (x) (+ x 1)))>å®é™…çš„è®¡ç®—è¿‡ç¨‹æ˜¯ï¼š

    <\enumerate>
      <item>è®¡ç®—å¹¶å¾—åˆ°ç»“æœ<scm|(map (lambda (x) (+ x 1)) (list 1 2 3)) =\<gtr\> (list 2 3 4)>

      <item>å°†è®¡ç®—ç»“æœåŒ…è£…åˆ° <scm|list-view> é‡Œé¢ï¼Œè¿™é‡Œä½¿ç”¨äº†<scm|apply>è¿™ä¸ªå†…ç½®å‡½æ•°
    </enumerate>

    å…¶å®ä¹Ÿæ˜¯æ ‘çš„è½¬æ¢ï¼š

    <\big-figure|<scm|<tree|(list-view 1 2 3)|map|(lambda (x) (+ x 1))>><space|2em><math|\<Rightarrow\>><space|2em><scm|<tree|map|(lambda (x) (+ x 1))|(list 1 2 3)>>>
      åŸç†çš„å¯è§†åŒ–
    </big-figure>

    <item*|å¶æ•°ä¸ªå‚æ•°>åœ¨ä¸Šè¿°ä¸¤ä¸ªé€’å½’é€€å‡ºæ¡ä»¶å†™å¥½çš„æƒ…å†µä¸‹ï¼Œåœ¨æ€è€ƒè¿™ç§ä¸€èˆ¬çš„æƒ…å†µã€‚

    éœ€è¦è®¡ç®—<scm|((list-view 1 2 3) hf1 f1 hf2 f2 ... hfn fn)>ï¼Œå…¶ä¸­hfæŒ‡çš„æ˜¯high-order functionï¼Œä¹Ÿå°±æ˜¯é«˜é˜¶å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯éœ€è¦è®¡ç®—ï¼š

    <\scm>
      ((((list-view 1 2 3) hf1 f1) hf2 f2) ... hfn fn)
    </scm>

    \;
  </description>

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (list-view scheme-list)

    \ \ (define (f-inner-reducer scheme-list filter filter-func rest-funcs)

    \ \ \ \ (cond ((null? rest-funcs) (list-view (filter filter-func scheme-list)))

    \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ (f-inner-reducer (filter filter-func scheme-list)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car rest-funcs)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cadr rest-funcs)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr rest-funcs)))))

    \ \ (define (f-inner . funcs)

    \ \ \ \ (cond ((null? funcs) scheme-list)

    \ \ \ \ \ \ \ \ \ \ ((length=? 2 funcs)

    \ \ \ \ \ \ \ \ \ \ \ (list-view ((car funcs) (cadr funcs) scheme-list)))

    \ \ \ \ \ \ \ \ \ \ ((even? (length funcs))

    \ \ \ \ \ \ \ \ \ \ \ (f-inner-reducer scheme-list

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (car funcs)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cadr funcs)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (cddr funcs)))

    \ \ \ \ \ \ \ \ \ \ (else (error 'wrong-number-of-args

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "list-view only accepts even number of args"))))

    \ \ f-inner)

    \;
  </scm-chunk>

  <paragraph|flatmap><index|flatmap>

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define flatmap append-map)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (flatmap (lambda (x) (list x x))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (list 1 2 3))

    \ \ =\<gtr\> (list 1 1 2 2 3 3))

    \;

    (check-catch 'type-error (flatmap 1 (list 1 2 3)))

    \;
  </scm-chunk>

  \;

  <paragraph|not-null-list?><index|not-null-list?>

  <scm|null-list?>çš„åé¢ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (not-null-list? l)

    \ \ (cond ((pair? l)

    \ \ \ \ \ \ \ \ \ (or (null? (cdr l)) (pair? (cdr l))))

    \ \ \ \ \ \ \ \ ((null? l) #f)

    \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ (error 'type-error "type mismatch"))))

    \;
  </scm-chunk>

  <paragraph|list-null?><index|null-list?>

  <scm|null-list?>çš„æ²¡æœ‰å¼‚å¸¸çš„ç‰ˆæœ¬ï¼Œåªè¦ä¸æ˜¯<scm|list>ï¼Œéƒ½æ˜¯<scm|#f>ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (list-null? l)

    \ \ (and (not (pair? l)) (null? l)))

    \;
  </scm-chunk>

  <paragraph|list-not-null?><index|list-not-null?>

  <scm|not-null-list?>çš„æ²¡æœ‰å¼‚å¸¸çš„ç‰ˆæœ¬ã€‚

  \;

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define (list-not-null? l)

    \ \ (and (pair? l)

    \ \ \ \ \ \ \ (or (null? (cdr l)) (pair? (cdr l)))))

    \;
  </scm-chunk>

  \;

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    (check (not-null-list? (list 1)) =\<gtr\> #t)

    (check (list-not-null? (list 1)) =\<gtr\> #t)

    (check (list-null? (list 1)) =\<gtr\> #f)

    \;

    (check (not-null-list? (list 1 2 3)) =\<gtr\> #t)

    (check (list-not-null? (list 1 2 3)) =\<gtr\> #t)

    (check (list-null? (list 1 2 3)) =\<gtr\> #f)

    \;

    (check (not-null-list? '(a)) =\<gtr\> #t)

    (check (list-not-null? '(a)) =\<gtr\> #t)

    (check (list-null? '(a)) =\<gtr\> #f)

    \;

    (check (not-null-list? '(a b c)) =\<gtr\> #t)

    (check (list-not-null? '(a b c)) =\<gtr\> #t)

    (check (list-null? '(a b c)) =\<gtr\> #f)

    \;

    (check (not-null-list? ()) =\<gtr\> #f)

    (check (list-not-null? ()) =\<gtr\> #f)

    (check (list-null? ()) =\<gtr\> #t)

    \;

    ; '(a) is a pair and a list

    ; '(a . b) is a pair but not a list

    (check (not-null-list? '(a . b)) =\<gtr\> #f)

    (check (list-not-null? '(a . b)) =\<gtr\> #f)

    (check (list-null? '(a . b)) =\<gtr\> #f)

    \;

    (check-catch 'type-error (not-null-list? 1))

    (check (list-not-null? 1) =\<gtr\> #f)

    (check (list-null? 1) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|flatten><index|flatten><scm|(lst [depth]) =\<gtr\> lst>

  (lst [depth]) =\<gtr\> lst

  å‹å¹³ lstï¼Œå‹ä¸ºæ›´æ‰çš„å½¢çŠ¶ã€‚ç›´è§‚æ¥è¯´ï¼Œå»æ‰å†…å±‚åˆ—è¡¨çš„æ‹¬å·ã€‚ä¾‹å¦‚ï¼Œ<scm|(flatten '(a b (c (d)) (e) ((f))) 'deepest) =\<gtr\> (a b c d e f)>ã€‚å‚æ•° depth å¯é€‰ï¼Œé»˜è®¤ä¸º 1ï¼ŒæŒ‡å®šæœ€æ·±å‹å¹³å±‚æ•°ï¼Œdepth ä¸º <scm|n> æ—¶ï¼Œæœ€æ·±å‹å¹³ n å±‚åˆ—è¡¨ï¼Œdepth ä¸º <scm|'deepest> æ—¶ï¼Œå‹å¹³æ•´ä¸ªåˆ—è¡¨ã€‚

  æ³¨æ„ï¼Œå®šä¹‰ flatten åº”å½“ä½¿ç”¨ <scm|define*> è€Œé <scm|define> ä»¥æ”¯æŒå¯é€‰å‚æ•°ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    (define* (flatten lst (depth 1))
  </scm-chunk>

  åŒ…è£…ä¸€èˆ¬åŒ–çš„ flattenï¼Œä½¿ç”¨ <scm|set-cdr!> åŠ é€Ÿæ„å»ºåˆ—è¡¨ï¼Œ

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    \ \ (define (flatten-depth-iter rest depth res-node)

    \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ \ \ res-node

    \ \ \ \ \ \ \ \ (let ((first (car rest))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (tail \ (cdr rest)))

    \ \ \ \ \ \ \ \ \ \ (cond ((and (null? first) (not (= 0 depth)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-depth-iter tail depth res-node))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((or (= depth 0) (not (pair? first)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (set-cdr! res-node (cons first '()))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-depth-iter tail depth (cdr res-node)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-depth-iter

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tail

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ depth

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-depth-iter

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (- depth 1)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res-node)))))))
  </scm-chunk>

  å› ä¸ºè¦ <scm|set-cdr!> å‚æ•° <scm|res-node> ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯åè€…æ˜¯ pairï¼Œä¸èƒ½æ˜¯ nullã€‚ä¸ºè¾¾æˆè¿™ä¸ªç›®çš„ï¼Œå¯ä»¥å…ˆ <scm|cons> ä¸€ä¸ª pairï¼Œä¹‹åè¿”å›å®ƒçš„ <scm|\<less\>cdr\<gtr\>>ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    \ \ (define (flatten-depth lst depth)

    \ \ \ \ (let ((res (cons #f '())))

    \ \ \ \ \ \ (flatten-depth-iter lst depth res)

    \ \ \ \ \ \ (cdr res)))

    \;
  </scm-chunk>

  æ³¨æ„åˆ° flatten-depth-iter è¿­ä»£ä¸­ï¼ˆ<scm|cond> ç¬¬äºŒä¸ªå­å¥ï¼‰ï¼Œä¸æ–­ä¼ é€’ depth å‚æ•°ï¼Œåªæ˜¯é‡æ–°ç»‘å®šè€Œä¸åŠ æ”¹å˜ã€‚ç„¶è€Œ goldfish è®¿é—®è‡ªç”±å˜é‡ä¸æ¯”ç›´æ¥ä¼ é€’å‚æ•°æ•ˆç‡æ›´é«˜ï¼Œåªå¥½è¾—è½¬ä¼ é€’ depthã€‚<scm|(flatten-depth lst -1)> å›ºç„¶å¯ä»¥ç”¨æ¥å®ç° <scm|(flatten lst -1)>ï¼Œä½†æ€»æ˜¯é¢å¤–ä¼ é€’ä¸€ä¸ªæ— æ„ä¹‰çš„å‚æ•° depthï¼Œæ•ˆç‡è¾ƒä½ï¼Œå¯ä»¥é’ˆå¯¹è¿™ä¸€ç‚¹è¿›è¡Œä¼˜åŒ–ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    \ \ (define (flatten-deepest-iter rest res-node)

    \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ res-node

    \ \ \ \ \ \ (let ((first (car rest))

    \ \ \ \ \ \ \ \ \ \ \ \ (tail \ (cdr rest)))

    \ \ \ \ \ \ \ \ (cond ((pair? first)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-deepest-iter

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tail

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-deepest-iter

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res-node)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((null? first)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-deepest-iter tail res-node))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (set-cdr! res-node (cons first '()))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (flatten-deepest-iter tail (cdr res-node)))))))

    \ \ (define (flatten-deepest lst)

    \ \ \ \ (let ((res (cons #f '())))

    \ \ \ \ \ \ (flatten-deepest-iter lst res)

    \ \ \ \ \ \ (cdr res)))

    \;
  </scm-chunk>

  æœ€åï¼Œåˆ†æ´¾ <scm|flatten-depth> å’Œ <scm|flatten-deepest>ã€‚æ³¨æ„ <scm|flatten> å‚æ•° depth ä¸åº”è¯¥æ˜¯é™¤ <scm|n> å’Œ <scm|'deepest> ä»¥å¤–çš„ä»»ä½•å€¼ï¼Œå› è€Œï¼Œå½“å‡ºç°å…¶å®ƒå€¼æ—¶æŠ›å‡ºé”™è¯¯ã€‚

  <\scm-chunk|goldfish/liii/list.scm|true|true>
    \ \ (cond ((eq? depth 'deepest)

    \ \ \ \ \ \ \ \ \ (flatten-deepest lst))

    \ \ \ \ \ \ \ \ ((integer? depth)

    \ \ \ \ \ \ \ \ \ (flatten-depth lst depth))

    \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ (error 'type-error "flatten: the second argument depth should be symbol â€˜deepest' or a integer, which will be uesd as depth, but got a ~A" depth)))

    \ \ ) ; end of (define* (flatten))

    \;
  </scm-chunk>

  æµ‹è¯•ä»£ç å¦‚ä¸‹ã€‚

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|true>
    ; deepest flatten

    (check (flatten '((a) () (b ()) () (c)) 'deepest) =\<gtr\> '(a b c))

    (check (flatten '((a b) c (((d)) e)) 'deepest) =\<gtr\> '(a b c d e))

    (check (flatten '(a b (() (c))) 'deepest) =\<gtr\> '(a b c))

    ; depth flatten

    (check (flatten '((a) () (b ()) () (c)) 0) =\<gtr\> '((a) () (b ()) () (c)))

    (check (flatten '((a) () (b ()) () (c)) 1) =\<gtr\> '(a b () c))

    (check (flatten '((a) () (b ()) () (c))) =\<gtr\> '(a b () c))

    (check (flatten '((a) () (b ()) () (c)) 2) =\<gtr\> '(a b c))

    (check (flatten '((a) () (b ()) () (c)) -1) =\<gtr\> '(a b c))

    (check (flatten '((a b) c (((d)) e)) 0) =\<gtr\> '((a b) c (((d)) e)))

    (check (flatten '((a b) c (((d)) e)) 1) =\<gtr\> '(a b c ((d)) e))

    (check (flatten '((a b) c (((d)) e))) =\<gtr\> '(a b c ((d)) e))

    (check (flatten '((a b) c (((d)) e)) 2) =\<gtr\> '(a b c (d) e))

    (check (flatten '((a b) c (((d)) e)) 3) =\<gtr\> '(a b c d e))

    (check (flatten '((a b) c (((d)) e)) -1) =\<gtr\> '(a b c d e))

    (check (flatten '(a b (() (c))) 0) =\<gtr\> '(a b (() (c))))

    (check (flatten '(a b (() (c))) 1) =\<gtr\> '(a b () (c)))

    (check (flatten '(a b (() (c)))) =\<gtr\> '(a b () (c)))

    (check (flatten '(a b (() (c))) 2) =\<gtr\> '(a b c))

    (check (flatten '(a b (() (c))) -1) =\<gtr\> '(a b c))

    ; error depth flatten

    (check-catch 'type-error (flatten '((a) () (b ()) () (c)) 'a))

    (check-catch 'type-error (flatten '((a) () (b ()) () (c)) (make-vector 1 1)))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/list.scm|true|false>
    ) ; end of begin

    ) ; end of library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-1.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/list-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii vector)><label|chapter:liii_vector>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/vector.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    (define-library (srfi srfi-133)

    \;

    (export

    \ \ vector-empty?

    \ \ vector-count

    \ \ vector-any vector-every vector-copy vector-copy!

    \ \ vector-index vector-index-right vector-partition

    \ \ vector-swap!)

    (import (scheme base))

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/vector.scm|true|true>
    (define-library (liii vector)

    \;

    (export

    \ \ ; S7 Scheme built-in

    \ \ make-vector vector vector-length vector-ref vector-set! vector-\<gtr\>list list-\<gtr\>vector

    \ \ ; from (scheme base)

    \ \ vector-copy vector-fill! vector-copy! vector-\<gtr\>string string-\<gtr\>vector

    \ \ vector-map vector-for-each

    \ \ ; from (srfi srfi-133)

    \ \ vector-empty?

    \ \ vector-count

    \ \ vector-any vector-every vector-copy vector-copy!

    \ \ vector-index vector-index-right vector-partition

    \ \ vector-swap!)

    (import (srfi srfi-133)

    \ \ \ \ \ \ \ \ (scheme base))

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (import (liii list)

    \ \ \ \ \ \ \ \ (liii check)

    \ \ \ \ \ \ \ \ (liii vector)

    \ \ \ \ \ \ \ \ (only (scheme base) let-values))

    \;

    (check-set-mode! 'report-failed)

    \;

    (for-each (lambda (p) (check (procedure? p) =\<gtr\> #t))

    \ \ (list

    \ \ \ vector-empty?

    \ \ \ vector-count

    \ \ \ vector-any vector-every vector-copy vector-copy!

    \ \ \ vector-index vector-index-right vector-partition

    \ \ \ vector-swap!))

    \;
  </scm-chunk>

  <section|å®ç°>

  <subsection|æ„é€ å™¨>

  <r7rs><paragraph|make-vector><scm|(k [fill]) =\<gtr\> vector><index|make-vector>

  è¿”å›é•¿åº¦ä¸ºkçš„å‘é‡ï¼Œå¦‚æœæä¾›äº†fillï¼Œåˆ™é‡‡ç”¨fillä½œä¸ºæ¯ä¸€ä¸ªå…ƒç´ çš„åˆå§‹å€¼ï¼Œå¦åˆ™æ¯ä¸€ä¸ªå…ƒç´ çš„åˆå§‹å€¼æ˜¯æœªæŒ‡å®šã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (make-vector 1 1) =\<gtr\> (vector 1))

    (check (make-vector 3 'a) =\<gtr\> (vector 'a 'a 'a))

    \;

    (check (make-vector 0) =\<gtr\> (vector ))

    (check (vector-ref (make-vector 1) 0) =\<gtr\> #\<less\>unspecified\<gtr\>)

    \;
  </scm-chunk>

  <r7rs><paragraph|vector><scm|(obj1 obj2 ...) =\<gtr\> vector><index|vector>

  è¿”å›ä¸€ä¸ªæ–°åˆ†é…çš„å‘é‡ï¼Œå…¶å…ƒç´ åŒ…å«ç»™å®šçš„å‚æ•°ã€‚ç±»ä¼¼äº<scm|list>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector 'a 'b 'c) =\<gtr\> #(a b c))

    (check (vector) =\<gtr\> #())

    \;
  </scm-chunk>

  <paragraph|int-vector><scm|(integer integer ...) =\<gtr\> vector><index|int-vector>

  è¿”å›ä¸€ä¸ªæ‰€æœ‰å…ƒç´ éƒ½æ˜¯integerç±»å‹çš„int-vectorã€‚int-vectoræ˜¯vectorçš„å­ç±»å‹ã€‚

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check-true (vector? (int-vector 1 2 3)))

    (check-catch 'wrong-type-arg (int-vector 1 2 'a))

    \;

    (let1 v (int-vector 1 2 3)

    \ \ (check (vector-ref v 0) =\<gtr\> 1)

    \ \ (check (vector-ref v 1) =\<gtr\> 2)

    \ \ (check (vector-ref v 2) =\<gtr\> 3))

    \;
  </scm-chunk>

  <paragraph|vector-unfold>

  <paragraph|vector-unfold-right>

  <r7rs><paragraph|vector-copy><scm|(v [start [end]]) =\<gtr\> vector><index|vector-copy>

  è¿”å›ä¸€ä¸ªæ–°çš„åˆ†é…å‰¯æœ¬ï¼ŒåŒ…å«ç»™å®šå‘é‡ä»å¼€å§‹åˆ°ç»“æŸçš„å…ƒç´ ã€‚æ–°å‘é‡çš„å…ƒç´ ä¸æ—§å‘é‡çš„å…ƒç´ ç›¸åŒï¼ˆåœ¨eqv?çš„æ„ä¹‰ä¸Šï¼‰ã€‚

  <\scm-code>
    (define (vector-copy v)

    \ \ (let ((new-v (make-vector (vector-length v))))

    \ \ \ \ (let loop ((i 0))

    \ \ \ \ \ \ \ \ \ (if (= i (vector-length v))

    \ \ \ \ \ \ \ \ \ \ \ \ \ new-v

    \ \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (vector-set! new-v i (vector-ref v i))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1)))))))
  </scm-code>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define* (vector-copy v (start 0) (end (vector-length v)))

    \ \ (if (or (\<gtr\> start end) (\<gtr\> end (vector-length v)))

    \ \ \ \ \ \ (error 'out-of-range "vector-copy")

    \ \ \ \ \ \ (let ((new-v (make-vector (- end start))))

    \ \ \ \ \ \ \ \ (let loop ((i start) (j 0))

    \ \ \ \ \ \ \ \ \ \ (if (\<gtr\>= i end)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ new-v

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (vector-set! new-v j (vector-ref v i))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) (+ j 1))))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-copy #(0 1 2 3)) =\<gtr\> #(0 1 2 3))

    (check (vector-copy #(0 1 2 3) 1) =\<gtr\> #(1 2 3))

    (check (vector-copy #(0 1 2 3) 3) =\<gtr\> #(3))

    (check (vector-copy #(0 1 2 3) 4) =\<gtr\> #())

    \;

    (check-catch 'out-of-range (vector-copy #(0 1 2 3) 5))

    (check-catch 'out-of-range (vector-copy #(0 1 2 3) 1 5))

    \;

    (define my-vector #(0 1 2 3))

    (check (eqv? my-vector (vector-copy #(0 1 2 3))) =\<gtr\> #f)

    (check-true

    \ \ (eqv? (vector-ref my-vector 2)

    \ \ \ \ \ \ \ \ (vector-ref (vector-copy #(0 1 2 3)) 2)))

    \;

    (check (vector-copy #(0 1 2 3) 1 1) =\<gtr\> #())

    (check (vector-copy #(0 1 2 3) 1 2) =\<gtr\> #(1))

    (check (vector-copy #(0 1 2 3) 1 4) =\<gtr\> #(1 2 3))

    \;
  </scm-chunk>

  <paragraph|vector-reverse-copy>

  <r7rs><paragraph|vector-append><scm|(v1 v2 v3 ...) =\<gtr\> vector><index|vector-append>

  è¿”å›ä¸€ä¸ªæ–°åˆ†é…çš„å‘é‡ï¼Œå…¶å…ƒç´ æ˜¯ç»™å®šå‘é‡çš„å…ƒç´ çš„æ‹¼æ¥ã€‚è¿™æ˜¯ä¸€ä¸ªS7å†…ç½®çš„å‡½æ•°ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector-append #(0 1 2) #(3 4 5)) =\<gtr\> #(0 1 2 3 4 5))

    \;
  </scm-chunk>

  <subsection|è°“è¯>

  <paragraph|vector?><index|vector?><scm|(vector? obj) =\<gtr\> bool>

  å¦‚æœobjæ˜¯ä¸€ä¸ªå‘é‡è¿”å›<scm|#t>ï¼Œå¦åˆ™è¿”å›<scm|#f>ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector? #(1 2 3)) =\<gtr\> #t)

    (check (vector? #()) =\<gtr\> #t)

    (check (vector? '(1 2 3)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|int-vector?><scm|(int-vector? obj) =\<gtr\> bool>

  åªæœ‰ä½¿ç”¨int-vectoræ„é€ çš„vectorï¼Œæ‰èƒ½åœ¨åˆ¤å®šä¸ºçœŸã€‚

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check-true (int-vector? (int-vector 1 2 3)))

    (check-false (int-vector? (vector 1 2 3)))

    \;
  </scm-chunk>

  <paragraph|vector-empty?><index|vector-empty?>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    (define (vector-empty? v)

    \ \ (when (not (vector? v))

    \ \ \ \ (error 'type-error "v is not a vector"))

    \ \ (zero? (vector-length v)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check-true (vector-empty? (vector)))

    (check-false (vector-empty? (vector 1)))

    (check-catch 'type-error (vector-empty? 1))

    \;
  </scm-chunk>

  <paragraph|vector=>

  <subsection|é€‰æ‹©å™¨>

  <r7rs><paragraph|vector-length><scm|(v) =\<gtr\> integer><index|vector-length>

  ä»¥æ•´æ•°è¿”å›å‘é‡ä¸­å…ƒç´ çš„æ•°é‡ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector-length #(1 2 3)) =\<gtr\> 3)

    (check (vector-length #()) =\<gtr\> 0)

    \;
  </scm-chunk>

  <r7rs><paragraph|vector-ref><scm|(vector-ref v k )><index|vector-ref>

  è¿”å›å‘é‡ä¸­ç´¢å¼•ä¸º k çš„å…ƒç´ çš„å†…å®¹ã€‚å½“ k ä¸æ˜¯å‘é‡çš„æœ‰æ•ˆç´¢å¼•ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector-ref #(1 2 3) 0) =\<gtr\> 1)

    (check (vector-ref #(1 2 3) 2) =\<gtr\> 3)

    \;

    (check-catch 'out-of-range (vector-ref #(1 2 3) 3))

    (check-catch 'out-of-range (vector-ref #() 0))

    \ \ 

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (vector-ref #(1 2 3) 2.0))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \ \ 

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (vector-ref #(1 2 3) "2"))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <subsection|è¿­ä»£>

  <r7rs><paragraph|vector-map><index|vector-map>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define (vector-map p . args) (apply vector (apply map p args)))

    \;
  </scm-chunk>

  <r7rs><paragraph|vector-for-each><scm|(proc vector1 [vector2 ...])><index|vector-for-each>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define vector-for-each for-each)

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check

    \ \ (let ((lst (make-list 5)))

    \ \ \ \ (vector-for-each

    \ \ \ \ \ \ (lambda (i) (list-set! lst i (* i i)))

    \ \ \ \ \ \ #(0 1 2 3 4))

    \ \ \ \ lst)

    \ \ =\<gtr\> '(0 1 4 9 16))

    \;

    (check

    \ \ (let ((lst (make-list 5)))

    \ \ \ \ (vector-for-each

    \ \ \ \ \ \ (lambda (i) (list-set! lst i (* i i)))

    \ \ \ \ \ \ #(0 1 2))

    \ \ \ \ lst)

    \ \ =\<gtr\> '(0 1 4 #f #f))

    \;

    (check

    \ \ (let ((lst (make-list 5)))

    \ \ \ \ (vector-for-each

    \ \ \ \ \ \ (lambda (i) (list-set! lst i (* i i)))

    \ \ \ \ \ \ #())

    \ \ \ \ lst)

    \ \ =\<gtr\> '(#f #f #f #f #f))

    \;
  </scm-chunk>

  <paragraph|vector-count><index|vector-count>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    ; TODO optional parameters

    (define (vector-count pred v)

    \ \ (let loop ((i 0) (count 0))

    \ \ \ \ \ \ \ (cond ((= i (vector-length v)) count)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((pred (vector-ref v i))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) (+ count 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ i 1) count)))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-count even? #()) =\<gtr\> 0)

    (check (vector-count even? #(1 3 5 7 9)) =\<gtr\> 0)

    (check (vector-count even? #(1 3 4 7 8)) =\<gtr\> 2)

    \;
  </scm-chunk>

  <subsection|æœç´¢>

  <paragraph|vector-any><index|vector-any>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    ; TODO optional parameters

    (define (vector-any pred v)

    \ \ (let loop ((i 0))

    \ \ \ \ \ \ \ (cond ((= i (vector-length v)) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((pred (vector-ref v i)) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ i 1))))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-any even? #()) =\<gtr\> #f)

    (check (vector-any even? #(1 3 5 7 9)) =\<gtr\> #f)

    (check (vector-any even? #(1 3 4 7 8)) =\<gtr\> #t)

    \;
  </scm-chunk>

  <paragraph|vector-every><index|vector-every>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    ; TODO optional parameters

    (define (vector-every pred v)

    \ \ (let loop ((i 0))

    \ \ \ \ \ \ \ (cond ((= i (vector-length v)) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((not (pred (vector-ref v i))) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ i 1))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-every odd? #()) =\<gtr\> #t)

    (check (vector-every odd? #(1 3 5 7 9)) =\<gtr\> #t)

    (check (vector-every odd? #(1 3 4 7 8)) =\<gtr\> #f)

    \;
  </scm-chunk>

  <paragraph|vector-index><index|vector-index>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    ; TODO optional parameters

    (define (vector-index pred v)

    \ \ (let loop ((i 0))

    \ \ \ \ \ \ \ (cond ((= i (vector-length v)) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((pred (vector-ref v i)) i)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ i 1))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-index even? #()) =\<gtr\> #f)

    (check (vector-index even? #(1 3 5 7 9)) =\<gtr\> #f)

    (check (vector-index even? #(1 3 4 7 8)) =\<gtr\> 2)

    \;
  </scm-chunk>

  <paragraph|vector-index-right><index|vector-index-right>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    ; TODO optional parameters

    (define (vector-index-right pred v)

    \ \ (let ((len (vector-length v)))

    \ \ \ \ (let loop ((i (- len 1)))

    \ \ \ \ \ \ \ \ \ (cond ((\<less\> i 0) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((pred (vector-ref v i)) i)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (- i 1)))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-index-right even? #()) =\<gtr\> #f)

    (check (vector-index-right even? #(1 3 5 7 9)) =\<gtr\> #f)

    (check (vector-index-right even? #(1 3 4 7 8)) =\<gtr\> 4)

    \;
  </scm-chunk>

  <paragraph|vector-partition><index|vector-partition>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    (define (vector-partition pred v)

    \ \ (let* ((len (vector-length v))

    \ \ \ \ \ \ \ \ \ (cnt (vector-count pred v))

    \ \ \ \ \ \ \ \ \ (ret (make-vector len)))

    \ \ \ \ (let loop ((i 0) (yes 0) (no cnt))

    \ \ \ \ \ \ (if (= i len)

    \ \ \ \ \ \ \ \ (values ret cnt)

    \ \ \ \ \ \ \ \ (let ((elem (vector-ref v i)))

    \ \ \ \ \ \ \ \ \ \ (if (pred elem)

    \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (vector-set! ret yes elem)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) (+ yes 1) no))

    \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (vector-set! ret no elem)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ i 1) yes (+ no 1)))))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (define (vector-partition-\<gtr\>list pred v)

    \ \ (let-values (((ret cnt) (vector-partition pred v))) (list ret cnt)))

    \;

    (check (vector-partition-\<gtr\>list even? #()) =\<gtr\> '(#() 0))

    (check (vector-partition-\<gtr\>list even? #(1 3 5 7 9)) =\<gtr\> '(#(1 3 5 7 9) 0))

    (check (vector-partition-\<gtr\>list even? #(1 3 4 7 8)) =\<gtr\> '(#(4 8 1 3 7) 2))

    \;
  </scm-chunk>

  <subsection|ä¿®æ”¹å™¨>

  <r7rs><paragraph|vector-set!><scm|(vector-set! v k obj )><index|vector-set!>

  è¯¥å‡½æ•°å°†å¯¹è±¡ obj å­˜å‚¨åˆ°å‘é‡ä¸­ç´¢å¼•ä¸º k çš„å…ƒç´ é‡Œã€‚æ³¨æ„ï¼Œè¿”å›çš„ä¸æ˜¯å‘é‡ï¼Œè€Œæ˜¯é‚£ä¸ª objã€‚å½“ k ä¸æ˜¯å‘é‡çš„æœ‰æ•ˆç´¢å¼•ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (define my-vector #(0 1 2 3))

    (check my-vector =\<gtr\> #(0 1 2 3))

    \;

    (check (vector-set! my-vector 2 10) =\<gtr\> 10)

    (check my-vector =\<gtr\> #(0 1 10 3))

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-set! my-vector 4 10))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  <paragraph|vector-swap!><index|vector-swap!>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|true>
    (define (vector-swap! vec i j)

    \ \ (let ((elem-i (vector-ref vec i))

    \ \ \ \ \ \ \ \ (elem-j (vector-ref vec j)))

    \ \ \ \ (vector-set! vec i elem-j)

    \ \ \ \ (vector-set! vec j elem-i)

    \ \ \ \ ))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (define my-vector (vector 0 1 2 3))

    (vector-swap! my-vector 1 2)

    (check my-vector =\<gtr\> #(0 2 1 3))

    \;

    (define my-vector (vector 0 1 2 3))

    (vector-swap! my-vector 1 1)

    (check my-vector =\<gtr\> #(0 1 2 3))

    \;

    (define my-vector (vector 0 1 2 3))

    (vector-swap! my-vector 0 (- (vector-length my-vector) 1))

    (check my-vector =\<gtr\> #(3 1 2 0))

    \;

    (check-catch

    \ 'out-of-range

    \ (vector-swap! my-vector 1 (vector-length my-vector)))

    \;
  </scm-chunk>

  <r7rs><paragraph|vector-fill!><index|vector-fill!>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define vector-fill! fill!)

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (define my-vector (vector 0 1 2 3 4))

    (fill! my-vector #f)

    (check my-vector =\<gtr\> #(#f #f #f #f #f))\ 

    \;

    (define my-vector (vector 0 1 2 3 4))

    (fill! my-vector #f 1 2)

    (check my-vector =\<gtr\> #(0 #f 2 3 4))\ 

    \;
  </scm-chunk>

  <r7rs><paragraph|vector-copy!><scm|(vector-copy! to at from [start [end]])><index|vector-copy!>

  <scm|to>å’Œ<scm|from>éƒ½æ˜¯å‘é‡ï¼Œ<scm|vector-copy!>å°±æ˜¯ä»<scm|from>å‘é‡å¤åˆ¶å…ƒç´ ä¾æ¬¡ç²˜è´´åˆ°<scm|to>å‘é‡ï¼Œç²˜è´´ä»<scm|to>å‘é‡çš„ç¬¬<scm|at>ä¸ªç´¢å¼•ä½ç½®å¼€å§‹ï¼›<scm|start>å’Œ<scm|end>æ˜¯å¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šä»<scm|from>å‘é‡é€‰å–å…ƒç´ çš„èŒƒå›´ã€‚

  <\scm-code>
    a (vector "a0" "a1" "a2" "a3" "a4")

    b (vector "b0" "b1" "b2" "b3" "b4"

    \;

    (vector-copy! b 1 a 0 2) å°±æ˜¯ï¼š

    ç¬¬ä¸€æ­¥ï¼šä»aä¸­é€‰å–ç´¢å¼•ä¸º[0,2)çš„å…ƒç´ ï¼Œå³"a0" "a1"

    ç¬¬äºŒæ­¥ï¼šå®šä½åˆ°bçš„ç´¢å¼•ä¸º 1 çš„ä½ç½®ï¼Œå³"b1"æ‰€åœ¨çš„é‚£ä¸ªä½ç½®

    ç¬¬äºŒæ­¥ï¼šä»¥åˆšåˆšå®šä½åˆ°çš„é‚£ä¸ª"b1"ä½ç½®ä¸ºèµ·ç‚¹ï¼ŒæŠŠåˆšåˆšé€‰å‡ºçš„å…ƒç´ "a0" "a1"ä¾æ¬¡æ›¿æ¢ï¼Œç›´åˆ°

    \;

    \;

    ä»£ç å®ç°æ—¶è¦æ³¨æ„

    atã€toã€fromçš„è¾¹ç•Œæ¡ä»¶ï¼ŒæŒ‰é¡ºåºå†™å®ƒä»¬ä¼šå¯¼è‡´æŠ¥é”™çš„æ¡ä»¶

    è¦æ³¨æ„æ¯ä¸€ä¸ªå‚æ•°åœ¨åé¢ä¼šé‡åˆ°æ€æ ·çš„ä½¿ç”¨

    \;

    ç¬¬ä¸€æ­¥ï¼šåªæ¶‰åŠå•ä¸ªå‚æ•°çš„æŠ¥é”™æ¡ä»¶

    (\<less\> at 0) å¯çœå»

    (\<gtr\> at (vector-length to)) å¯çœå»

    (\<less\> start 0)

    (\<less\> start 0)

    (\<gtr\> start (vector-length from))

    (\<less\> end 0)

    (\<gtr\> end (vector-length from))

    \;

    ç¬¬äºŒæ­¥ï¼šä¸¤ä¸ªä¾èµ–å…³ç³»çš„å‚æ•°çš„æŠ¥é”™æ¡ä»¶

    (\<gtr\> start end)

    \;

    ç¬¬ä¸‰æ­¥ï¼šä¸‰ä¸ªä¾èµ–å…³ç³»å‚æ•°çš„æŠ¥é”™æ¡ä»¶

    (\<gtr\> (+ at (- end start)) (vector-length to))

    \;

    ç»¼åˆä¸Šæ–¹çš„æŠ¥é”™æ¡ä»¶ï¼Œå»æ‰ä¸€äº›å¤šä½™çš„æ¡ä»¶ï¼š

    (\<less\> start 0)å¯çœå»

    å› ä¸ºæœ‰(\<gtr\> (+ at (- end start)) (vector-length to))ï¼Œæ‰€ä»¥(\<gtr\> at (vector-length to))å¯çœå»
  </scm-code>

  <\session|guile|default>
    <\input>
      \<gtr\>\ 
    <|input>
      (define a (vector "a0" "a1" "a2" "a3" "a4"))
    </input>

    <\input>
      \<gtr\>\ 
    <|input>
      (define b (vector "b0" "b1" "b2" "b3" "b4"))
    </input>

    <\input>
      \<gtr\>\ 
    <|input>
      (vector-copy! b 0 a 1)
    </input>

    <\unfolded-io>
      \<gtr\>\ 
    <|unfolded-io>
      b
    <|unfolded-io>
      <guile-result|#("a1" "a2" "a3" "a4" "b4")>
    </unfolded-io>

    <\folded-io>
      \<gtr\>\ 
    <|folded-io>
      a
    <|folded-io>
      <guile-result|#("a0" "a1" "a2" "a3" "a4")>
    </folded-io>

    <\input>
      \<gtr\>\ 
    <|input>
      \;
    </input>
  </session>

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    (define* (vector-copy! to at from (start 0) (end (vector-length from)))

    \ \ (if (or (\<less\> at 0)

    \ \ \ \ \ \ \ \ \ \ (\<gtr\> start (vector-length from))

    \ \ \ \ \ \ \ \ \ \ (\<less\> end 0)

    \ \ \ \ \ \ \ \ \ \ (\<gtr\> end (vector-length from))

    \ \ \ \ \ \ \ \ \ \ (\<gtr\> start end)

    \ \ \ \ \ \ \ \ \ \ (\<gtr\> (+ at (- end start)) (vector-length to)))

    \ \ \ \ \ \ (error 'out-of-range "vector-copy!")

    \ \ \ \ \ \ (let loop ((to-i at) (from-i start))

    \ \ \ \ \ \ \ \ (if (\<gtr\>= from-i end)

    \ \ \ \ \ \ \ \ \ \ \ \ to

    \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (vector-set! to to-i (vector-ref from from-i))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (+ to-i 1) (+ from-i 1)))))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (define a (vector "a0" "a1" "a2" "a3" "a4"))

    (define b (vector "b0" "b1" "b2" "b3" "b4"))

    \;

    ;(\<less\> at 0)

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b -1 a))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    ;(\<less\> start 0)

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 0 a -1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    ;(\<gtr\> start (vector-length from))

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 0 a 6))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    ;(\<gtr\> end (vector-length from))

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 0 a 0 6))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    ;(\<gtr\> start end)

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 0 a 2 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    ;(\<gtr\> (+ at (- end start)) (vector-length to))

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 6 a))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-copy! b 1 a))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (define a (vector "a0" "a1" "a2" "a3" "a4"))

    (define b (vector "b0" "b1" "b2" "b3" "b4"))

    (vector-copy! b 0 a 1)

    (check b =\<gtr\> #("a1" "a2" "a3" "a4" "b4"))

    \;

    (define a (vector "a0" "a1" "a2" "a3" "a4"))

    (define b (vector "b0" "b1" "b2" "b3" "b4"))

    (vector-copy! b 0 a 0 5)

    (check b =\<gtr\> #("a0" "a1" "a2" "a3" "a4"))\ 

    \;
  </scm-chunk>

  <subsection|è½¬æ¢>

  <r7rs><paragraph|vector-\<gtr\>list><scm|(vector-\<gtr\>list v [start [end]])><index|vector-\<gtr\>list>

  è¿”å›ä¸€ä¸ªæ–°åˆ†é…çš„åˆ—è¡¨ï¼ŒåŒ…å«å‘é‡ä¸­ä» start åˆ° end ä¹‹é—´çš„å…ƒç´ ä¸­çš„å¯¹è±¡ã€‚å½“ <scm|start>ã€<scm|end>ä¸æ˜¯å‘é‡çš„æœ‰æ•ˆç´¢å¼•ï¼ŒæŠ¥é”™ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|true>
    (check (vector-\<gtr\>list #()) =\<gtr\> '())

    (check (vector-\<gtr\>list #() 0) =\<gtr\> '())

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-\<gtr\>list #() 1))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check (vector-\<gtr\>list #(0 1 2 3)) =\<gtr\> '(0 1 2 3))

    (check (vector-\<gtr\>list #(0 1 2 3) 1) =\<gtr\> '(1 2 3))

    (check (vector-\<gtr\>list #(0 1 2 3) 1 1) =\<gtr\> '())

    (check (vector-\<gtr\>list #(0 1 2 3) 1 2) =\<gtr\> '(1))

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|list-\<gtr\>vector><scm|(list-\<gtr\>vector l)><index|list-\<gtr\>vector>

  è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„å‘é‡ï¼Œå…¶å…ƒç´ åˆå§‹åŒ–ä¸ºåˆ—è¡¨ <code*|list> ä¸­çš„å…ƒç´ ã€‚æ³¨æ„ï¼Œ<item*|list-\<gtr\>vector>ä¸åƒ<item*|vector-\<gtr\>list>é‚£æ ·å¯ç”¨æ¥æ”¶ç´¢å¼•å‚æ•°ã€‚

  <\scm-chunk|tests/goldfish/liii/base-test.scm|true|false>
    (check (list-\<gtr\>vector '(0 1 2 3)) =\<gtr\> #(0 1 2 3))

    (check (list-\<gtr\>vector '()) =\<gtr\> #())

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|vector-\<gtr\>string><scm|(v [start [end]]) =\<gtr\> string><index|vector-\<gtr\>string>

  å°†å‘é‡vè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚æœæŒ‡å®šäº†èµ·å§‹ç´¢å¼•å’Œç»ˆæ­¢ç´¢å¼•ï¼Œåˆ™åªå°†æŒ‡å®šèŒƒå›´å†…çš„å­å‘é‡è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    ; 0-clause BSD

    ; Bill Schottstaedt

    ; from S7 source repo: r7rs.scm

    (define* (vector-\<gtr\>string v (start 0) end)\ 

    \ \ (let ((stop (or end (length v))))\ 

    \ \ \ \ (copy v (make-string (- stop start)) start stop)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3)) =\<gtr\> "0123")

    (check (vector-\<gtr\>string (vector #\\a #\\b #\\c)) =\<gtr\> "abc")

    \;

    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 0 4) =\<gtr\> "0123")

    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 1) =\<gtr\> "123")

    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 1 4) =\<gtr\> "123")

    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 1 3) =\<gtr\> "12")

    (check (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 1 2) =\<gtr\> "1")

    \;

    (check

    \ \ (catch 'out-of-range

    \ \ \ \ (lambda () (vector-\<gtr\>string (vector #\\0 #\\1 #\\2 #\\3) 2 10))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;

    (check (vector-\<gtr\>string (vector 0 1 #\\2 3 4) 2 3) =\<gtr\> "2")

    \;

    (check

    \ \ (catch 'wrong-type-arg

    \ \ \ \ (lambda () (vector-\<gtr\>string (vector 0 1 #\\2 3 4) 1 3))

    \ \ \ \ (lambda args #t))

    \ \ =\<gtr\>

    \ \ #t)

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|string-\<gtr\>vector><scm|(s [start [end]]) =\<gtr\> vector><index|string-\<gtr\>vector>

  å°†å­—ç¬¦ä¸²sè½¬åŒ–ä¸ºå‘é‡ï¼Œå¦‚æœæŒ‡å®šäº†èµ·å§‹ç´¢å¼•å’Œç»ˆæ­¢ç´¢å¼•ï¼Œåˆ™åªå°†æŒ‡å®šèŒƒå›´å†…çš„å­å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå‘é‡ã€‚

  <\scm-chunk|goldfish/scheme/base.scm|true|true>
    ; 0-clause BSD

    ; Bill Schottstaedt

    ; from S7 source repo: r7rs.scm

    (define* (string-\<gtr\>vector s (start 0) end)

    \ \ (let ((stop (or end (length s))))\ 

    \ \ \ \ (copy s (make-vector (- stop start)) start stop)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|true>
    (check (string-\<gtr\>vector "0123") =\<gtr\> (vector #\\0 #\\1 #\\2 #\\3))

    (check (string-\<gtr\>vector "abc") =\<gtr\> (vector #\\a #\\b #\\c))

    \;

    (check (string-\<gtr\>vector "0123" 0 4) =\<gtr\> (vector #\\0 #\\1 #\\2 #\\3))

    (check (string-\<gtr\>vector "0123" 1) =\<gtr\> (vector #\\1 #\\2 #\\3))

    (check (string-\<gtr\>vector "0123" 1 4) =\<gtr\> (vector #\\1 #\\2 #\\3))

    (check (string-\<gtr\>vector "0123" 1 3) =\<gtr\> (vector #\\1 #\\2))

    (check (string-\<gtr\>vector "0123" 1 2) =\<gtr\> (vector #\\1))

    \;

    (check-catch 'out-of-range (string-\<gtr\>vector "0123" 2 10))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/srfi/srfi-133.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/vector.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/vector-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii stack)>

  æ ˆæ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºï¼ˆFILOï¼‰çš„æ•°æ®ç»“æ„ã€‚

  è¿™ä¸ªå‡½æ•°åº“æ˜¯ä¸‰é²¤è‡ªå®šä¹‰çš„åº“ï¼Œå‚è€ƒäº†C++å’ŒJavaçš„æ ˆç›¸å…³çš„å‡½æ•°åº“çš„æ¥å£ã€‚

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/stack.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define-library (liii stack)

    (import (srfi srfi-9)

    \ \ \ \ \ \ \ \ (liii base)

    \ \ \ \ \ \ \ \ (liii error))

    (export

    \ stack

    \ stack? stack-empty?

    \ stack-size stack-top

    \ stack-push! stack-pop!

    \ stack-\<gtr\>list

    )

    (begin

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/stack-test.scm|false|false>
    (import (liii stack)

    \ \ \ \ \ \ \ \ (liii check))

    \;

    (check-set-mode! 'report-failed)

    \;

    (define stack1 (stack))

    (check (stack-empty? stack1) =\<gtr\> #t)

    (check (stack-\<gtr\>list stack1) =\<gtr\> '())

    (check-catch 'value-error (stack-pop! stack1))

    \;

    (stack-push! stack1 1)

    (check (stack-\<gtr\>list stack1) =\<gtr\> '(1))

    (check (stack-top stack1) =\<gtr\> 1)

    (check (stack-size stack1) =\<gtr\> 1)

    (check (stack-pop! stack1) =\<gtr\> 1)

    (check (stack-empty? stack1) =\<gtr\> #t)

    (check (stack-size stack1) =\<gtr\> 0)

    \;

    (define stack2 (stack 1 2 3))

    (check (stack-\<gtr\>list stack2) =\<gtr\> '(1 2 3))

    (check (stack-size stack2) =\<gtr\> 3)

    (check (stack-pop! stack2) =\<gtr\> 1)

    (check (stack-pop! stack2) =\<gtr\> 2)

    (check (stack-pop! stack2) =\<gtr\> 3)

    \;

    (define stack3 (stack ))

    (stack-push! stack3 1)

    (stack-push! stack3 2)

    (stack-push! stack3 3)

    (check (stack-pop! stack3) =\<gtr\> 3)

    (check (stack-pop! stack3) =\<gtr\> 2)

    (check (stack-pop! stack3) =\<gtr\> 1)

    \;

    (check-catch 'type-error (stack-empty? 1))

    \;
  </scm-chunk>

  <section|å®ç°>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define-record-type :stack

    \ \ (make-stack data)

    \ \ stack?

    \ \ (data get-data set-data!))

    \;

    (define (%stack-check-parameter st)

    \ \ (when (not (stack? st))

    \ \ \ \ (error 'type-error "Parameter st is not a stack")))

    \;
  </scm-chunk>

  <paragraph|stack><index|stack><scm|(x1 x2 ...) =\<gtr\> stack>

  ä¼ å…¥å‚æ•°ï¼Œæ„é€ ä¸€ä¸ªæ ˆï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ˆé¡¶ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™æ„é€ çš„æ˜¯ç©ºæ ˆã€‚

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack . l)

    \ \ (if (null? l)

    \ \ \ \ \ \ (make-stack '())

    \ \ \ \ \ \ (make-stack l)))

    \;
  </scm-chunk>

  <paragraph|stack-empty?><index|stack-empty?><scm|(st) =\<gtr\> bool>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-empty? st)

    \ \ (%stack-check-parameter st)

    \ \ (null? (get-data st)))

    \;
  </scm-chunk>

  <paragraph|stack-size><index|stack-size><scm|(st) =\<gtr\> int>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-size st)

    \ \ (%stack-check-parameter st)

    \ \ (length (get-data st)))

    \;
  </scm-chunk>

  <paragraph|stack-top><index|stack-top><scm|(st) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-top st)

    \ \ (%stack-check-parameter st)

    \ \ (car (get-data st)))

    \;
  </scm-chunk>

  <paragraph|stack-push!><index|stack-push!><scm|(st x) =\<gtr\> #\<less\>unspecified\<gtr\>>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-push! st elem)

    \ \ (%stack-check-parameter st)

    \ \ (set-data! st (cons elem (get-data st))))

    \;
  </scm-chunk>

  <paragraph|stack-pop!><index|stack-pop!><scm|(st) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-pop! st)

    \ \ (%stack-check-parameter st)

    \ \ (when (stack-empty? st)

    \ \ \ \ (error 'value-error "Failed to stack-pop! on empty stack"))

    \ \ (let1 data (get-data st)

    \ \ \ \ (set-data! st (cdr data))

    \ \ \ \ (car data)))

    \;
  </scm-chunk>

  <paragraph|stack-\<gtr\>list><index|stack-\<gtr\>list><scm|(st) =\<gtr\> list>

  <\scm-chunk|goldfish/liii/stack.scm|true|true>
    (define (stack-\<gtr\>list st)

    \ \ (%stack-check-parameter st)

    \ \ (get-data st))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/stack.scm|true|false>
    ) ; end of begin

    ) ; end of library

    \;
  </scm-chunk>

  <chapter|(liii queue)>

  è¿™ä¸ªå‡½æ•°åº“æ˜¯ä¸‰é²¤è‡ªå®šä¹‰çš„åº“ï¼Œå‚è€ƒäº†C++å’ŒJavaçš„é˜Ÿåˆ—ç›¸å…³çš„å‡½æ•°åº“çš„æ¥å£ã€‚ç›®å‰åŸºäºSchemeçš„åˆ—è¡¨å®ç°ï¼Œä»é˜Ÿåˆ—å–å‡ºæ•°æ®çš„å¤æ‚åº¦æ˜¯<math|O<around*|(|1|)>>ï¼Œä»é˜Ÿåˆ—å­˜å…¥æ•°æ®çš„å¤æ‚åº¦æ˜¯<math|O<around*|(|n|)>>ã€‚

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/queue.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/queue-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define-library (liii queue)

    (import (liii list)

    \ \ \ \ \ \ \ \ (liii base)

    \ \ \ \ \ \ \ \ (srfi srfi-9)

    \ \ \ \ \ \ \ \ (liii error))

    (export

    \ \ queue

    \ \ queue? queue-empty?

    \ \ queue-size queue-front queue-back

    \ \ queue-pop! queue-push!

    \ \ queue-\<gtr\>list)

    (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/queue-test.scm|true|true>
    (import (liii queue)

    \ \ \ \ \ \ \ \ (liii base)

    \ \ \ \ \ \ \ \ (liii check))

    \;

    (check-set-mode! 'report-failed)

    \;

    (let1 q1 (queue)

    \ \ (check-true (queue-empty? q1))

    \ \ (check (queue-size q1) =\<gtr\> 0)

    \ \ (check-catch 'value-error (queue-pop! q1))

    \;

    \ \ (queue-push! q1 1)

    \ \ (check (queue-size q1) =\<gtr\> 1)

    \ \ (check (queue-front q1) =\<gtr\> 1)

    \ \ (check (queue-back q1) =\<gtr\> 1)

    \ \ (check (queue-pop! q1) =\<gtr\> 1)

    \ \ (check-true (queue-empty? q1))

    )

    \;

    (let1 q2 (queue 1 2 3)

    \ \ (check (queue-size q2) =\<gtr\> 3)

    \ \ (check (queue-front q2) =\<gtr\> 1)

    \ \ (check (queue-back q2) =\<gtr\> 3)

    \ \ (check (queue-pop! q2) =\<gtr\> 1)

    \ \ (check (queue-pop! q2) =\<gtr\> 2)

    \ \ (check (queue-pop! q2) =\<gtr\> 3)

    )

    \;
  </scm-chunk>

  <section|å®ç°>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define-record-type :queue

    \ \ (make-queue data)

    \ \ queue?

    \ \ (data get-data set-data!))

    \;

    (define (%queue-assert-type q)

    \ \ (when (not (queue? q))

    \ \ \ \ (type-error "Parameter q is not a queue")))

    \;

    (define (%queue-assert-value q)

    \ \ (when (queue-empty? q)

    \ \ \ \ (value-error "q must be non-empty")))

    \;
  </scm-chunk>

  <paragraph|queue><index|queue>

  ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue . l)

    \ \ (if (null? l)

    \ \ \ \ \ \ (make-queue '())

    \ \ \ \ \ \ (make-queue l)))

    \;
  </scm-chunk>

  <paragraph|queue-empty?><index|queue-empty?><scm|(queue) =\<gtr\> bool>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-empty? q)

    \ \ (%queue-assert-type q)

    \ \ (null? (get-data q)))

    \;
  </scm-chunk>

  <paragraph|queue-size><index|queue-size><scm|(queue) =\<gtr\> int>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-size q)

    \ \ (%queue-assert-type q)

    \ \ (length (get-data q)))

    \;
  </scm-chunk>

  <paragraph|queue-front><index|queue-front><scm|(queue) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-front q)

    \ \ (%queue-assert-type q)

    \ \ (%queue-assert-value q)

    \ \ (first (get-data q)))

    \;
  </scm-chunk>

  <paragraph|queue-back><index|queue-back><scm|(queue) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-back q)

    \ \ (%queue-assert-type q)

    \ \ (%queue-assert-value q)

    \ \ (last (get-data q)))

    \;
  </scm-chunk>

  <paragraph|queue-push!><index|queue-push!><scm|(queue x) =\<gtr\> queue>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-push! q x)

    \ \ (%queue-assert-type q)

    \ \ (let1 data (get-data q)

    \ \ \ \ (set-data! q (append data (list x)))))

    \;
  </scm-chunk>

  <paragraph|queue-pop!><index|queue-pop!><scm|(queue) =\<gtr\> x>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-pop! q)

    \ \ (%queue-assert-type q)

    \ \ (%queue-assert-value q)

    \ \ (let1 data (get-data q)

    \ \ \ \ (set-data! q (cdr data))

    \ \ \ \ (car data)))

    \;
  </scm-chunk>

  <paragraph|queue-\<gtr\>list><index|queue-\<gtr\>list><scm|(queue) =\<gtr\> list>

  <\scm-chunk|goldfish/liii/queue.scm|true|true>
    (define (queue-\<gtr\>list q)

    \ \ (get-data q))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/queue.scm|true|false>
    ) ; end of begin

    ) ; end of library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/queue-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii comparator)>

  <section|è®¸å¯è¯>

  SRFI 128çš„å‚è€ƒå®ç°ä¾èµ–äºSRFI 39ã€‚æˆ‘ä»¬å¯ä»¥ç§»é™¤SRFI 128çš„å‚è€ƒå®ç°å¯¹äºSRFI 39çš„ä¾èµ–ã€‚

  <\scm-chunk|goldfish/liii/comparator.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|false|true>
    ;;; SPDX-License-Identifier: MIT

    ;;;

    ;;; Copyright (C) John Cowan (2015). All Rights Reserved.

    ;;;\ 

    ;;; Permission is hereby granted, free of charge, to any person

    ;;; obtaining a copy of this software and associated documentation

    ;;; files (the "Software"), to deal in the Software without

    ;;; restriction, including without limitation the rights to use,

    ;;; copy, modify, merge, publish, distribute, sublicense, and/or

    ;;; sell copies of the Software, and to permit persons to whom the

    ;;; Software is furnished to do so, subject to the following

    ;;; conditions:

    ;;;\ 

    ;;; The above copyright notice and this permission notice shall be

    ;;; included in all copies or substantial portions of the Software.

    ;;;\ 

    ;;; THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,

    ;;; EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES

    ;;; OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND

    ;;; NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT

    ;;; HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,

    ;;; WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING

    ;;; FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR

    ;;; OTHER DEALINGS IN THE SOFTWARE.\ 

    \;

    ;;;; Main part of the SRFI 114 reference implementation

    \;

    ;;; "There are two ways of constructing a software design: One way is to

    ;;; make it so simple that there are obviously no deficiencies, and the

    ;;; other way is to make it so complicated that there are no *obvious*

    ;;; deficiencies." --Tony Hoare

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/comparator.scm|true|true>
    (define-library (liii comparator)

    (import (srfi srfi-128))

    (export

    \ \ comparator? comparator-ordered? comparator-hashable?

    \ \ make-comparator make-pair-comparator make-list-comparator

    \ \ make-vector-comparator make-eq-comparator make-eqv-comparator make-equal-comparator

    \ \ boolean-hash char-hash char-ci-hash string-hash string-ci-hash

    \ \ symbol-hash number-hash

    \ \ make-default-comparator default-hash

    \ \ comparator-type-test-predicate comparator-equality-predicate

    \ \ comparator-ordering-predicate comparator-hash-function

    \ \ comparator-test-type comparator-check-type comparator-hash

    \ \ =? \<less\>? \<gtr\>? \<less\>=? \<gtr\>=?

    )

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define-library (srfi srfi-128)

    (import (scheme base)

    \ \ \ \ \ \ \ \ (liii error))

    (export

    \ \ comparator? comparator-ordered? comparator-hashable?

    \ \ make-comparator make-pair-comparator make-list-comparator

    \ \ make-vector-comparator make-eq-comparator make-eqv-comparator make-equal-comparator

    \ \ boolean-hash char-hash char-ci-hash string-hash string-ci-hash

    \ \ symbol-hash number-hash

    \ \ make-default-comparator default-hash

    \ \ comparator-type-test-predicate comparator-equality-predicate

    \ \ comparator-ordering-predicate comparator-hash-function

    \ \ comparator-test-type comparator-check-type comparator-hash

    \ \ =? \<less\>? \<gtr\>? \<less\>=? \<gtr\>=?

    )

    (begin

    \;
  </scm-chunk>

  <paragraph|comparator?><index|comparator?>

  <paragraph|comparator-ordered?><index|comparator-ordered?>

  <paragraph|comparator-hashable?><index|comparator-hashable?>

  <paragraph|comparator-type-test-predicate><index|comparator-type-test-predicate>

  <paragraph|comparator-equality-predicate><index|comparator-equality-predicate>

  <paragraph|comparator-ordering-predicate><index|comparator-ordering-predicate>

  <paragraph|comparator-hash-function><index|comparator-hash-function>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define-record-type comparator

    \ \ (make-raw-comparator type-test equality ordering hash ordering? hash?)

    \ \ comparator?

    \ \ (type-test comparator-type-test-predicate)

    \ \ (equality comparator-equality-predicate)

    \ \ (ordering comparator-ordering-predicate)

    \ \ (hash comparator-hash-function)

    \ \ (ordering? comparator-ordered?)

    \ \ (hash? comparator-hashable?))

    \;
  </scm-chunk>

  \;

  <paragraph|comparator-test-type><index|comparator-test-type>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    ;; Invoke the test type

    (define (comparator-test-type comparator obj)

    \ \ ((comparator-type-test-predicate comparator) obj))

    \;
  </scm-chunk>

  \;

  <paragraph|comparator-check-type><index|comparator-check-type>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (comparator-check-type comparator obj)

    \ \ (if (comparator-test-type comparator obj)

    \ \ \ \ #t

    \ \ \ \ (type-error "comparator type check failed" comparator obj)))

    \;
  </scm-chunk>

  \;

  <paragraph|comparator-hash><index|comparator-hash>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (comparator-hash comparator obj)

    \ \ ((comparator-hash-function comparator) obj))

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/comparator-test.scm|false|true>
    (import (liii comparator)

    \ \ \ \ \ \ \ \ (liii check)

    \ \ \ \ \ \ \ \ (liii base))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  \;

  <section|å†…éƒ¨å‡½æ•°>

  <paragraph|binary=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (binary=? comparator a b)

    \ \ ((comparator-equality-predicate comparator) a b))

    \;
  </scm-chunk>

  <paragraph|binary\<less\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (binary\<less\>? comparator a b)

    \ \ ((comparator-ordering-predicate comparator) a b))

    \;
  </scm-chunk>

  \;

  <paragraph|binary\<gtr\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (binary\<gtr\>? comparator a b)

    \ \ (binary\<less\>? comparator b a))

    \;
  </scm-chunk>

  \;

  <paragraph|binary\<less\>=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (binary\<less\>=? comparator a b)

    \ \ (not (binary\<gtr\>? comparator a b)))

    \;
  </scm-chunk>

  \;

  <paragraph|binary\<gtr\>=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (binary\<gtr\>=? comparator a b)

    \ \ (not (binary\<less\>? comparator a b)))

    \;
  </scm-chunk>

  <paragraph|%salt%>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (%salt%)

    \ \ 16064047)

    \;
  </scm-chunk>

  <paragraph|hash-bound>

  <\equation*>
    2<rsup|25>-1
  </equation*>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (hash-bound)

    \ \ 33554432)

    \;
  </scm-chunk>

  <paragraph|make-hasher>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-hasher)

    \ \ (let ((result (%salt%)))

    \ \ \ \ (case-lambda

    \ \ \ \ \ (() result)

    \ \ \ \ \ ((n) (set! result (+ (modulo (* result 33) (hash-bound)) n))

    \ \ \ \ \ \ \ \ \ \ result))))

    \;
  </scm-chunk>

  <section|æ„é€ å™¨>

  <paragraph|make-comparator><index|make-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-comparator type-test equality ordering hash)

    \ \ (make-raw-comparator

    \ \ \ \ (if (eq? type-test #t) (lambda (x) #t) type-test)

    \ \ \ \ (if (eq? equality #t) (lambda (x y) (eqv? (ordering x y) 0)) equality)

    \ \ \ \ (if ordering ordering (lambda (x y) (error "ordering not supported")))

    \ \ \ \ (if hash hash (lambda (x y) (error "hashing not supported")))

    \ \ \ \ (if ordering #t #f)

    \ \ \ \ (if hash #t #f)))

    \;
  </scm-chunk>

  <paragraph|make-eq-comparator><index|make-eq-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-eq-comparator)

    \ \ (make-comparator #t eq? #f default-hash))

    \;
  </scm-chunk>

  \;

  <paragraph|make-eqv-comparator><index|make-eqv-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-eqv-comparator)

    \ \ (make-comparator #t eqv? #f default-hash))

    \;
  </scm-chunk>

  \;

  <paragraph|make-equal-comparator><index|make-equal-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-equal-comparator)

    \ \ (make-comparator #t equal? #f default-hash))

    \;
  </scm-chunk>

  \;

  <paragraph|make-pair-comparator><index|make-pair-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-pair-type-test car-comparator cdr-comparator)

    \ \ (lambda (obj)

    \ \ \ \ (and (pair? obj)

    \ \ \ \ \ \ \ \ \ (comparator-test-type car-comparator (car obj))

    \ \ \ \ \ \ \ \ \ (comparator-test-type cdr-comparator (cdr obj)))))

    \;

    (define (make-pair=? car-comparator cdr-comparator)

    \ \ \ (lambda (a b)

    \ \ \ \ \ (and ((comparator-equality-predicate car-comparator) (car a) (car b))

    \ \ \ \ \ \ \ \ \ \ ((comparator-equality-predicate cdr-comparator) (cdr a) (cdr b)))))

    \;

    (define (make-pair\<less\>? car-comparator cdr-comparator)

    \ \ \ (lambda (a b)

    \ \ \ \ \ \ (if (=? car-comparator (car a) (car b))

    \ \ \ \ \ \ \ \ (\<less\>? cdr-comparator (cdr a) (cdr b))

    \ \ \ \ \ \ \ \ (\<less\>? car-comparator (car a) (car b)))))

    \;

    (define (make-pair-hash car-comparator cdr-comparator)

    \ \ \ (lambda (obj)

    \ \ \ \ \ (let ((acc (make-hasher)))

    \ \ \ \ \ \ \ (acc (comparator-hash car-comparator (car obj)))

    \ \ \ \ \ \ \ (acc (comparator-hash cdr-comparator (cdr obj)))

    \ \ \ \ \ \ \ (acc))))

    \;

    (define (make-pair-comparator car-comparator cdr-comparator)

    \ \ \ (make-comparator

    \ \ \ \ \ (make-pair-type-test car-comparator cdr-comparator)

    \ \ \ \ \ (make-pair=? car-comparator cdr-comparator)

    \ \ \ \ \ (make-pair\<less\>? car-comparator cdr-comparator)

    \ \ \ \ \ (make-pair-hash car-comparator cdr-comparator)))

    \;
  </scm-chunk>

  <paragraph|make-list-comparator><index|make-list-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    ;; Cheap test for listness

    (define (norp? obj) (or (null? obj) (pair? obj)))

    \;

    (define (make-list-comparator element-comparator type-test empty? head tail)

    \ \ \ (make-comparator

    \ \ \ \ \ (make-list-type-test element-comparator type-test empty? head tail)

    \ \ \ \ \ (make-list=? element-comparator type-test empty? head tail)

    \ \ \ \ \ (make-list\<less\>? element-comparator type-test empty? head tail)

    \ \ \ \ \ (make-list-hash element-comparator type-test empty? head tail)))

    \;

    (define (make-list-type-test element-comparator type-test empty? head tail)

    \ \ (lambda (obj)

    \ \ \ \ (and

    \ \ \ \ \ \ (type-test obj)

    \ \ \ \ \ \ (let ((elem-type-test (comparator-type-test-predicate element-comparator)))

    \ \ \ \ \ \ \ \ (let loop ((obj obj))

    \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ \ ((empty? obj) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ ((not (elem-type-test (head obj))) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (tail obj)))))))))

    \;

    (define (make-list=? element-comparator type-test empty? head tail)

    \ \ (lambda (a b)

    \ \ \ \ (let ((elem=? (comparator-equality-predicate element-comparator)))

    \ \ \ \ \ \ (let loop ((a a) (b b))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ ((and (empty? a) (empty? b) #t))

    \ \ \ \ \ \ \ \ \ \ ((empty? a) #f)

    \ \ \ \ \ \ \ \ \ \ ((empty? b) #f)

    \ \ \ \ \ \ \ \ \ \ ((elem=? (head a) (head b)) (loop (tail a) (tail b)))

    \ \ \ \ \ \ \ \ \ \ (else #f))))))

    \;

    (define (make-list\<less\>? element-comparator type-test empty? head tail)

    \ \ (lambda (a b)

    \ \ \ \ (let ((elem=? (comparator-equality-predicate element-comparator))

    \ \ \ \ \ \ \ \ \ \ (elem\<less\>? (comparator-ordering-predicate element-comparator)))

    \ \ \ \ \ \ (let loop ((a a) (b b))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ ((and (empty? a) (empty? b) #f))

    \ \ \ \ \ \ \ \ \ \ ((empty? a) #t)

    \ \ \ \ \ \ \ \ \ \ ((empty? b) #f)

    \ \ \ \ \ \ \ \ \ \ ((elem=? (head a) (head b)) (loop (tail a) (tail b)))

    \ \ \ \ \ \ \ \ \ \ ((elem\<less\>? (head a) (head b)) #t)

    \ \ \ \ \ \ \ \ \ \ (else #f))))))

    \;

    (define (make-list-hash element-comparator type-test empty? head tail)

    \ \ (lambda (obj)

    \ \ \ \ (let ((elem-hash (comparator-hash-function element-comparator))

    \ \ \ \ \ \ \ \ \ \ (acc (make-hasher)))

    \ \ \ \ \ \ (let loop ((obj obj))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ ((empty? obj) (acc))

    \ \ \ \ \ \ \ \ \ \ (else (acc (elem-hash (head obj))) (loop (tail obj))))))))

    \;
  </scm-chunk>

  \;

  <paragraph|make-vector-comparator><index|make-vector-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-vector-comparator element-comparator type-test length ref)

    \ \ (make-comparator

    \ \ \ \ (make-vector-type-test element-comparator type-test length ref)

    \ \ \ \ (make-vector=? element-comparator type-test length ref)

    \ \ \ \ (make-vector\<less\>? element-comparator type-test length ref)

    \ \ \ \ (make-vector-hash element-comparator type-test length ref)))

    \;

    (define (make-vector-type-test element-comparator type-test length ref)

    \ \ (lambda (obj)

    \ \ \ \ (and

    \ \ \ \ \ \ (type-test obj)

    \ \ \ \ \ \ (let ((elem-type-test (comparator-type-test-predicate element-comparator))

    \ \ \ \ \ \ \ \ \ \ \ \ (len (length obj)))

    \ \ \ \ \ \ \ \ (let loop ((n 0))

    \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ \ ((= n len) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ ((not (elem-type-test (ref obj n))) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ (else (loop (+ n 1)))))))))

    \;

    (define (make-vector=? element-comparator type-test length ref)

    \ \ \ (lambda (a b)

    \ \ \ \ \ (and

    \ \ \ \ \ \ \ (= (length a) (length b))

    \ \ \ \ \ \ \ (let ((elem=? (comparator-equality-predicate element-comparator))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (len (length b)))

    \ \ \ \ \ \ \ \ \ (let loop ((n 0))

    \ \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((= n len) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((elem=? (ref a n) (ref b n)) (loop (+ n 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else #f)))))))

    \;

    (define (make-vector\<less\>? element-comparator type-test length ref)

    \ \ \ (lambda (a b)

    \ \ \ \ \ (cond

    \ \ \ \ \ \ \ ((\<less\> (length a) (length b)) #t)

    \ \ \ \ \ \ \ ((\<gtr\> (length a) (length b)) #f)

    \ \ \ \ \ \ \ \ (else

    \ \ \ \ \ \ \ \ \ (let ((elem=? (comparator-equality-predicate element-comparator))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (elem\<less\>? (comparator-ordering-predicate element-comparator))

    \ \ \ \ \ \ \ \ \ \ \ \ \ (len (length a)))

    \ \ \ \ \ \ \ \ \ (let loop ((n 0))

    \ \ \ \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((= n len) #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((elem=? (ref a n) (ref b n)) (loop (+ n 1)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ ((elem\<less\>? (ref a n) (ref b n)) #t)

    \ \ \ \ \ \ \ \ \ \ \ \ \ (else #f))))))))

    \;

    (define (make-vector-hash element-comparator type-test length ref)

    \ \ (lambda (obj)

    \ \ \ \ (let ((elem-hash (comparator-hash-function element-comparator))

    \ \ \ \ \ \ \ \ \ \ (acc (make-hasher))

    \ \ \ \ \ \ \ \ \ \ (len (length obj)))

    \ \ \ \ \ \ (let loop ((n 0))

    \ \ \ \ \ \ \ \ (cond

    \ \ \ \ \ \ \ \ \ \ ((= n len) (acc))

    \ \ \ \ \ \ \ \ \ \ (else (acc (elem-hash (ref obj n))) (loop (+ n 1))))))))

    \;
  </scm-chunk>

  <section|æ ‡å‡†å‡½æ•°>

  <paragraph|object-type>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (object-type obj)

    \ \ (cond

    \ \ \ \ ((null? obj) 0)

    \ \ \ \ ((pair? obj) 1)

    \ \ \ \ ((boolean? obj) 2)

    \ \ \ \ ((char? obj) 3)

    \ \ \ \ ((string? obj) 4)

    \ \ \ \ ((symbol? obj) 5)

    \ \ \ \ ((number? obj) 6)

    \ \ \ \ ((vector? obj) 7)

    \ \ \ \ ((bytevector? obj) 8)

    \ \ \ \ (else 65535)))

    \;
  </scm-chunk>

  <paragraph|boolean\<less\>?><index|boolean\<less\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (boolean\<less\>? a b)

    \ \ ;; #f \<less\> #t but not otherwise

    \ \ (and (not a) b))

    \;
  </scm-chunk>

  <paragraph|complex\<less\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (complex\<less\>? a b)

    \ \ (if (= (real-part a) (real-part b))

    \ \ \ \ (\<less\> (imag-part a) (imag-part b))

    \ \ \ \ (\<less\> (real-part a) (real-part b))))

    \;
  </scm-chunk>

  <paragraph|symbol\<less\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (symbol\<less\>? a b)

    \ \ (string\<less\>? (symbol-\<gtr\>string a) (symbol-\<gtr\>string b)))

    \;
  </scm-chunk>

  \;

  <paragraph|boolean-hash><index|boolean-hash>

  <paragraph|char-hash><index|char-hash>

  <paragraph|char-ci-hash><index|char-ci-hash>

  <paragraph|string-hash><index|string-hash>

  <paragraph|string-ci-hash><index|string-ci-hash>

  <paragraph|symbol-hash><index|symbol-hash>

  <paragraph|number-hash><index|number-hash>

  <paragraph|default-hash><index|default-hash>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define boolean-hash hash-code)

    (define char-hash hash-code)

    (define char-ci-hash hash-code)

    (define string-hash hash-code)

    (define string-ci-hash hash-code)

    (define symbol-hash hash-code)

    (define number-hash hash-code)

    (define default-hash hash-code)

    \;
  </scm-chunk>

  <paragraph|default-ordering>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (dispatch-ordering type a b)

    \ \ (case type

    \ \ \ \ ((0) 0) ; All empty lists are equal

    \ \ \ \ ((1) ((make-pair\<less\>? (make-default-comparator) (make-default-comparator)) a b))

    \ \ \ \ ((2) (boolean\<less\>? a b))

    \ \ \ \ ((3) (char\<less\>? a b))

    \ \ \ \ ((4) (string\<less\>? a b))

    \ \ \ \ ((5) (symbol\<less\>? a b))

    \ \ \ \ ((6) (complex\<less\>? a b))

    \ \ \ \ ((7) ((make-vector\<less\>? (make-default-comparator) vector? vector-length vector-ref)

    \ \ \ \ \ \ \ \ \ \ a b))

    \ \ \ \ ((8) ((make-vector\<less\>? (make-comparator exact-integer? = \<less\> default-hash)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bytevector? bytevector-length bytevector-u8-ref)

    \ \ \ \ \ \ \ \ \ \ a b))

    \ \ \ \ ; Add more here

    \ \ \ \ (else (binary\<less\>? (registered-comparator type) a b))))

    \;

    (define (default-ordering a b)

    \ \ (let ((a-type (object-type a))

    \ \ \ \ \ \ \ \ (b-type (object-type b)))

    \ \ \ \ (cond

    \ \ \ \ \ \ ((\<less\> a-type b-type) #t)

    \ \ \ \ \ \ ((\<gtr\> a-type b-type) #f)

    \ \ \ \ \ \ (else (dispatch-ordering a-type a b)))))

    \;
  </scm-chunk>

  <paragraph|default-equality>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (dispatch-equality type a b)

    \ \ (case type

    \ \ \ \ ((0) #t) ; All empty lists are equal

    \ \ \ \ ((1) ((make-pair=? (make-default-comparator) (make-default-comparator)) a b))

    \ \ \ \ ((2) (boolean=? a b))

    \ \ \ \ ((3) (char=? a b))

    \ \ \ \ ((4) (string=? a b))

    \ \ \ \ ((5) (symbol=? a b))

    \ \ \ \ ((6) (= a b))

    \ \ \ \ ((7) ((make-vector=? (make-default-comparator)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vector? vector-length vector-ref) a b))

    \ \ \ \ ((8) ((make-vector=? (make-comparator exact-integer? = \<less\> default-hash)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bytevector? bytevector-length bytevector-u8-ref) a b))

    \ \ \ \ ; Add more here

    \ \ \ \ (else (binary=? (registered-comparator type) a b))))

    \;

    (define (default-equality a b)

    \ \ (let ((a-type (object-type a))

    \ \ \ \ \ \ \ \ (b-type (object-type b)))

    \ \ \ \ (if (= a-type b-type)

    \ \ \ \ \ \ \ \ (dispatch-equality a-type a b)

    \ \ \ \ \ \ \ \ #f)))

    \;
  </scm-chunk>

  \;

  <paragraph|make-default-comparator><index|make-default-comparator>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (make-default-comparator)

    \ \ (make-comparator

    \ \ \ \ (lambda (obj) #t)

    \ \ \ \ default-equality

    \ \ \ \ default-ordering

    \ \ \ \ default-hash))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/comparator-test.scm|true|true>
    (let1 default-comp (make-default-comparator)

    \ \ (check-false (\<less\>? default-comp #t #t))

    \ \ (check-false (\<less\>? default-comp #f #f))

    \ \ (check-true (\<less\>? \ default-comp #f #t))

    \ \ (check-false (\<less\>? default-comp #t #f))

    \ \ (check-true (\<less\>? default-comp (cons #f #f) (cons #t #t)))

    \ \ (check-true (\<less\>? default-comp (list 1 2) (list 2 3)))

    \ \ (check-true (\<less\>? default-comp (list 1 2) (list 1 3)))

    \ \ (check-true (\<less\>? default-comp (vector "a" "b") (vector "b" "c")))

    \ \ 

    \ \ (check-false (\<less\>? default-comp 1 1))

    \ \ (check-true (\<less\>? default-comp 0+1i 0+2i))

    \ \ (check-true (\<less\>? default-comp 1+2i 2+2i))

    \ \ 

    \ \ (check (comparator-hash default-comp (list 1 2)) =\<gtr\> 42)

    )

    \;
  </scm-chunk>

  <section|æ¯”è¾ƒè°“è¯>

  <paragraph|=?><index|=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (=? comparator a b . objs)

    \ \ (let loop ((a a) (b b) (objs objs))

    \ \ \ \ (and (binary=? comparator a b)

    \ \ \ \ \ \ \ \ \ (if (null? objs) #t (loop b (car objs) (cdr objs))))))

    \;
  </scm-chunk>

  \;

  <paragraph|\<less\>?><index|\<less\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (\<less\>? comparator a b . objs)

    \ \ (let loop ((a a) (b b) (objs objs))

    \ \ \ \ (and (binary\<less\>? comparator a b)

    \ \ \ \ \ \ \ \ \ (if (null? objs) #t (loop b (car objs) (cdr objs))))))

    \;
  </scm-chunk>

  \;

  <paragraph|\<gtr\>?><index|\<gtr\>?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (\<gtr\>? comparator a b . objs)

    \ \ (let loop ((a a) (b b) (objs objs))

    \ \ \ \ (and (binary\<gtr\>? comparator a b)

    \ \ \ \ \ \ \ \ \ (if (null? objs) #t (loop b (car objs) (cdr objs))))))

    \;
  </scm-chunk>

  \;

  <paragraph|\<less\>=?><index|\<less\>=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (\<less\>=? comparator a b . objs)

    \ \ (let loop ((a a) (b b) (objs objs))

    \ \ \ \ (and (binary\<less\>=? comparator a b)

    \ \ \ \ \ \ \ \ \ (if (null? objs) #t (loop b (car objs) (cdr objs))))))

    \;
  </scm-chunk>

  \;

  <paragraph|\<gtr\>=?><index|\<gtr\>=?>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|true>
    (define (\<gtr\>=? comparator a b . objs)

    \ \ (let loop ((a a) (b b) (objs objs))

    \ \ \ \ (and (binary\<gtr\>=? comparator a b)

    \ \ \ \ \ \ \ \ \ (if (null? objs) #t (loop b (car objs) (cdr objs))))))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/comparator.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-128.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/comparator-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(liii hash-table)>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/hash-table.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (liii comparator)

    \ \ \ \ \ \ \ \ (liii hash-table)

    \ \ \ \ \ \ \ \ (liii base))

    \;

    (check-set-mode! 'report-failed)

    \;

    (define empty-ht (make-hash-table))

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define-library (srfi srfi-125)

    (import (srfi srfi-1)

    \ \ \ \ \ \ \ \ (liii base)

    \ \ \ \ \ \ \ \ (liii error))

    (export

    \ \ make-hash-table hash-table hash-table-unfold alist-\<gtr\>hash-table

    \ \ hash-table? hash-table-contains? hash-table-empty? hash-table=?

    \ \ hash-table-mutable?

    \ \ hash-table-ref hash-table-ref/default

    \ \ hash-table-set! hash-table-delete! hash-table-intern! hash-table-update!

    \ \ hash-table-update!/default hash-table-pop! hash-table-clear!

    \ \ hash-table-size hash-table-keys hash-table-values hash-table-entries

    \ \ hash-table-find hash-table-count

    \ \ hash-table-for-each hash-table-map-\<gtr\>list

    \ \ hash-table-\<gtr\>alist

    )

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/hash-table.scm|true|true>
    (define-library (liii hash-table)

    (import (srfi srfi-125)

    \ \ \ \ \ \ \ \ (srfi srfi-128))

    (export

    \ \ make-hash-table hash-table hash-table-unfold alist-\<gtr\>hash-table

    \ \ hash-table? hash-table-contains? hash-table-empty? hash-table=?

    \ \ hash-table-mutable?

    \ \ hash-table-ref hash-table-ref/default

    \ \ hash-table-set! hash-table-delete! hash-table-intern! hash-table-update!

    \ \ hash-table-update!/default hash-table-pop! hash-table-clear!

    \ \ hash-table-size hash-table-keys hash-table-values hash-table-entries

    \ \ hash-table-find hash-table-count

    \ \ hash-table-for-each hash-table-map-\<gtr\>list

    \ \ hash-table-\<gtr\>alist

    )

    (begin
  </scm-chunk>

  <subsection|è®¿é—®å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ >

  é™¤äº†SRFI 125å®šä¹‰çš„<scm|hash-table-ref>å’Œ<scm|hash-table-ref/default>ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨S7 Schemeå†…ç½®çš„è®¿é—®æ–¹å¼ï¼š

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (check (ht 'a) =\<gtr\> #f)

    \ \ (hash-table-set! ht 'a 1)

    \ \ (check (ht 'a) =\<gtr\> 1))

    \;
  </scm-chunk>

  <section|å®ç°>

  <subsection|å­å‡½æ•°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (assert-hash-table-type ht f)

    \ \ (when (not (hash-table? ht))

    \ \ \ \ (error 'type-error f "this parameter must be typed as hash-table")))

    \;

    (define s7-hash-table-set! hash-table-set!)

    (define s7-make-hash-table make-hash-table)

    (define s7-hash-table-entries hash-table-entries)

    \;
  </scm-chunk>

  <subsection|æ„é€ å™¨>

  <paragraph|make-hash-table><index|make-hash-table>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (make-hash-table . args)

    \ \ (cond ((null? args) (s7-make-hash-table))

    \ \ \ \ \ \ \ \ ((comparator? (car args))

    \ \ \ \ \ \ \ \ \ (let* ((equiv (comparator-equality-predicate (car args)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-func (comparator-hash-function (car args))))

    \ \ \ \ \ \ \ \ \ \ \ (s7-make-hash-table 8 (cons equiv hash-func) (cons #t #t))))

    \ \ \ \ \ \ \ \ (else (type-error "make-hash-table"))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table (<code*|make-default-comparator>))

    \ \ (hash-table-set! ht 1 2)

    \ \ (check (ht 1) =\<gtr\> 2))

    \;

    (let* ((mod10 (lambda (x) (modulo x 10)))

    \ \ \ \ \ \ \ (digit=? (lambda (x y) (= (modulo x 10) (modulo y 10))))

    \ \ \ \ \ \ \ (comp (make-comparator number? digit=? #f mod10))

    \ \ \ \ \ \ \ (ht (make-hash-table comp)))

    \ \ (hash-table-set! ht 1 2)

    \ \ (hash-table-set! ht 11 3)

    \ \ (check (ht 1) =\<gtr\> 3)

    \ \ (check (ht 11) =\<gtr\> 3)

    \ \ (check (ht 21) =\<gtr\> 3))

    \;
  </scm-chunk>

  <paragraph|hash-table>

  <paragraph|alist-\<gtr\>hash-table><index|alist-\<gtr\>hash-table>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define alist-\<gtr\>hash-table

    \ \ (typed-lambda ((lst list?))

    \ \ \ \ (when (odd? (length lst))

    \ \ \ \ \ \ (value-error "The length of lst must be even!"))

    \ \ \ \ (let1 ht (make-hash-table)

    \ \ \ \ \ \ (let loop ((rest lst))

    \ \ \ \ \ \ \ \ (if (null? rest)

    \ \ \ \ \ \ \ \ \ \ \ \ ht

    \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table-set! ht (car rest) (cadr rest))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (loop (cddr rest))))))))

    \;
  </scm-chunk>

  <subsection|è°“è¯>

  <paragraph|hash-table?><index|hash-table?>

  S7å†…ç½®å‡½æ•°ã€‚åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯å“ˆå¸Œè¡¨ã€‚

  <paragraph|hash-table-contains?><index|hash-table-contains?><scm|((ht hash-table?) key) =\<gtr\> bool>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-contains? ht key)

    \ \ (not (not (hash-table-ref ht key))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (hash-table-set! ht 'brand 'liii)

    \ \ (check (hash-table-contains? ht 'brand) =\<gtr\> #t)

    \ \ (hash-table-set! ht 'brand #f)

    \ \ (check (hash-table-contains? ht 'brand) =\<gtr\> #f))

    \;
  </scm-chunk>

  <paragraph|hash-table-empty?><index|hash-table-empty?>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-empty? ht)

    \ \ (zero? (hash-table-size ht)))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-empty? empty-ht) =\<gtr\> #t)

    \;

    (let1 test-ht (make-hash-table)

    \ \ (hash-table-set! test-ht 'key 'value)

    \ \ (check (hash-table-empty? test-ht) =\<gtr\> #f))

    \;
  </scm-chunk>

  <paragraph|hash-table=?><index|hash-table=?><scm|(ht1 ht2) =\<gtr\> boolean>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table=? ht1 ht2)

    \ \ (equal? ht1 ht2))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let ((empty-h1 (make-hash-table))

    \ \ \ \ \ \ (empty-h2 (make-hash-table)))

    \ \ (check (hash-table=? empty-h1 empty-h2) =\<gtr\> #t))

    \;

    (let ((t1 (make-hash-table))

    \ \ \ \ \ \ (t2 (make-hash-table)))

    \ \ (hash-table-set! t1 'a 1)

    \ \ (hash-table-set! t2 'a 1)

    \ \ (check (hash-table=? t1 t2) =\<gtr\> #t)

    \ \ (hash-table-set! t1 'b 2)

    \ \ (check (hash-table=? t1 t2) =\<gtr\> #f))

    \;
  </scm-chunk>

  <subsection|é€‰æ‹©å™¨>

  <paragraph|hash-table-ref><index|hash-table-ref><scm|(hash-table-ref ht key) =\<gtr\> value>

  <\description>
    <item*|ht>å“ˆå¸Œè¡¨

    <item*|key>é”®

    <item*|value>è¿”å›hashè¡¨ä¸­keyè¿™ä¸ªé”®å¯¹åº”çš„å€¼
  </description>

  SRFI 125å®šä¹‰çš„<scm|hash-table-ref>çš„å‡½æ•°ç­¾åæ˜¯è¿™æ ·çš„ï¼š<scm|(hash-table-ref hash-table key [failure [success]])>ã€‚ä¸¤å‚æ•°å½¢å¼çš„<scm|hash-table-ref>æ˜¯S7 Schemeçš„å†…ç½®å‡½æ•°ã€‚

  åœ¨S7 Schemeä¸­ï¼Œå¯ä»¥ç›´æ¥å°†hash-tableè§†ä½œä¸€ä¸ªå•å‚æ•°çš„å‡½æ•°ï¼Œæ¯”å¦‚<scm|(ht 'key)>ç­‰ä»·äº<scm|(hash-table-ref ht 'key)>ã€‚

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-ref empty-ht 'key) =\<gtr\> #f)

    \;

    (let1 ht (make-hash-table)

    \ \ (hash-table-set! ht 'key 'value)

    \ \ (check (hash-table-ref ht 'key) =\<gtr\> 'value)

    \ \ (check (ht 'key) =\<gtr\> 'value))

    \;
  </scm-chunk>

  <paragraph|hash-table-ref/default><index|hash-table-ref/default><scm|(hash-table-ref/default ht key default) =\<gtr\> value>

  <\description>
    <item*|ht>å“ˆå¸Œè¡¨

    <item*|key>é”®

    <item*|default>é»˜è®¤å€¼ï¼Œå¦‚æœkeyè¿™ä¸ªé”®åœ¨å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„å€¼ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ã€‚æ³¨æ„ï¼Œè¯¥é»˜è®¤å€¼åªæœ‰åœ¨keyè¿™ä¸ªé”®ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰ä¼šè¢«æ±‚å€¼ã€‚

    <item*|value>é”®å¯¹åº”çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¸ºé»˜è®¤å€¼ã€‚
  </description>

  <subparagraph|æµ‹è¯•>

  å½“é”®å¯¹åº”çš„å€¼å­˜åœ¨æ—¶ï¼Œdefaultä¸ä¼šè¢«æ±‚å€¼ï¼Œæ•…è€Œæµ‹è¯•ä¸­çš„<scm|(display "hello")>å®é™…ä¸ä¼šè¢«æ‰§è¡Œã€‚

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (check (hash-table-ref/default ht 'key 'value1) =\<gtr\> 'value1)

    \ \ (check (hash-table-ref/default ht 'key (+ 1 2)) =\<gtr\> 3)

    \;

    \ \ (hash-table-set! ht 'key 'value)

    \ \ (check (hash-table-ref/default ht 'key

    \ \ \ \ \ \ \ \ \ \ \ (begin (display "hello")

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (+ 1 2)))

    \ \ \ \ =\<gtr\> 'value)

    ) ; end of let1

    \;
  </scm-chunk>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define-macro (hash-table-ref/default ht key default)

    \ \ â€˜(or (hash-table-ref ,ht ,key)

    \ \ \ \ \ \ \ \ ,default))

    \;
  </scm-chunk>

  <subsection|ä¿®æ”¹å™¨>

  <paragraph|hash-table-set!><index|hash-table-set!>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (hash-table-set! ht 'k1 'v1 'k2 'v2)

    \ \ (check (ht 'k1) =\<gtr\> 'v1)

    \ \ (check (ht 'k2) =\<gtr\> 'v2)

    )

    \;
  </scm-chunk>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-set! ht . rest)

    \ \ (assert-hash-table-type ht hash-table-set!)

    \ \ (let1 len (length rest)

    \ \ \ \ (when (or (odd? len) (zero? len))

    \ \ \ \ \ \ (error 'wrong-number-of-args len "but must be even and non-zero"))

    \ \ \ \ 

    \ \ \ \ (s7-hash-table-set! ht (car rest) (cadr rest))

    \ \ \ \ (when (\<gtr\> len 2)

    \ \ \ \ \ \ \ \ \ \ (apply hash-table-set! (cons ht (cddr rest))))))

    \;
  </scm-chunk>

  <paragraph|hash-table-delete!><index|hash-table-delete!>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (hash-table-update! ht 'key 'value)

    \ \ (check (hash-table-delete! ht 'key) =\<gtr\> 1)

    \ \ (check-false (hash-table-contains? ht 'key))

    \ \ 

    \ \ (hash-table-update! ht 'key1 'value1)

    \ \ (hash-table-update! ht 'key2 'value2)

    \ \ (hash-table-update! ht 'key3 'value3)

    \ \ (hash-table-update! ht 'key4 'value4)

    \ \ (check (hash-table-delete! ht 'key1 'key2 'key3) =\<gtr\> 3)

    )

    \;
  </scm-chunk>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-delete! ht key . keys)

    \ \ (assert-hash-table-type ht hash-table-delete!)

    \ \ (let1 all-keys (cons key keys)

    \ \ \ \ (length

    \ \ \ \ \ \ (filter

    \ \ \ \ \ \ \ \ (lambda (x)

    \ \ \ \ \ \ \ \ \ \ (if (hash-table-contains? ht x)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ (begin

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (s7-hash-table-set! ht x #f)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ #t)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ #f))

    \ \ \ \ \ \ \ \ all-keys))))

    \;
  </scm-chunk>

  <paragraph|hash-table-update!><index|hash-table-update!>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-update! ht key value)

    \ \ (hash-table-set! ht key value))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (hash-table-update! ht 'key 'value)

    \ \ (check (ht 'key) =\<gtr\> 'value)

    \ \ (hash-table-update! ht 'key 'value1)

    \ \ (check (ht 'key) =\<gtr\> 'value1)

    \ \ (hash-table-update! ht 'key #f)

    \ \ (check (ht 'key) =\<gtr\> #f))

    \;
  </scm-chunk>

  <paragraph|hash-table-clear!><index|hash-table-clear!>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-clear! ht)

    \ \ (for-each

    \ \ \ \ (lambda (key)

    \ \ \ \ \ \ (hash-table-set! ht key #f))

    \ \ \ \ (hash-table-keys ht)))

    \;
  </scm-chunk>

  \;

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (hash-table-update! ht 'key 'value)

    \ \ (hash-table-update! ht 'key1 'value1)

    \ \ (hash-table-update! ht 'key2 'value2)

    \ \ (hash-table-clear! ht)

    \ \ (check-true (hash-table-empty? ht)))

    \;
  </scm-chunk>

  <subsection|å“ˆå¸Œè¡¨æ•´ä½“>

  <paragraph|hash-table-size><index|hash-table-size>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-size s7-hash-table-entries)

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-size empty-ht) =\<gtr\> 0)

    \;

    (let1 populated-ht (make-hash-table)

    \ \ (hash-table-set! populated-ht 'key1 'value1)

    \ \ (hash-table-set! populated-ht 'key2 'value2)

    \ \ (hash-table-set! populated-ht 'key3 'value3)

    \ \ (check (hash-table-size populated-ht) =\<gtr\> 3))

    \;
  </scm-chunk>

  <paragraph|hash-table-keys><index|hash-table-keys>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-keys ht)

    \ \ (map car ht))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-keys empty-ht) =\<gtr\> '())

    \;

    (let1 ht (make-hash-table)

    \ \ (hash-table-set! ht 'k1 'v1)

    \ \ (check (hash-table-keys ht) =\<gtr\> '(k1)))

    \;
  </scm-chunk>

  <paragraph|hash-table-values><index|hash-table-values>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define (hash-table-values ht)

    \ \ (map cdr ht))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-values empty-ht) =\<gtr\> '())

    \;

    (let1 ht (make-hash-table)

    \ \ (hash-table-set! ht 'k1 'v1)

    \ \ (check (hash-table-values ht) =\<gtr\> '(v1)))

    \;
  </scm-chunk>

  <paragraph|hash-table-entries><index|hash-table-entries>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-entries

    \ \ (typed-lambda ((ht hash-table?))

    \ \ \ \ (let ((ks (hash-table-keys ht))

    \ \ \ \ \ \ \ \ \ \ (vs (hash-table-values ht)))

    \ \ \ \ \ \ (values ks vs))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (check (call-with-values (lambda () (hash-table-entries ht))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (ks vs) (list ks vs)))

    \ \ \ \ \ \ \ \ \ =\<gtr\> (list (list ) (list )))

    \ \ 

    \ \ (hash-table-set! ht 'k1 'v1)

    \ \ (check (call-with-values (lambda () (hash-table-entries ht))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (lambda (ks vs) (list ks vs)))

    \ \ \ \ \ \ \ \ \ =\<gtr\> (list (list 'k1) (list 'v1))))

    \;
  </scm-chunk>

  <paragraph|hash-table-find><index|hash-table-find><scm|(proc (ht hash-table?) failure) =\<gtr\> obj>

  å¯¹äºå“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªå…³è”é¡¹ï¼Œè°ƒç”¨procå‡½æ•°å¤„ç†å®ƒçš„é”®å’Œå€¼ã€‚å¦‚æœprocè¿”å›çœŸï¼ˆtrueï¼‰ï¼Œé‚£ä¹ˆhash-table-findå‡½æ•°å°†è¿”å›procè¿”å›çš„ç»“æœã€‚å¦‚æœæ‰€æœ‰å¯¹procçš„è°ƒç”¨éƒ½è¿”å›å‡ï¼ˆ#fï¼‰ï¼Œåˆ™è¿”å›è°ƒç”¨thunk failureå‡½æ•°çš„ç»“æœã€‚

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    \;
  </scm-chunk>

  \;

  <paragraph|hash-table-count><index|hash-table-count>

  <subparagraph|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-count

    \ \ (typed-lambda ((pred? procedure?) (ht hash-table?))

    \ \ \ \ (count (lambda (x) (pred? (car x) (cdr x)))

    \ \ \ \ \ \ \ \ \ \ \ (map values ht))))

    \;
  </scm-chunk>

  <subparagraph|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (check (hash-table-count (lambda (k v) #f) (hash-table)) =\<gtr\> 0)

    (check (hash-table-count (lambda (k v) #t) (hash-table 'a 1 'b 2 'c 3)) =\<gtr\> 3)

    (check (hash-table-count (lambda (k v) #f) (hash-table 'a 1 'b 2 'c 3)) =\<gtr\> 0)

    \;

    (check (hash-table-count (lambda (k v) (eq? k 'b)) (hash-table 'a 1 'b 2 'c 3)) =\<gtr\> 1)

    \;

    (check (hash-table-count (lambda (k v) (\<gtr\> v 1)) (hash-table 'a 1 'b 2 'c 3)) =\<gtr\> 2)

    \;

    (check (hash-table-count (lambda (k v) (string? k))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table "apple" 1 "banana" 2)) =\<gtr\> 2)

    \;

    (check (hash-table-count (lambda (k v) (and (symbol? k) (even? v)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table 'apple 2 'banana 3 'cherry 4)) =\<gtr\> 2)

    \;

    \;

    (check (hash-table-count (lambda (k v) (eq? k v))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table 'a 'a 'b 'b 'c 'd)) =\<gtr\> 2)

    \;

    (check (hash-table-count (lambda (k v) (number? k))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table 1 100 2 200 3 300)) =\<gtr\> 3)

    \;

    (check (hash-table-count (lambda (k v) (list? v))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table 'a '(1 2) 'b '(3 4) 'c 3)) =\<gtr\> 2)

    \;

    (check (hash-table-count (lambda (k v) \ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (= (char-\<gtr\>integer (string-ref (symbol-\<gtr\>string k) 0)) v))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (hash-table 'a 97 'b 98 'c 99)) =\<gtr\> 3)

    \;
  </scm-chunk>

  <subsection|æ˜ å°„å’ŒæŠ˜å >

  <paragraph|hash-table-foreach><index|hash-table-foreach><scm|((proc procedure?) (ht hash-table?)) =\<gtr\> #\<less\>unspeficied\<gtr\>>

  å¯¹å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªå…³è”è°ƒç”¨ procï¼Œä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šå…³è”çš„é”®å’Œå…³è”çš„å€¼ã€‚proc è¿”å›çš„å€¼è¢«ä¸¢å¼ƒã€‚è¿”å›ä¸€ä¸ªæœªæŒ‡å®šçš„å€¼ã€‚

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-for-each

    \ \ (typed-lambda ((proc procedure?) (ht hash-table?))

    \ \ \ \ (for-each (lambda (x) (proc (car x) (cdr x)))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ ht)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 cnt 0

    \ \ (hash-table-for-each

    \ \ \ \ (lambda (k v)

    \ \ \ \ \ \ (set! cnt (+ cnt v)))

    \ \ \ \ (hash-table 'a 1 'b 2 'c 3))

    \ \ (check cnt =\<gtr\> 6))

    \;
  </scm-chunk>

  <paragraph|hash-table-map-\<gtr\>list><index|hash-table-map-\<gtr\>list><scm|((proc procedure?) (ht hash-table?)) =\<gtr\> list>

  å¯¹å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªå…³è”è°ƒç”¨ procï¼Œä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šå…³è”çš„é”®å’Œå…³è”çš„å€¼ã€‚æ¯æ¬¡è°ƒç”¨ proc è¿”å›çš„å€¼ä¼šè¢«ç´¯ç§¯åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå¹¶æœ€ç»ˆè¿”å›è¯¥åˆ—è¡¨ã€‚

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-map-\<gtr\>list

    \ \ (typed-lambda ((proc procedure?) (ht hash-table?))

    \ \ \ \ (map (lambda (x) (proc (car x) (cdr x)))

    \ \ \ \ \ \ \ \ \ ht)))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let* ((ht (hash-table 'a 1 'b 2 'c 3))

    \ \ \ \ \ \ \ (ks (hash-table-map-\<gtr\>list (lambda (k v) k) ht))

    \ \ \ \ \ \ \ (vs (hash-table-map-\<gtr\>list (lambda (k v) v) ht)))

    \ \ (check-true (in? 'a ks))

    \ \ (check-true (in? 'b ks))

    \ \ (check-true (in? 'c ks))

    \ \ (check-true (in? 1 vs))

    \ \ (check-true (in? 2 vs))

    \ \ (check-true (in? 3 vs)))

    \;
  </scm-chunk>

  \;

  <subsection|å¤åˆ¶å’Œè½¬æ¢>

  <paragraph|hash-table-\<gtr\>alist><index|hash-table-\<gtr\>alist>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|true>
    (define hash-table-\<gtr\>alist

    \ \ (typed-lambda ((ht hash-table?))

    \ \ \ \ (append-map

    \ \ \ \ \ \ (lambda (x) (list (car x) (cdr x)))

    \ \ \ \ \ \ (map values ht))))

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|true>
    (let1 ht (make-hash-table)

    \ \ (check (hash-table-\<gtr\>alist ht) =\<gtr\> (list))

    \ \ (hash-table-set! ht 'k1 'v1)

    \ \ (check (hash-table-\<gtr\>alist ht) =\<gtr\> '(k1 v1)))

    \;

    (check (hash-table-\<gtr\>alist (alist-\<gtr\>hash-table (list 'k1 'v1)))

    \ \ \ \ \ \ \ =\<gtr\> (list 'k1 'v1))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|tests/goldfish/liii/hash-table-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-125.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/liii/hash-table.scm|true|false>
    ) ; end of begin

    ) ; end of library

    \;
  </scm-chunk>

  <chapter|(liii set)>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/liii/set.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-113.scm|false|true>
    ; Copyright (C) John Cowan (2015). All Rights Reserved.

    ;

    ; Permission is hereby granted, free of charge, to any person obtaining a copy of

    ; this software and associated documentation files (the "Software"), to deal in

    ; the Software without restriction, including without limitation the rights to

    ; use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies

    ; of the Software, and to permit persons to whom the Software is furnished to do

    ; so, subject to the following conditions:

    ;

    ; The above copyright notice and this permission notice shall be included in all

    ; copies or substantial portions of the Software.

    ;

    ; THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR

    ; IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,

    ; FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE

    ; AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER

    ; LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,

    ; OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

    ; SOFTWARE.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/liii/set.scm|true|true>
    (define-library (liii set)

    (import (srfi srfi-113))

    (export set?)

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-113.scm|true|true>
    (define-library (srfi srfi-113)

    (import (scheme base))

    (export set?)

    (begin

    \;
  </scm-chunk>

  \;

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/liii/set.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/srfi-113.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  \;

  <chapter|ä¸‰é²¤æ‰©å±•åº“è¯´æ˜>

  ä¸‰é²¤æ‰©å±•åº“éƒ½æ˜¯å½¢å¦‚<scm|(liii xyz)>çš„Schemeåº“ã€‚

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/scheme/base.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <chapter|(scheme case-lambda)>

  <section|åè®®>

  <\scm-chunk|tests/goldfish/scheme/case-lambda-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  åœ¨Schemeè¯­è¨€ä¸­ï¼Œ<scm|case-lambda>æ˜¯ä¸€ç§ç‰¹æ®Šçš„lambdaè¡¨è¾¾å¼ï¼Œå®ƒå¯ä»¥æ ¹æ®ä¸åŒæ•°é‡çš„å‚æ•°æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚<scm|case-lambda>å…è®¸ä½ å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ ¹æ®ä¼ å…¥å‚æ•°çš„æ•°é‡æ¥é€‰æ‹©æ‰§è¡Œä¸åŒçš„lambdaè¡¨è¾¾å¼ã€‚

  \;

  ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<scm|case-lambda>çš„ç¤ºä¾‹ï¼š

  <\scm-chunk|tests/goldfish/scheme/case-lambda-test.scm|true|false>
    (import (liii list)

    \ \ \ \ \ \ \ \ (liii check)

    \ \ \ \ \ \ \ \ (scheme case-lambda))

    \;

    (check-set-mode! 'report-failed)

    \;

    (define (my-func . args)

    \ \ (case-lambda

    \ \ \ \ (() "zero args")

    \ \ \ \ ((x) (+ x x))

    \ \ \ \ ((x y) (+ x y))

    \ \ \ \ ((x y . rest) (reduce + 0 (cons x (cons y rest))))))

    \;

    (check ((my-func)) =\<gtr\> "zero args")

    (check ((my-func) 2) =\<gtr\> 4)

    (check ((my-func) 3 4) =\<gtr\> 7)

    (check ((my-func) 1 2 3 4) =\<gtr\> 10)

    \;

    (check-report)

    \;
  </scm-chunk>

  <section|å®ç°>

  <\scm-chunk|goldfish/scheme/case-lambda.scm|false|false>
    ; 0-clause BSD

    ; Bill Schottstaedt

    ; from S7 source repo: r7rs.scm

    \;

    (define-library (scheme case-lambda)

    (export case-lambda)

    (begin

    \;

    ;; case-lambda \ \ \ \ \ \ 

    (define-macro (case-lambda . choices)

    \ \ â€˜(lambda args

    \ \ \ \ \ (case (length args)

    \ \ \ \ \ \ \ ,@(map (lambda (choice)

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (if (or (symbol? (car choice))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (negative? (length (car choice))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜(else (apply (lambda ,(car choice) ,@(cdr choice)) args))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ â€˜((,(length (car choice)))\ 

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (apply (lambda ,(car choice) ,@(cdr choice)) args))))

    \ \ \ \ \ \ \ \ \ \ \ \ \ \ choices))))

    \;

    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <chapter|(scheme char)>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/scheme/char.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  å¤§éƒ¨åˆ†<scm|(scheme char)>é‡Œé¢çš„å‡½æ•°éƒ½æ˜¯S7 Schemeå†…ç½®å‡½æ•°ï¼Œè¿™é‡Œä»æ—§å¯¼å‡ºç›¸å…³ç¬¦å·ï¼Œä»¥æ–¹ä¾¿é‡‘é±¼Schemeçš„ç”¨æˆ·æœç´¢åˆ°ç›¸å…³å‡½æ•°ã€‚

  <\scm-chunk|goldfish/scheme/char.scm|true|true>
    (define-library (scheme char)

    (export

    \ \ char-upcase char-downcase char-upper-case? char-lower-case?

    )

    (begin
  </scm-chunk>

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|true>
    (import (liii check)

    \ \ \ \ \ \ \ \ (scheme char))

    \;

    (check-set-mode! 'report-failed)

    \;
  </scm-chunk>

  <section|å®ç°>

  <value|r7rs><paragraph|char-upcase><index|char-upcase>

  S7å†…ç½®å‡½æ•°ã€‚å°†å°å†™è‹±æ–‡å­—æ¯è½¬æ¢ä¸ºå¤§å†™è‹±æ–‡å­—æ¯ï¼Œå¦‚æœä¸æ˜¯å°å†™è‹±æ–‡å­—æ¯ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|true>
    (check (char-upcase #\\z) =\<gtr\> #\\Z)

    (check (char-upcase #\\a) =\<gtr\> #\\A)

    \;

    (check (char-upcase #\\A) =\<gtr\> #\\A)

    (check (char-upcase #\\?) =\<gtr\> #\\?)

    (check (char-upcase #\\$) =\<gtr\> #\\$)

    (check (char-upcase #\\.) =\<gtr\> #\\.)

    (check (char-upcase #\\\\) =\<gtr\> #\\\\)

    (check (char-upcase #\\5) =\<gtr\> #\\5)

    (check (char-upcase #\\)) =\<gtr\> #\\))

    (check (char-upcase #\\%) =\<gtr\> #\\%)

    (check (char-upcase #\\0) =\<gtr\> #\\0)

    (check (char-upcase #\\_) =\<gtr\> #\\_)

    (check (char-upcase #\\?) =\<gtr\> #\\?)

    (check (char-upcase #\\space) =\<gtr\> #\\space)

    (check (char-upcase #\\newline) =\<gtr\> #\\newline)

    (check (char-upcase #\\null) =\<gtr\> #\\null)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|char-downcase><index|char-downcase>

  S7å†…ç½®å‡½æ•°ã€‚å°†å¤§å†™è‹±æ–‡å­—æ¯è½¬æ¢ä¸ºå°å†™è‹±æ–‡å­—æ¯ï¼Œå¦‚æœä¸æ˜¯å¤§å†™è‹±æ–‡å­—æ¯ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|true>
    (check (char-downcase #\\A) =\<gtr\> #\\a)

    (check (char-downcase #\\Z) =\<gtr\> #\\z)

    \;

    (check (char-downcase #\\a) =\<gtr\> #\\a)

    \;
  </scm-chunk>

  <value|r7rs><paragraph|char-upper-case?><index|char-upper-case?>

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|true>
    (check-true (char-upper-case? #\\A))

    (check-true (char-upper-case? #\\Z))

    \;

    (check-false (char-upper-case? #\\a))

    (check-false (char-upper-case? #\\z))

    \;
  </scm-chunk>

  <value|r7rs><paragraph|char-lower-case?><index|char-lower-case?>

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|true>
    (check-true (char-lower-case? #\\a))

    (check-true (char-lower-case? #\\z))

    \;

    (check-false (char-lower-case? #\\A))

    (check-false (char-lower-case? #\\Z))

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/scheme/char.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/scheme/char-test.scm|true|false>
    (check-report)

    \;
  </scm-chunk>

  <chapter|(scheme file)>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/scheme/file.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/scheme/file.scm|true|true>
    (define-library (scheme file)

    (export open-binary-input-file open-binary-output-file)

    (begin

    \ \ 
  </scm-chunk>

  <section|å®ç°>

  <r7rs><paragraph|open-input-file><index|open-input-file>

  S7å†…ç½®å‡½æ•°ã€‚

  <r7rs><paragraph|open-binary-input-file><index|open-binary-input-file>

  <\scm-chunk|goldfish/scheme/file.scm|true|true>
    (define open-binary-input-file open-input-file)

    \;
  </scm-chunk>

  \;

  <r7rs><paragraph|open-output-file><index|open-output-file>

  S7å†…ç½®å‡½æ•°ã€‚

  <r7rs><paragraph|open-binary-output-file><index|open-binary-output-file>

  <\scm-chunk|goldfish/scheme/file.scm|true|true>
    (define open-binary-output-file open-output-file)

    \;
  </scm-chunk>

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/scheme/file.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>

  <chapter|(srfi sicp)>

  <section|è®¸å¯è¯>

  <\scm-chunk|goldfish/srfi/srfi-216.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/sicp.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <\scm-chunk|tests/goldfish/srfi/sicp-test.scm|false|true>
    ;

    ; Copyright (C) 2024 The Goldfish Scheme Authors

    ;

    ; Licensed under the Apache License, Version 2.0 (the "License");

    ; you may not use this file except in compliance with the License.

    ; You may obtain a copy of the License at

    ;

    ; http://www.apache.org/licenses/LICENSE-2.0

    ;

    ; Unless required by applicable law or agreed to in writing, software

    ; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT

    ; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the

    ; License for the specific language governing permissions and limitations

    ; under the License.

    ;

    \;
  </scm-chunk>

  <section|æ¥å£>

  <\scm-chunk|goldfish/srfi/srfi-216.scm|true|true>
    (define-library (srfi srfi-216)

    (export true false nil runtime)

    (import (scheme time))

    (begin

    \;
  </scm-chunk>

  <\scm-chunk|goldfish/srfi/sicp.scm|true|false>
    (define-library (srfi sicp)

    (export true false nil runtime)

    (import (srfi srfi-216)))

    \;
  </scm-chunk>

  <section|æµ‹è¯•>

  <\scm-chunk|tests/goldfish/srfi/sicp-test.scm|true|false>
    (import (srfi sicp)

    \ \ \ \ \ \ \ \ (liii os)

    \ \ \ \ \ \ \ \ (liii check))

    \;

    (display (runtime))

    (newline)

    \;

    (when (os-linux?)

    \ \ (os-call "sleep 0.01"))

    \;

    (display (runtime))

    (newline)

    \;

    (check-true true)

    (check-false false)

    (check-true (null? nil))

    \;

    (check-report)

    \;
  </scm-chunk>

  <section|å®ç°>

  <\scm-chunk|goldfish/srfi/srfi-216.scm|true|true>
    (define true #t)

    \;

    (define false #f)

    \;

    (define nil '())

    \;

    (define (runtime)

    \ \ (round (* 1000 (current-second))))

    \;
  </scm-chunk>

  \;

  <section|ç»“å°¾>

  <\scm-chunk|goldfish/srfi/srfi-216.scm|true|false>
    ) ; end of begin

    ) ; end of define-library

    \;
  </scm-chunk>
</body>

<\initial>
  <\collection>
    <associate|font-base-size|8>
    <associate|info-flag|paper>
    <associate|page-height|auto>
    <associate|page-medium|papyrus>
    <associate|page-screen-margin|false>
    <associate|page-type|a5>
    <associate|page-width|auto>
    <associate|par-par-sep|0.3333fn>
    <associate|save-aux|false>
  </collection>
</initial>
